<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Modules and commands :: Lisk documentation</title>
    <link rel="canonical" href="https://lisk.com/documentation/understand-blockchain/sdk/modules-commands.html">
    <link rel="prev" href="architecture.html">
    <link rel="next" href="../lisk-protocol/index.html">
    <meta name="generator" content="Antora 3.0.0">

  <link id="theme" rel="stylesheet" title="Default" href="../../_/css/site.css">
  <link rel="stylesheet" title="Dark" href="../../_/css/dark-site.css">

    <script>var uiRootPath = '../../_'</script>
    <script src="../../_/js/vendor/medium-zoom.js"></script>
    <script type="text/javascript" id="Cookiebot" src="https://consent.cookiebot.com/uc.js" data-cbid="e4db29b5-cd94-4bcf-87e4-04f4ca564240" data-blockingmode="manual"></script>

<link rel="icon" href="../../_/img/favicon.png" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="top-logo">
        <a href="../.." class="lisk-logo"></a>
        <a href="../.." class="docs-logo"></a>
      </div>
      <!--<a class="navbar-item" href="https://lisk.com/documentation">Lisk documentation</a>-->
        <div id="docsearch" class="navbar-menu search-box hide-for-print">
          <!--<input id="search-input-toolbar" type="text" placeholder="Search me ...">-->
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">APIs</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="../../api/lisk-node-http.html">Lisk node HTTP API</a>
            <a class="navbar-item" href="../../api/lisk-node-rpc.html">Lisk node RPC API</a>
            <a class="navbar-item" href="../../api/lisk-service-http.html">Lisk Service HTTP API</a>
            <a class="navbar-item" href="../../api/lisk-service-rpc.html">Lisk Service RPC API</a>
            <a class="navbar-item" href="../../api/lisk-service-pubsub.html">Lisk Service Pub/Sub API</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Explorers</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://lisk.observer/" target="_blank">Lisk Observer</a>
            <a class="navbar-item" href="https://liskscan.com/" target="_blank">LiskScan</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="../../lisk-sdk/">Lisk SDK</a>
            <a class="navbar-item" href="../../lisk-service/">Lisk Service</a>
            <a class="navbar-item" href="../../lisk-core/">Lisk Core</a>
            <a class="navbar-item" href="https://lisk.com/wallet" target="_blank">Lisk Wallets</a>
          </div>
        </div>
        <button onclick="switch_style('toggle')" id="theme-toggle" class="theme-toggle navbar-item"></button>
        <!-- <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div> -->
      </div>
    </div>
  </nav>
</header>
<div class="toolbar" role="navigation">
  <button class="nav-toggle"></button>
  <div class="components-versions">
      <div class="page-components">
    <button class="component-menu-toggle" title="Show other documentations">Lisk Documentation</button>
    <div class="component-menu">
        <a class="component" href="../../lisk-core/index.html">Lisk Core</a>
        <a class="component" href="../../lisk-docs-manual/index.html">Lisk docs manual</a>
        <a class="component is-current" href="../../index.html">Lisk Documentation</a>
        <a class="component" href="../../lisk-sdk/index.html">Lisk SDK</a>
        <a class="component" href="../../lisk-service/index.html">Lisk Service</a>
    </div>
  </div>
    <span></span>
      </div>
  <span></span>
  <span></span>
  <a href="../../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Lisk Documentation</a></li>
    <li><a href="../index.html">Understand Blockchain</a></li>
    <li><a href="index.html">Introduction to the Lisk SDK</a></li>
    <li><a href="modules-commands.html">Modules and commands</a></li>
  </ul>
</nav>
    <div id="docsearch-toolbar" class="search-box hide-for-print toolbar-search">
      <!--<input id="search-input" type="text" placeholder="Search me ...">-->
    </div>
  <div class="edit-this-page"><a href="https://github.com/LiskHQ/lisk-docs/edit/1510-update-modules-commands/docs/modules/ROOT/pages/understand-blockchain/sdk/modules-commands.adoc"><img class="pencil">Edit this Page</a></div>
  </div>
<div class="body">
<div class="nav-container" data-component="ROOT" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Lisk Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item parent" data-depth="0">
<ul class="nav-list">
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../intro/what-is-blockchain.html">What is blockchain?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../intro/how-blockchain-works.html">How blockchain works</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../intro/lisk-products.html">Lisk products</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
        <span>
    <a class="nav-link" href="../index.html">Understand Blockchain</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../state-machine.html">State machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../consensus/index.html">Consensus protocols</a>
  </li>
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle"></button>
        <span>
    <a class="nav-link" href="index.html">Introduction to the Lisk SDK</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="architecture.html">SDK Architecture</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="modules-commands.html">Modules and commands</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle"></button>
        <span>
    <a class="nav-link" href="../lisk-protocol/index.html">Lisk Protocol</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lisk-protocol/accounts.html">Accounts</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lisk-protocol/blocks.html">Blocks</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lisk-protocol/consensus-algorithm.html">Consensus algorithm</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lisk-protocol/network.html">Network</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lisk-protocol/transactions.html">Transactions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lisk-protocol/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
        <span>
    <a class="nav-link" href="../../build-blockchain/index.html">Build Blockchain</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../build-blockchain/create-blockchain-app.html">Creating a new blockchain application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../build-blockchain/create-module.html">Creating a new module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../build-blockchain/create-asset.html">Creating a new asset</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../build-blockchain/create-genesis-block.html">How to create a new genesis block</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../build-blockchain/create-plugin.html">Creating a new plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../build-blockchain/configure-app.html">How to configure a blockchain application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../build-blockchain/test-app.html">Testing the blockchain application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../build-blockchain/using-dashboard.html">Using dashboard with the blockchain application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../build-blockchain/enable-faucet.html">How to enable a faucet for testing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../build-blockchain/launch-test-network.html">Launching a public test network</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
        <span>
    <a class="nav-link" href="../../run-blockchain/index.html">Run Blockchain</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/account-management.html">Managing accounts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/forging.html">Enabling forging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/blockchain-reset.html">Resetting and snapshotting the blockchain</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/forging-node-protection.html">Protecting a forging node</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/non-forging-node-protection.html">Protecting a non-forging node</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/logging.html">Managing logs</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
        <span>
    <a class="nav-link" href="../../integrate-blockchain/index.html">Integrate Blockchain</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrate-blockchain/calculating-min-fee.html">Calculating the minimum fee for a transaction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrate-blockchain/create-send-transactions.html">How to send a transaction to the network</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrate-blockchain/create-tx-offline.html">Creating transactions and signing them offline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrate-blockchain/encode-decode.html">Decoding &amp; encoding data</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrate-blockchain/create-user-interface.html">Creating a user interface</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
        <span>
    <a class="nav-link" href="../../tutorial/index.html">Tutorials</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tutorial/nft.html">Non-fungible token (NFT) Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tutorial/srs.html">Social Recovery System (SRS) Tutorial</a>
  </li>
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle"></button>
        <span>
    <a class="nav-link" href="../../tutorial/lns/index.html">Lisk Name Service (LNS) Tutorial</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../tutorial/lns/1-blockchain.html">Chapter 1: Blockchain</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../tutorial/lns/2-frontend.html">Chapter 2: Frontend</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../tutorial/lns/3-cli.html">Chapter 3: CLI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../tutorial/lns/4-tests.html">Chapter 4: Tests</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">APIs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../api/lisk-node-rpc.html">RPC API for Lisk nodes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../api/lisk-service-http.html">Mainnet HTTP API (Lisk Service)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../api/lisk-service-rpc.html">RPC endpoints (Lisk Service)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../api/lisk-service-pubsub.html">Publish/Subscribe API (Lisk Service)</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Products</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../lisk-sdk/index.html">Lisk SDK</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../lisk-service/index.html">Lisk Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../lisk-core/index.html">Lisk Core</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../glossary.html">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Lisk Documentation</span>
    <span class="version">default</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../lisk-core/index.html">Lisk Core</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lisk-core/index.html">3.0.4 (latest)</a>
        </li>
        <li class="version">
          <a href="../../lisk-core/v2/index.html">2.1.7</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../lisk-docs-manual/index.html">Lisk docs manual</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lisk-docs-manual/index.html">0.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../index.html">Lisk Documentation</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">default</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../lisk-sdk/index.html">Lisk SDK</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lisk-sdk/index.html">5.2.2 (latest)</a>
        </li>
        <li class="version">
          <a href="../../lisk-sdk/v4/index.html">4.0.0</a>
        </li>
        <li class="version">
          <a href="../../lisk-sdk/v3/index.html">3.0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../lisk-service/index.html">Lisk Service</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lisk-service/index.html">0.6.4 (latest)</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Modules and commands</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>A module is a separate component that contains blockchain-related business logic related to one specific domain or topic of a blockchain application.</p>
</div>
<div class="paragraph">
<p>Modules can be added to a blockchain application by registering them.
For a successful registration, each module needs to follow the expected module structure, which is described on this page.</p>
</div>
<div class="paragraph">
<p>All modules of a blockchain application combined define the complete <strong>on-chain logic</strong> of the blockchain application.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Modules can perform the following:</div>
<div class="ulist">
<ul>
<li>
<p>Executing state changes on the blockchain.</p>
</li>
<li>
<p>Defining logic that is executed per block.</p>
</li>
<li>
<p>Defining logic that is executed per transaction.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#module-anatomy-the-basemodule">Module anatomy &amp; the BaseModule</a></li>
<li><a href="#module-name">Module name</a></li>
<li><a href="#module-constructor">Module constructor</a></li>
<li><a href="#module-metadata">Module metadata</a></li>
<li><a href="#endpoints">Endpoints</a></li>
<li><a href="#stores">Stores</a></li>
<li><a href="#module-configuration">Module configuration</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#blockchain-events">Blockchain Events</a></li>
<li><a href="#commands">Commands</a></li>
<li><a href="#lifecycle-hooks">Lifecycle Hooks</a></li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="module-anatomy-the-basemodule"><a class="anchor" href="#module-anatomy-the-basemodule"></a>Module anatomy &amp; the BaseModule</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All important parts of a module are shown in the diagram below.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../../_images/understand-blockchain/sdk/module.png" alt="Module Anatomy" width="600">
</div>
<div class="title">Figure 1. Anatomy of a module</div>
</div>
<div class="paragraph">
<p>Each module is constructed as a class which extends from the <strong>BaseModule</strong> interface.</p>
</div>
<div class="paragraph">
<p>The <code>BaseModule</code> interface defines all optional and required properties and hooks of a module that must be implemented for the blockchain application to recognize it as a valid module.</p>
</div>
<div class="listingblock">
<div class="title">The <code>BaseModule</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export abstract class BaseModule {
	public commands: BaseCommand[] = [];
	public events: NamedRegistry = new NamedRegistry();
	public stores: NamedRegistry = new NamedRegistry();
	public offchainStores: NamedRegistry = new NamedRegistry();

	public get name(): string {
		const name = this.constructor.name.replace('Module', '');
		return name.charAt(0).toLowerCase() + name.substr(1);
	}

	public abstract endpoint: BaseEndpoint;
	public abstract api: BaseAPI;

	public async init?(args: ModuleInitArgs): Promise&lt;void&gt;;
	public async insertAssets?(context: InsertAssetContext): Promise&lt;void&gt;;
	public async verifyAssets?(context: BlockVerifyContext): Promise&lt;void&gt;;
	public async verifyTransaction?(context: TransactionVerifyContext): Promise&lt;VerificationResult&gt;;
	public async beforeCommandExecute?(context: TransactionExecuteContext): Promise&lt;void&gt;;
	public async afterCommandExecute?(context: TransactionExecuteContext): Promise&lt;void&gt;;
	public async initGenesisState?(context: GenesisBlockExecuteContext): Promise&lt;void&gt;;
	public async finalizeGenesisState?(context: GenesisBlockExecuteContext): Promise&lt;void&gt;;
	public async beforeTransactionsExecute?(context: BlockExecuteContext): Promise&lt;void&gt;;
	public async afterTransactionsExecute?(context: BlockAfterExecuteContext): Promise&lt;void&gt;;

	public abstract metadata(): ModuleMetadata;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="module-name"><a class="anchor" href="#module-name"></a>Module name</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The module name is the human-readable unique identifier for the module.</p>
</div>
<div class="paragraph">
<p>The module name is automatically calculated from the class name of the module, if it extends from the <a href="#module-anatomy-the-basemodule">BaseModule</a>:
The <code>Module</code> suffix of the class name is removed, and all uppercase characters are converted to lowercase.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For example, the module class <code>HelloModule</code> will have the module name <code>hello</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The module name can be accessed inside the module via <code>this.name</code>.</p>
</div>
<div class="paragraph">
<p>In case it is desired to choose a different name for the module, a custom module name can be defined by implementing a getter <code>name</code> which returns the custom module name.</p>
</div>
<div class="listingblock">
<div class="title">Example: Choosing a custom module name</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">import { BaseModule } from 'lisk-sdk';

class HelloModule extends BaseModule {
    // ...
    public get name() {
      return 'newName';
    }
    // ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="module-constructor"><a class="anchor" href="#module-constructor"></a>Module constructor</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="#blockchain-events">Blockchain Events</a> and <a href="#stores">Stores</a> of the module are registered in the constructor of a module, for later use in the module.</p>
</div>
<div class="listingblock">
<div class="title">Example: Module constructor, registering stores and events to the module</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { cryptography, BaseModule } from 'lisk-sdk';

export class HelloModule extends BaseModule {
    // ...
    public constructor() {
		super();
		this.stores.register(UserStore, new UserStore(this.name));
		this.stores.register(EscrowStore, new EscrowStore(this.name));
		this.stores.register(SupplyStore, new SupplyStore(this.name));
		this.stores.register(TerminatedEscrowStore, new TerminatedEscrowStore(this.name));
		this.stores.register(AvailableLocalIDStore, new AvailableLocalIDStore(this.name));
		this.events.register(TransferEvent, new TransferEvent(this.name));
	}
    // ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="module-metadata"><a class="anchor" href="#module-metadata"></a>Module metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The metadata of a module provides information about the module to external services like UIs.</p>
</div>
<div class="paragraph">
<p>It provides information about the following module properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>endpoints</strong>: A list of endpoints of the respective module.
Each item has the following properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: The name of the endpoint.</p>
</li>
<li>
<p><code>request</code>: Required parameters for the endpoint (optional).</p>
</li>
<li>
<p><code>response</code>: A schema of the expected response to a request to the endpoint.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>commands</strong>: The list of commands belonging to the module.
Each item has the following properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>id</code>: The command ID.</p>
</li>
<li>
<p><code>name</code>: The command name.</p>
</li>
<li>
<p><code>params</code>: The required and optional parameters to execute the command (optional).</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>events</strong>: A list of events that are emitted by the module.
Each item has the following properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>typeId</code>: The event type ID.</p>
</li>
<li>
<p><code>data</code>: The event data.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>assets</strong>: The schemas to decode module assets in blocks.
Each item has the following properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>version</code>: The block version.</p>
</li>
<li>
<p><code>data</code>: The asset schema.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The metadata can be obtained by requesting the metadata from the blockchain application via RPC request to the <code>system_getMetadata</code> endpoint.</p>
</div>
<details id="interface-metadata">
<summary class="title">Interface for the Module metadata</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export interface ModuleMetadata {
	endpoints: {
		name: string;
		request?: Schema;
		response: Schema;
	}[];
	events: {
		typeID: string;
		data: Schema;
	}[];
	commands: {
		id: Buffer;
		name: string;
		params?: Schema;
	}[];
	assets: {
		version: number;
		data: Schema;
	}[];
}

export interface Schema {
	readonly $id: string;
	readonly type: string;
	readonly properties: Record&lt;string, unknown&gt;;
	readonly required?: string[];
}</code></pre>
</div>
</div>
</div>
</details>
<div class="sect2">
<h3 id="defining-the-module-metadata"><a class="anchor" href="#defining-the-module-metadata"></a>Defining the module metadata</h3>
<div class="paragraph">
<p>The module metadata follows the format of the <a href="#interface-metadata">module metadata interface</a> and is returned in the <code>metadata()</code> function of a module.</p>
</div>
<details>
<summary class="title">Example: Module metadata</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">const { BaseModule } = require('lisk-sdk');

class HelloModule extends BaseModule {
    // ...

    public metadata(): ModuleMetadata {
        return {
            endpoints: [
                {
                    name: this.endpoint.getAllDelegates.name,
                    response: getAllDelegatesResponseSchema,
                },
                {
                    name: this.endpoint.getDelegate.name,
                    request: getDelegateRequestSchema,
                    response: getDelegateResponseSchema,
                },
                {
                    name: this.endpoint.getVoter.name,
                    request: getVoterRequestSchema,
                    response: getVoterResponseSchema,
                },
                {
                    name: this.endpoint.getConstants.name,
                    response: configSchema,
                },
            ],
            commands: this.commands.map(command =&gt; ({
                id: command.id,
                name: command.name,
                params: command.schema,
            })),
            events: [],
            assets: [
                {
                    version: 0,
                    data: genesisStoreSchema,
                },
            ],
        };
    }

    // ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Schema of the <code>getAllDelegatesResponse</code> endpoint of the DPoS module</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export const getDelegateRequestSchema = {
	$id: 'modules/dpos/endpoint/getDelegateRequest',
	type: 'object',
	required: ['address'],
	properties: {
		address: {
			type: 'string',
			format: 'hex',
		},
	},
};</code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
<div class="sect1">
<h2 id="endpoints"><a class="anchor" href="#endpoints"></a>Endpoints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An endpoint is the interface for a module to an external system through an RPC endpoint.
The module RPC endpoints of a blockchain application can be requested by external services, like a UIs, to get relevant data from the application.</p>
</div>
<div class="paragraph">
<p>The endpoints are defined individually for each module, depending on the module purpose.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Endpoints allow to conveniently <strong>get data from the blockchain application</strong>.
It is never possible to set data / mutate the state via module endpoints.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Every module endpoint always extends from the <code>BaseEndpoint</code> class.</p>
</div>
<div class="listingblock">
<div class="title">The <code>BaseEndpoint</code> class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export abstract class BaseEndpoint {
	[key: string]: unknown;
	protected moduleID: Buffer;
	public constructor(moduleID: Buffer) {
		this.moduleID = moduleID;
	}
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="exposing-endpoints-to-plugins-and-external-services"><a class="anchor" href="#exposing-endpoints-to-plugins-and-external-services"></a>Exposing endpoints to plugins and external services</h3>
<div class="paragraph">
<p>The module endpoints are usually defined in a file called <code>endpoint.ts</code> inside of the folder of the respective module.</p>
</div>
<div class="listingblock">
<div class="title">Example: Module endpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { HelloEndpoint } from './endpoint';
import { cryptography } from 'lisk-sdk';

export class HelloModule extends BaseModule {
	public id = cryptography.utils.intToBuffer(1000, 4);
	public name = 'hello';
	public endpoint = new HelloEndpoint(this.id);
}</code></pre>
</div>
</div>
<details>
<summary class="title">Example: <code>HelloEndpoint</code> in <code>endpoint.ts</code></summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class DPoSEndpoint extends BaseEndpoint {

	public async getVoter(ctx: ModuleEndpointContext): Promise&lt;VoterDataJSON&gt; {
		const voterSubStore = ctx.getStore(this.moduleID, STORE_PREFIX_VOTER);
		const { address } = ctx.params;
		if (typeof address !== 'string') {
			throw new Error('Parameter address must be a string.');
		}
		const voterData = await voterSubStore.getWithSchema&lt;VoterData&gt;(
			Buffer.from(address, 'hex'),
			voterStoreSchema,
		);

		return codec.toJSON(voterStoreSchema, voterData);
	}
}</code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stores"><a class="anchor" href="#stores"></a>Stores</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="the-basestore"><a class="anchor" href="#the-basestore"></a>The BaseStore</h3>
<div class="listingblock">
<div class="title">The BaseStore class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export abstract class BaseStore&lt;T&gt; {
	private readonly _version: number;
	private readonly _storePrefix: Buffer;
	private readonly _subStorePrefix: Buffer;

	public abstract schema: Schema;

	public get storePrefix(): Buffer {
		return this._storePrefix;
	}

	public get subStorePrefix(): Buffer {
		return this._subStorePrefix;
	}

	public get key(): Buffer {
		return Buffer.concat([this._storePrefix, this._subStorePrefix]);
	}

	public get name(): string {
		const name = this.constructor.name.replace('Store', '');
		return name.charAt(0).toLowerCase() + name.substr(1);
	}

	public constructor(moduleName: string, version = 0) {
		this._version = version;
		this._storePrefix = utils.hash(Buffer.from(moduleName, 'utf-8')).slice(0, 4);
		// eslint-disable-next-line no-bitwise
		this._storePrefix[0] &amp;= 0x7f;
		const versionBuffer = Buffer.alloc(2);
		versionBuffer.writeUInt16BE(this._version, 0);
		this._subStorePrefix = utils
			.hash(Buffer.concat([Buffer.from(this.name, 'utf-8'), versionBuffer]))
			.slice(0, 2);
	}

	public async get(ctx: ImmutableStoreGetter, key: Buffer): Promise&lt;T&gt; {
		if (!this.schema) {
			throw new Error('Schema is not set');
		}
		const subStore = ctx.getStore(this._storePrefix, this._subStorePrefix);
		return subStore.getWithSchema&lt;T&gt;(key, this.schema);
	}

	public async has(ctx: ImmutableStoreGetter, key: Buffer): Promise&lt;boolean&gt; {
		if (!this.schema) {
			throw new Error('Schema is not set');
		}
		const subStore = ctx.getStore(this._storePrefix, this._subStorePrefix);
		return subStore.has(key);
	}

	public async iterate(
		ctx: ImmutableStoreGetter,
		options: IterateOptions,
	): Promise&lt;{ key: Buffer; value: T }[]&gt; {
		if (!this.schema) {
			throw new Error('Schema is not set');
		}
		const subStore = ctx.getStore(this._storePrefix, this._subStorePrefix);
		return subStore.iterateWithSchema&lt;T&gt;(options, this.schema);
	}

	public async set(ctx: StoreGetter, key: Buffer, value: T): Promise&lt;void&gt; {
		if (!this.schema) {
			throw new Error('Schema is not set');
		}
		const subStore = ctx.getStore(this._storePrefix, this._subStorePrefix);
		return subStore.setWithSchema(key, value as Record&lt;string, unknown&gt;, this.schema);
	}

	public async del(ctx: StoreGetter, key: Buffer): Promise&lt;void&gt; {
		if (!this.schema) {
			throw new Error('Schema is not set');
		}
		const subStore = ctx.getStore(this._storePrefix, this._subStorePrefix);
		return subStore.del(key);
	}
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="off-chain-stores"><a class="anchor" href="#off-chain-stores"></a>Off-chain Stores</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="module-configuration"><a class="anchor" href="#module-configuration"></a>Module configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A module can access specific configuration options of the blockchain application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Module-specific configuration options</p>
</li>
<li>
<p>Genesis config options</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Both configuration options are defined by the node operator in the <code>config.json</code> file, generally located in the <code>config/default/</code> directory.</p>
</div>
<div class="listingblock">
<div class="title">config.json structure</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">{
    // ...
    plugins: {},
    genesis: {
        blockTime: 10,
        bftBatchSize: 103,
        communityIdentifier: 'sdk',
        maxTransactionsSize: 15 * 1024, // Kilo Bytes
        minFeePerByte: 1000,
        baseFees: [],
        modules: {},
    },
    generation: {
        force: false,
        waitThreshold: 2,
        generators: [],
        modules: {},
    },
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All needed configuration options are identified by the module name, followed by a list of properties.</p>
</div>
<div class="paragraph">
<p>The module config properties must follow the naming pattern defined in the <code>moduleConfigSchema</code>, otherwise, there are no restrictions.</p>
</div>
<div class="listingblock">
<div class="title">moduleConfigSchema</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const moduleConfigSchema = {
	type: 'object',
	propertyNames: {
		pattern: '^[a-zA-Z][a-zA-Z0-9_]*$',
	},
	additionalProperties: { type: 'object' },
};</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="config-schema"><a class="anchor" href="#config-schema"></a>Config schema</h3>
<div class="paragraph">
<p>If the module expects certain options to be present in the configuration, it is recommended to define a configuration schema to validate the module options that the node operator provided in the configuration file of the blockchain application.</p>
</div>
<div class="listingblock">
<div class="title">Example: Module config schema</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class HelloModule extends BaseModule {
    // ...
    public configSchema = {
        $id: '/dpos/config',
        type: 'object',
        properties: {
            numberActiveDelegates: {
                type: 'integer',
                format: 'uint32',
            },
            numberStandbyDelegates: {
                type: 'integer',
                format: 'uint32',
            },
            tokenIDDPoS: {
                type: 'string',
                format: 'hex',
            },
        },
        required: [
            'numberActiveDelegates',
            'numberStandbyDelegates',
            'tokenIDDPoS',
        ],
    };
    // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="config-initialization"><a class="anchor" href="#config-initialization"></a>Config initialization</h3>
<div class="paragraph">
<p>If a module needs to access certain configuration options, it is required to validate and cache the respective configurations in the <code>init()</code> method of a module, like described in the code snippet below.</p>
</div>
<div class="listingblock">
<div class="title">Example: Module init() hook</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class HelloModule extends BaseModule {
    // ...
	public async init(args: ModuleInitArgs): Promise&lt;void&gt; {
        const { genesisConfig, moduleConfig } = args;
        const config = objects.mergeDeep({}, defaultConfig, moduleConfig);
        validator.validate&lt;ModuleConfig&gt;(configSchema, config);

        this._tokenID = Buffer.from(config.feeTokenID, 'hex');
        this._minFeePerByte = genesisConfig.minFeePerByte;
    }
    // ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="methods"><a class="anchor" href="#methods"></a>Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A method is the interface for the module-to-module communication, and <strong>can perform state mutations</strong> on the blockchain.</p>
</div>
<div class="paragraph">
<p>Methods are called from other modules or by the module itself, if certain module-specific data is desired to get or set data in the blockchain.
For example, the <code>transfer</code> method from the <code>Token</code> module is called by a module, if it needs to transfer tokens from one account to the other.</p>
</div>
<div class="paragraph">
<p>Every module method always extends from the <code>BaseMethod</code> class.</p>
</div>
<div class="listingblock">
<div class="title">The BaseMethod class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export abstract class BaseMethod {
	protected moduleID: Buffer;
	public constructor(moduleID: Buffer) {
		this.moduleID = moduleID;
	}
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="exposing-methods-to-other-modules"><a class="anchor" href="#exposing-methods-to-other-modules"></a>Exposing methods to other modules</h3>
<div class="paragraph">
<p>The module methods are usually defined in a file called <code>methods.ts</code> inside of the folder of the respective module.</p>
</div>
<div class="listingblock">
<div class="title">Example: Module methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { HelloMethod } from './api';
import { cryptography } from 'lisk-sdk';

export class HelloModule extends BaseModule {
	public id = cryptography.utils.intToBuffer(1000, 4);
	public name = 'hello';
	public api = new HelloMethod(this.id);
}</code></pre>
</div>
</div>
<details>
<summary class="title">Example: <code>HelloMethod</code> in <code>methods.ts</code></summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class HelloMethod extends BaseMethod {

    // ...

	public async getVoter(apiContext: ImmutableAPIContext, address: Buffer): Promise&lt;VoterData&gt; {
		const voterSubStore = apiContext.getStore(this.moduleID, STORE_PREFIX_VOTER);
		const voterData = await voterSubStore.getWithSchema&lt;VoterData&gt;(address, voterStoreSchema);

		return voterData;
	}

    // ...
}</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="calling-a-module-method-from-another-module"><a class="anchor" href="#calling-a-module-method-from-another-module"></a>Calling a module method from another module</h3>
<div class="paragraph">
<p>To see an example how to call a module method from another module, look at the following example in the module hooks.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="blockchain-events"><a class="anchor" href="#blockchain-events"></a>Blockchain Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Blockchain events are logs of events that occurred in the blockchain network.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Blockchain events are part of the on-chain logic: Each block includes the <strong>event root in the block header</strong>, which is the root of a Sparse-Merkle-Tree of all events, that are included in that particular block.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Certain blockchain events are published by default, for example</p>
</div>
<div class="sect2">
<h3 id="the-baseevent"><a class="anchor" href="#the-baseevent"></a>The BaseEvent</h3>

</div>
<div class="sect2">
<h3 id="creating-events"><a class="anchor" href="#creating-events"></a>Creating events</h3>

</div>
<div class="sect2">
<h3 id="registering-events"><a class="anchor" href="#registering-events"></a>Registering events</h3>

</div>
<div class="sect2">
<h3 id="publishing-events"><a class="anchor" href="#publishing-events"></a>Publishing events</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="commands"><a class="anchor" href="#commands"></a>Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A command is a group of <strong>state-transition logics triggered by a transaction</strong>, identified by the module and command name of the transaction.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../../_images/understand-blockchain/sdk/command.png" alt="Command anatomy" width="600">
</div>
</div>
<div class="paragraph">
<p>Every module method always extends from the <code>BaseCommand</code> class.</p>
</div>
<div class="listingblock">
<div class="title">The BaseCommand class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export abstract class BaseCommand&lt;T = unknown&gt; {
	public schema?: Schema;

	protected moduleID: Buffer;
	public abstract name: string;
	public abstract id: Buffer;

	public constructor(moduleID: Buffer) {
		this.moduleID = moduleID;
	}

	public verify?(context: CommandVerifyContext&lt;T&gt;): Promise&lt;VerificationResult&gt;;

	public abstract execute(context: CommandExecuteContext&lt;T&gt;): Promise&lt;void&gt;;
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="command-id"><a class="anchor" href="#command-id"></a>Command ID</h3>
<div class="paragraph">
<p>The command ID is a unique identifier for the command within the module.</p>
</div>
<div class="paragraph">
<p>The minimum value is 0.
The ID is stored in binary format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">const CREATE_HELLO_ID = 0;
export class TransferCommand extends BaseCommand {
	public id = cryptography.utils.intToBuffer(CREATE_HELLO_ID, 4);
	// ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="command-name"><a class="anchor" href="#command-name"></a>Command name</h3>
<div class="paragraph">
<p>The command identifier in string format.
The string must only consist of lower case and upper case letters [a-z, A-Z].
No numbers, hyphens, etc., are allowed.</p>
</div>
<div class="paragraph">
<p>Needs to be unique within the module the command belongs to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class TransferCommand extends BaseCommand {
    // ...
	public name = 'transfer';
    // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="command-parameters-schema"><a class="anchor" href="#command-parameters-schema"></a>Command parameters schema</h3>
<div class="paragraph">
<p>If a command expects parameters, the parameters schema is defined in the <code>schema</code> property of the command.
It defines which parameters are required in the transaction, and also which data types are to be expected.</p>
</div>
<div class="paragraph">
<p>If the parameters of a transaction object do not match the corresponding schema, the transaction will not be accepted by the node.
The schema follows the format of a modified JSON schema<sup class="footnote" id="_footnote_jsonSchema">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>, and should contain the following properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">$id</dt>
<dd>
<p>Unique identifier of the schema throughout the system.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <code>$id</code> property is directly inherited from the JSON-schema.
You can read more about the id property on <a href="https://json-schema.org/understanding-json-schema/structuring.html#id" class="bare" target="_blank" rel="noopener">https://json-schema.org/understanding-json-schema/structuring.html#id</a>.</p>
</div>
<div class="paragraph">
<p>In general, adhere to the following criteria:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use unique IDs across the system.</p>
</li>
<li>
<p>Use path like format for easy readability, (it is not an actual requirement).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to ensure no mixing of any schema with other registered schemas occurs, use one fixed identifier for your app in each ID.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">title</dt>
<dd>
<p>A short description of the schema.</p>
</dd>
<dt class="hdlist1">type or dataType</dt>
<dd>
<p>If the data type of a property is either an <code>object</code> or an <code>array</code>, the <code>type</code> property must be used instead of <code>dataType</code>.
Root type of the schema must be type object.</p>
</dd>
<dt class="hdlist1">required</dt>
<dd>
<p>A list of all required parameters.</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If the schema is used for serialization, it is recommended to put all properties as required to guarantee the uniqueness of encoding.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">properties</dt>
<dd>
<p>A list of the command parameters.
It also defines their data type, order, and additional properties like min and max length.</p>
</dd>
</dl>
</div>
<details>
<summary class="title">Example: Command parameters schema</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class TransferCommand extends BaseCommand {
	// ...
	public schema = {
        $id: '/lisk/transferParams',
        title: 'Transfer transaction params',
        type: 'object',
        required: ['tokenID', 'amount', 'recipientAddress', 'data'],
        properties: {
            tokenID: {
                dataType: 'bytes',
                fieldNumber: 1,
                minLength: TOKEN_ID_LENGTH,
                maxLength: TOKEN_ID_LENGTH,
            },
            amount: {
                dataType: 'uint64',
                fieldNumber: 2,
            },
            recipientAddress: {
                dataType: 'bytes',
                fieldNumber: 3,
                minLength: ADDRESS_LENGTH,
                maxLength: ADDRESS_LENGTH,
            },
            data: {
                dataType: 'string',
                fieldNumber: 4,
                minLength: 0,
                maxLength: MAX_DATA_LENGTH,
            },
        },
    };
    // ...
}</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="command-lifecycle-hooks"><a class="anchor" href="#command-lifecycle-hooks"></a>Command Lifecycle Hooks</h3>
<div class="paragraph">
<p>Each command has the following lifecycle hooks, which are executed separately for each command in a block.</p>
</div>
<div class="sect3">
<h4 id="command-initialization"><a class="anchor" href="#command-initialization"></a>Command initialization</h4>
<div class="paragraph">
<p>The <code>init()</code> hook of a command is called by the Lisk Framework when the node starts.</p>
</div>
<div class="paragraph">
<p>Here, you can validate and cache the module config or do initializations which should only happen once per node starts.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class TransferCommand extends BaseCommand {
    // ...
	private _methods!: TokenMethods;
	public init(args: { methods: TokenMethods }) {
		this._methods = args.methods;
	}
    // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="command-verification"><a class="anchor" href="#command-verification"></a>Command verification</h4>
<div class="paragraph">
<p>The hook <code>Command.verify</code> is called only for the command that is referenced by the module name and the command name in the transaction.
Similar to the <code>verifyTransaction</code> hook, <code>Command.verify</code> will be called also in the transaction pool, and it is to ensure the verification defined in this hook is respected when the transactions are included in a block.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this hook, the <strong>state cannot be mutated</strong> and events cannot be emitted.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class TransferCommand extends BaseCommand {
	// ...
	public async verify(context: CommandVerifyContext&lt;Params&gt;): Promise&lt;VerificationResult&gt; {
		const { params } = context;

		try {
			validator.validate(transferParamsSchema, params);
		} catch (err) {
			return {
				status: VerifyStatus.FAIL,
				error: err as Error,
			};
		}
		return {
			status: VerifyStatus.OK,
		};
	}
    // ...
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="command-verification-context"><a class="anchor" href="#command-verification-context"></a>Command verification context</h5>
<div class="paragraph">
<p>The <code>context</code> is available in every <code>Command.execute()</code> hook.</p>
</div>
<div class="paragraph">
<p>It allows convenient access to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>logger</code>: Logger interface, to create log messages.</p>
</li>
<li>
<p><code>networkIdentifier</code>: The identifier of the blockchain network, in which this command is executed.</p>
</li>
<li>
<p><code>transaction</code>: The transaction triggering the command.</p>
</li>
<li>
<p><code>params</code>: The command params, which were attached to the transaction.</p>
</li>
<li>
<p><code>getMethodContext</code>: Module method interface, to invoke modules methods.</p>
</li>
<li>
<p><code>getStore</code>: State store interface, to get and set data from/to the module stores.</p>
</li>
</ul>
</div>
<details>
<summary class="title">CommandVerifyContext interface</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export interface CommandVerifyContext&lt;T = undefined&gt; {
	logger: Logger;
	networkIdentifier: Buffer;
	transaction: Transaction; // without decoding params
	params: T;
	getMethodContext: () =&gt; ImmutableMethodContext;
	getStore: (moduleID: Buffer, storePrefix: number) =&gt; ImmutableSubStore;
}</code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
<div class="sect3">
<h4 id="command-execution"><a class="anchor" href="#command-execution"></a>Command execution</h4>
<div class="paragraph">
<p>Applies the state changes through the state machine.
The hook <code>Command.execute</code> is triggered by a transaction identified by the module name and the command name.</p>
</div>
<div class="paragraph">
<p>If the hook execution fails, the transaction that triggered this command is still valid, but the state changes applied during this hook are reverted.
Additionally, an event will be emitted that provides the information whether a command is executed successfully or failed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this hook, the <strong>state can be mutated</strong> and events can be emitted.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class TransferCommand extends BaseCommand {
	// ...
	public async execute(context: CommandExecuteContext&lt;Params&gt;): Promise&lt;void&gt; {
		const { params } = context;
		await this._api.transfer(
			context.getAPIContext(),
			context.transaction.senderAddress,
			params.recipientAddress,
			params.tokenID,
			params.amount,
		);
	}
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="command-execution-context"><a class="anchor" href="#command-execution-context"></a>Command execution context</h5>
<div class="paragraph">
<p>The <code>context</code> is available in every <code>Command.execute()</code> hook.</p>
</div>
<div class="paragraph">
<p>It allows convenient access to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>logger</code>: Logger interface, to create log messages.</p>
</li>
<li>
<p><code>networkIdentifier</code>: The identifier of the blockchain network, in which this command is executed.</p>
</li>
<li>
<p><code>eventQueue</code>: The event queue.
See <a href="#blockchain-events">Blockchain Events</a> for more information.</p>
</li>
<li>
<p><code>header</code>: Block header.</p>
</li>
<li>
<p><code>assets</code>: Block assets.</p>
</li>
<li>
<p><code>currentValidators</code>: Validators of the current block generation round.</p>
</li>
<li>
<p><code>impliesMaxPrevote</code>: <code>true</code> if the block header which includes this transaction has prevotes which follow the BFT protocol.</p>
</li>
<li>
<p><code>maxHeightCertified</code>: Current height of the block in this chain which is certified.</p>
</li>
<li>
<p><code>certificateThreshold</code>: BFT vote weight required to generate a certificate.</p>
</li>
<li>
<p><code>transaction</code>: The transaction triggering the command.</p>
</li>
<li>
<p><code>params</code>: The command params, which were attached to the transaction.</p>
</li>
<li>
<p><code>getMethodContext</code>: Module method interface, to invoke modules methods.</p>
</li>
<li>
<p><code>getStore</code>: State store interface, to get and set data from/to the module stores.</p>
</li>
</ul>
</div>
<details>
<summary class="title">Interface: CommandExecuteContext</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export interface CommandExecuteContext&lt;T = undefined&gt; {
	logger: Logger;
	networkIdentifier: Buffer;
	eventQueue: EventQueue; // see "Events" section for more info
	header: BlockHeader;
	assets: BlockAssets;
	currentValidators: Validator[];
	impliesMaxPrevote: boolean;
	maxHeightCertified: number;
	certificateThreshold: bigint;
	transaction: Transaction; // See the "Lisk key concepts" page for more information about transactions
	params: T;
	getMethodContext: () =&gt; MethodContext;
	getStore: (moduleID: Buffer, storePrefix: number) =&gt; SubStore;
}</code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lifecycle-hooks"><a class="anchor" href="#lifecycle-hooks"></a>Lifecycle Hooks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The module hooks are called in a specific order during block creation and execution.</p>
</div>
<div class="paragraph">
<p>Read more about the block lifecycles in the following sections:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="../index.html#genesis-block-execution" class="xref page">Lisk key concepts &gt; Genesis block execution</a></p>
</li>
<li>
<p><a href="../index.html#block-generation" class="xref page">Lisk key concepts &gt; Block generation</a></p>
</li>
<li>
<p><a href="../index.html#block-execution" class="xref page">Lisk key concepts &gt; Block processing</a></p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Never include external dynamic data to state changes in the lifecycle hooks.
It will create inconsistencies/forks for nodes when syncing to the current height.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="insertassets"><a class="anchor" href="#insertassets"></a>insertAssets</h3>
<div class="paragraph">
<p>The hook <code>insertAssets</code> is called at the very beginning of the <a href="../index.html#block-generation" class="xref page">block generation</a>.
The assets added during the execution of this hook can be used in all the execution hooks afterwards.</p>
</div>
<div class="paragraph">
<p>For example, the <code>seedReveal</code> property is added to the block asset in this hook by the Random module.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">public async insertAssets(context: InsertAssetContext): Promise&lt;void&gt; {}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="verifyassets"><a class="anchor" href="#verifyassets"></a>verifyAssets</h3>
<div class="paragraph">
<p>The hook <code>verifyAssets</code> is only called before <a href="../index.html#block-execution" class="xref page">executing a block</a>.</p>
</div>
<div class="paragraph">
<p>If this stage fails, the block is considered invalid and will be rejected.
In particular, the following hooks will not get executed.</p>
</div>
<div class="paragraph">
<p>This hook is used for verification before any state changes.
For example, at this stage, each module checks if the expected assets exist in the block.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this hook, the <strong>state cannot be mutated</strong> and events cannot be emitted.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">public async verifyAssets(context: BlockVerifyContext): Promise&lt;void&gt; {}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="beforetransactionsexecute"><a class="anchor" href="#beforetransactionsexecute"></a>beforeTransactionsExecute</h3>
<div class="paragraph">
<p>The hook <code>beforeTransactionsExecute</code> is triggered before any of the transactions of the block are processed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this hook, the <strong>state can be mutated</strong> and events can be emitted.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">public async beforeTransactionsExecute(context: BlockExecuteContext): Promise&lt;void&gt; {}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="verifytransaction"><a class="anchor" href="#verifytransaction"></a>verifyTransaction</h3>
<div class="paragraph">
<p>The hook <code>verifyTransaction</code> is called for all the transactions within a block regardless of the command they trigger.
This ensures that all transactions included in a block satisfy the verifications defined in this hook.</p>
</div>
<div class="paragraph">
<p>This hook is used also for transaction verification in the transaction pool to reject invalid transactions early before transmitting them to the network.
For example, signature verification is done in this hook.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this hook, the <strong>state cannot be mutated</strong> and events cannot be emitted.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">public async verifyTransaction(context: TransactionVerifyContext): Promise&lt;void&gt; {}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="beforecommandexecute"><a class="anchor" href="#beforecommandexecute"></a>beforeCommandExecute</h3>
<div class="paragraph">
<p>The hook <code>beforeCommandExecute</code> allows adding business logic before the execution of a command.
It is called for all the transactions within a block regardless of the command they trigger.</p>
</div>
<div class="paragraph">
<p>If the hook fails during the execution, the transaction becomes invalid and the block containing this transaction will be invalid.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this hook, the <strong>state can be mutated</strong> and events can be emitted.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">public async beforeCommandExecute(context: TransactionExecuteContext): Promise&lt;void&gt; {}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aftercommandexecute"><a class="anchor" href="#aftercommandexecute"></a>afterCommandExecute</h3>
<div class="paragraph">
<p>The hook <code>afterCommandExecute</code> allows adding business logic after the execution of a command.
It is called for all the transactions within a block regardless of the command they trigger.</p>
</div>
<div class="paragraph">
<p>If the hook fails during the execution, the transaction becomes invalid and the block containing this transaction will be invalid.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this hook, the <strong>state can be mutated</strong> and events can be emitted.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">public async afterCommandExecute(context: TransactionExecuteContext): Promise&lt;void&gt; {}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aftertransactionsexecute"><a class="anchor" href="#aftertransactionsexecute"></a>afterTransactionsExecute</h3>
<div class="paragraph">
<p>The hook <code>afterTransactionsExecute</code> is the last hook allowed to define state changes that are triggered by the block.</p>
</div>
<div class="paragraph">
<p>Additionally, when defining the <code>afterTransactionsExecute</code> logic for a module, the transactions included in the block are available in that context and can be used in this logic.
For example, this hook can be used to sum the fees of the transactions included in a block and transfer them to the block generator.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this hook, the <strong>state can be mutated</strong> and events can be emitted.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">public async afterTransactionsExecute(context: BlockAfterExecuteContext): Promise&lt;void&gt; {}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="initgenesisstate"><a class="anchor" href="#initgenesisstate"></a>initGenesisState</h3>
<div class="paragraph">
<p>The hook <code>initGenesisState</code> is called at the beginning of the <a href="../index.html#genesis-block-execution" class="xref page">genesis block execution</a>.
Each module must initialize their state using an associated block asset.</p>
</div>
<div class="paragraph">
<p>It is recommended not to use methods from other modules because their state might not be initialized yet depending on the order of the hook execution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">public async initGenesisState(context: GenesisBlockExecuteContext): Promise&lt;void&gt; {}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="finalizegenesisstate"><a class="anchor" href="#finalizegenesisstate"></a>finalizeGenesisState</h3>
<div class="paragraph">
<p>The hook <code>finalizeGenesisState</code> is called at the end of <a href="../index.html#genesis-block-execution" class="xref page">genesis block execution</a>.</p>
</div>
<div class="paragraph">
<p>In this hook, it can be assumed that the state initialization via <code>initGenesisState</code> of every module is completed and therefore methods from other modules can be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">public async finalizeGenesisState(context: GenesisBlockExecuteContext): Promise&lt;void&gt; {}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. See the <a href="https://json-schema.org/specification.html" class="bare">https://json-schema.org/specification.html</a> for more information about the JSON schema.
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="architecture.html">SDK Architecture</a></span>
  <span class="next"><a href="../lisk-protocol/index.html">Lisk Protocol</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="footerdiv">
    <p> 2022 Lisk Foundation</p>
    <!-- <div class="community-section">
      <p class="community-section__text">Follow Lisk on: </p>
      <div class="community-section__icons"> -->
    <div class="community_icons">
        <a href="https://lisk.chat" title="Discord" target="_blank" class="footer_icon icon-discord"><p>Discord</p></a>
        <a href="https://dev.lisk.com" title="Discourse" target="_blank" class="footer_icon icon-discourse"><p>Discourse</p></a>
        <a href="https://github.com/LiskHQ" title="GitHub" target="_blank" class="footer_icon icon-github"><p>GitHub</p></a>
  <!--    </div> -->
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/tabs-block-behaviour.js"></script>
<script async src="../../_/js/vendor/swagger-ui.js"></script>
<script async src="../../_/js/vendor/component-versions.js"></script>
<script src="../../_/js/vendor/custom.js"></script>
  <script src="../../_/js/vendor/docsearch.js"></script>
  <!--<script src="../../_/js/vendor/docsearch.min.js"></script>-->
  <!--<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha"></script>-->
  <script>
    docsearch({
      container: '#docsearch',
        appId: 'C4SU57KGV9',
      apiKey: '55aa8709b04eb62f08f87571cf77547c',
      indexName: 'lisk-docs-search'
    });
    docsearch({
      container: '#docsearch-toolbar',
        appId: 'C4SU57KGV9',
      apiKey: '55aa8709b04eb62f08f87571cf77547c',
      indexName: 'lisk-docs-search'
    });
  </script>
  <!--<script>
    function focusSearchInput () { document.querySelector('#search-input').focus() }
    var search = docsearch({
        appId: 'C4SU57KGV9',
      apiKey: '55aa8709b04eb62f08f87571cf77547c',
      indexName: 'lisk-docs-search',
      inputSelector: '#search-input',
      autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
      algoliaOptions: { hitsPerPage: 10 }
    }).autocomplete
    search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
    focusSearchInput()
    window.addEventListener('load', focusSearchInput)
  </script>-->
<!--  <script>
    function focusSearchInputToolbar () { document.querySelector('#search-input-toolbar').focus() }
    var search = docsearch({
        appId: 'C4SU57KGV9',
      apiKey: '55aa8709b04eb62f08f87571cf77547c',
      indexName: 'lisk-docs-search',
      inputSelector: '#search-input-toolbar',
      autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
      algoliaOptions: { hitsPerPage: 10 }
    }).autocomplete
    search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
    focusSearchInputToolbar()
    window.addEventListener('load', focusSearchInputToolbar)
  </script>-->
  </body>
</html>
