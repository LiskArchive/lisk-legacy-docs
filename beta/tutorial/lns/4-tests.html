<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 4: Tests :: Lisk documentation</title>
    <link rel="canonical" href="https://liskhq.github.io/lisk-docs/tutorial/lns/4-tests.html">
    <meta name="generator" content="Antora 3.1.1">

  <link id="theme" rel="stylesheet" title="Default" href="../../../_/css/site.css">
  <link rel="stylesheet" title="Dark" href="../../../_/css/dark-site.css">

    <script>var uiRootPath = '../../../_'</script>
    <script src="../../../_/js/vendor/medium-zoom.js"></script>
    <script type="text/javascript" id="Cookiebot" src="https://consent.cookiebot.com/uc.js" data-cbid="e4db29b5-cd94-4bcf-87e4-04f4ca564240" data-blockingmode="manual"></script>
    <!-- Matomo -->
    <script>
      var _paq = window._paq = window._paq || [];
      /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="https://lisk.matomo.cloud/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '2']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src='//cdn.matomo.cloud/lisk.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Matomo Code -->
    <!-- Matomo Tag Manager -->
    <script>
      var _mtm = window._mtm = window._mtm || [];
      _mtm.push({'mtm.startTime': (new Date().getTime()), 'event': 'mtm.Start'});
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src='https://cdn.matomo.cloud/lisk.matomo.cloud/container_RUW6y8yf.js'; s.parentNode.insertBefore(g,s);
    </script>
    <!-- End Matomo Tag Manager -->
<link rel="icon" href="../../../_/img/favicon.png" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="top-logo">
        <a href="../../.." class="lisk-logo"></a>
        <a href="../../.." class="docs-logo"></a>
      </div>
      <!--<a class="navbar-item" href="https://liskhq.github.io/lisk-docs">Lisk documentation</a>-->
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">APIs</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="../../../api/lisk-node-http.html">Lisk node HTTP API</a>
            <a class="navbar-item" href="../../../api/lisk-node-rpc.html">Lisk node RPC API</a>
            <a class="navbar-item" href="../../../api/lisk-service-http.html">Lisk Service HTTP API</a>
            <a class="navbar-item" href="../../../api/lisk-service-rpc.html">Lisk Service RPC API</a>
            <a class="navbar-item" href="../../../api/lisk-service-pubsub.html">Lisk Service Pub/Sub API</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Explorers</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://lisk.observer/" target="_blank">Lisk Observer</a>
            <a class="navbar-item" href="https://liskscan.com/" target="_blank">LiskScan</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="../../../lisk-sdk/">Lisk SDK</a>
            <a class="navbar-item" href="../../../lisk-service/">Lisk Service</a>
            <a class="navbar-item" href="../../../lisk-core/">Lisk Core</a>
            <a class="navbar-item" href="https://lisk.com/wallet" target="_blank">Lisk Wallets</a>
          </div>
        </div>
        <button onclick="switch_style('toggle')" id="theme-toggle" class="theme-toggle navbar-item"></button>
        <!-- <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div> -->
      </div>
    </div>
  </nav>
</header>
<div class="toolbar" role="navigation">
  <button class="nav-toggle"></button>
  <div class="components-versions">
      <div class="page-components">
    <button class="component-menu-toggle" title="Show other documentations">Lisk Documentation</button>
    <div class="component-menu">
        <a class="component" href="../../../lisk-core/index.html">Lisk Core</a>
        <a class="component" href="../../../lisk-docs-manual/index.html">Lisk docs manual</a>
        <a class="component is-current" href="../../../index.html">Lisk Documentation</a>
        <a class="component" href="../../../lisk-sdk/index.html">Lisk SDK</a>
        <a class="component" href="../../../lisk-service/index.html">Lisk Service</a>
    </div>
  </div>
    <span></span>
    <div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">beta</button>
  <div class="version-menu">
    <a class="version" href="../../../tutorial/lns/4-tests.html">default</a>
    <a class="version is-current" href="4-tests.html">beta</a>
  </div>
</div>
  </div>
  <span></span>
  <span></span>
  <a href="../../../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Lisk Documentation</a></li>
    <li><a href="4-tests.html">Chapter 4: Tests</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/LiskHQ/lisk-docs/edit/1719-posting-txs/docs/modules/ROOT/pages/tutorial/lns/4-tests.adoc"><img class="pencil">Edit this Page</a></div>
  </div>
<div class="body">
<div class="nav-container" data-component="ROOT" data-version="beta">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Lisk Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item parent" data-depth="0">
<ul class="nav-list">
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../intro/what-is-blockchain.html">What is blockchain?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../intro/how-blockchain-works.html">How blockchain works</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../intro/blockchain-scalability.html">Blockchain Scalability</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../intro/lisk-products.html">Lisk products</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
        <span>
    <a class="nav-link" href="../../understand-blockchain/index.html">Understand Lisk Blockchain</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../understand-blockchain/state-machine.html">State machine</a>
  </li>
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle"></button>
        <span>
    <a class="nav-link" href="../../understand-blockchain/interoperability/index.html">Lisk Interoperability</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../understand-blockchain/interoperability/communication.html">Cross-chain communication</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../understand-blockchain/interoperability/sidechain-registration-and-recovery.html">Sidechain Registration &amp; Recovery</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../understand-blockchain/blocks-txs.html">Blocks and Transactions</a>
  </li>
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Lisk SDK</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../understand-blockchain/sdk/modules-commands.html">Modules and Commands</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../understand-blockchain/sdk/plugins.html">Plugins</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../understand-blockchain/sdk/rpc.html">Communicating to a Lisk node via RPC</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
        <span>
    <a class="nav-link" href="../../build-blockchain/index.html">Build Blockchain</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../build-blockchain/create-sidechain-app.html">Creating a new sidechain application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../build-blockchain/configuration.html">Sidechain client configuration</a>
  </li>
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle"></button>
        <span>
    <a class="nav-link" href="../../build-blockchain/module/index.html">How to create a module</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../build-blockchain/module/configuration.html">1. How to create a module configuration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../build-blockchain/module/stores.html">2. How to create stores</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../build-blockchain/module/command.html">3. How to create a command</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../build-blockchain/module/endpoints-methods.html">4. How to create endpoints and methods</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../build-blockchain/module/blockchain-event.html">5. How to create a blockchain event</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle"></button>
        <span>
    <a class="nav-link" href="../../build-blockchain/plugin/index.html">How to create a plugin</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../build-blockchain/plugin/schema-types.html">1. Defining off-chain data structures</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../build-blockchain/plugin/offchain-db.html">2. Setting up an Off-chain database</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../build-blockchain/plugin/configuring-plugin.html">3. Configuring a Plugin</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../build-blockchain/plugin/plugin-class.html">4. Updating the Plugin Class</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../build-blockchain/plugin/plugin-endpoints.html">5. Creating an endpoint &amp; Testing the plugin</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../build-blockchain/create-genesis-block.html">How to create a new genesis block</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../build-blockchain/register-sidechain.html">How to register a sidechain</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
        <span>
    <a class="nav-link" href="../../run-blockchain/index.html">Run Blockchain</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/process-management.html">Process management with PM2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/become-a-validator.html">How to become a validator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/staking.html">How to stake and un-stake tokens</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/enable-block-generation.html">How to enable/disable block generation</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
        <span>
    <a class="nav-link" href="../../integrate-blockchain/index.html">Integrate Blockchain</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrate-blockchain/connecting-endpoints.html">Connecting to endpoints</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrate-blockchain/subscribing-to-events.html">Retrieving on-chain events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrate-blockchain/calculating-min-fee.html">How to calculate the minimum fee for a transaction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrate-blockchain/posting-transactions.html">How to post a transaction</a>
  </li>
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle"></button>
        <span>
    <a class="nav-link" href="../../integrate-blockchain/integrate-UI/index.html">Integrating with UI</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../integrate-blockchain/integrate-UI/create-get-account.html">1. Handling accounts</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../integrate-blockchain/integrate-UI/faucet-transfer.html">2. Using faucet and transferring tokens</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../integrate-blockchain/integrate-UI/send-get-hello.html">3. Sending and retrieving hello</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">APIs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../api/lisk-node-rpc.html">RPC API for Lisk nodes</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Products</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../lisk-sdk/v6/index.html">Lisk SDK</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../lisk-core/v4/index.html">Lisk Core</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../bug-bounty-program.html">Lisk Bug Bounty Program</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../glossary.html">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Lisk Documentation</span>
    <span class="version">beta</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../lisk-core/index.html">Lisk Core</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../lisk-core/index.html">3.0.4 (latest)</a>
        </li>
        <li class="version">
          <a href="../../../lisk-core/v4/index.html">4.0.0 (beta)</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../lisk-docs-manual/index.html">Lisk docs manual</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../lisk-docs-manual/index.html">0.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../../index.html">Lisk Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../index.html">default</a>
        </li>
        <li class="version is-current">
          <a href="../../index.html">beta</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../lisk-sdk/index.html">Lisk SDK</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../lisk-sdk/index.html">5.2.2 (latest)</a>
        </li>
        <li class="version">
          <a href="../../../lisk-sdk/v6/index.html">6.0.0 (beta)</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../lisk-service/index.html">Lisk Service</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../lisk-service/index.html">0.6.4 (latest)</a>
        </li>
        <li class="version">
          <a href="../../../lisk-service/v0.7/index.html">0.7.0 (beta)</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Chapter 4: Tests</h1>
<div class="sect1">
<h2 id="writing-unit-tests"><a class="anchor" href="#writing-unit-tests"></a>Writing unit tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the final chapter of this tutorial, it is covered how to test the application with both unit and network tests.</p>
</div>
<div class="paragraph">
<p>Writing tests for the application is more and more important, the more complex the blockchain application becomes.
Once a certain complexity is reached, it will not be convenient anymore to test the application functionality with the dashboard plugin, the CLI, or via a frontend. Therefore, writing tests is considered as crucial in order to verify the correct behavior of the blockchain application.</p>
</div>
<div class="paragraph">
<p>For this purpose, a couple of unit tests are added to the application in this chapter, which is followed by a couple of network tests in the next chapter.</p>
</div>
<div class="paragraph">
<p>To ensure the creation of the tests can be performed in a convenient manner, the testing utilities will be used.</p>
</div>
<div class="paragraph">
<p>Navigate into the <code>test/</code> folder of the LNS application.
The <code>test</code> folder is the correct location to store all kinds of different tests for the blockchain application.</p>
</div>
<div class="paragraph">
<p>The unit tests are stored in the <code>test/unit/</code> folder, as the name suggests.</p>
</div>
<div class="listingblock">
<div class="title">lisk-name-service/lns/test/</div>
<div class="content">
<pre>.
├── _setup.js
├── commands
├── integration
├── network
├── tsconfig.json
├── unit
│   └── modules
│       └── lns
│           ├── assets
│           │   ├── register.spec.ts
│           │   └── reverse_lookup.spec.ts
│           └── lns.spec.ts
└── utils</pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen, there are already some existing test files for the lns module and the assets.
These files were auto-generated by Lisk Commander when the LNS module and the assets were generated.</p>
</div>
<div class="paragraph">
<p>The existing test files already contain test skeletons, providing a rough structure how to write the required tests.</p>
</div>
<div class="sect2">
<h3 id="testing-the-register-asset"><a class="anchor" href="#testing-the-register-asset"></a>Testing the Register asset</h3>
<div class="paragraph">
<p>The complete code of the tests for the Register asset is described below.
Most of the code is self-explanatory, however, the most important parts of the tests are summarized here to provide a better overview:</p>
</div>
<div class="sect3">
<h4 id="testing-the-validate-function"><a class="anchor" href="#testing-the-validate-function"></a>Testing the validate() function</h4>
<div class="paragraph">
<p>Tests for the <a href="1-blockchain.html#validate" class="xref page">validate() function</a> of the Register asset.</p>
</div>
<div class="paragraph">
<p>Write tests to check the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It should not be possible to set the TTL in the asset to a value lower than 3600 seconds, (1 hour).</p>
</li>
<li>
<p>It should throw an error if the name is registered for less than a year.</p>
</li>
<li>
<p>It should throw an error if the name is registered for more than 5 years.</p>
</li>
<li>
<p>It should throw an error if the domain contains an invalid tld.</p>
</li>
<li>
<p>If no errors are thrown, then all asset parameters are valid.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before each test:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new instance of the Register asset.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use of the SDK testing utilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>testing.createValidateAssetContext()</code>: Returns valid parameters for the <code>validate()</code> function.
If the function is called with an empty object, it returns the default parameters for the <code>validate()</code> function.
For the test, overwrite the default <code>asset</code> value (<code>undefined</code>), with a valid transaction asset for the Register asset.
For the function to be called successfully, overwrite the default transaction value of the context (<code>undefined</code>), with a transaction containing a property <code>senderAddress</code> with a Buffer of size 0.
It is not necessary to put a real address here in this case, as it is not used in the tests.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="testing-the-apply-function"><a class="anchor" href="#testing-the-apply-function"></a>Testing the apply() function</h4>
<div class="paragraph">
<p>Tests for the <a href="1-blockchain.html#state-change" class="xref page">apply() function</a> of the Register asset.</p>
</div>
<div class="paragraph">
<p>Write tests to check the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Valid cases:</p>
<div class="ulist">
<ul>
<li>
<p>It should update the state store with the name hash key.</p>
</li>
<li>
<p>It should update the state store with the updated sender account.</p>
</li>
<li>
<p>It should update the state store with the correct ttl value.</p>
</li>
<li>
<p>It should update the state store with the correct expiry date.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Invalid cases:</p>
<div class="ulist">
<ul>
<li>
<p>It should throw an error if the name is already registered.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before each test:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new default account for the LNS application.</p>
</li>
<li>
<p>Add the newly created account to the <code>accounts</code> list of the <code>StateStore</code> mock.</p>
</li>
<li>
<p>Spy on the functions <code>stateStore.chain.get</code> and <code>stateStore.chain.set</code>.
This allows checking in the tests if the respective functions have been called or not.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use of the SDK testing utilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>testing.createApplyAssetContext()</code>: Returns valid parameters for the <code>apply()</code> function.
If the function is called with an empty object, it returns the default parameters for the <code>apply()</code> function.
For the test, overwrite the default <code>asset</code> value (<code>undefined</code>), with a valid transaction asset for the Register asset.
Additionally, overwrite the default transaction value of the context (<code>undefined</code>), with a transaction containing a property <code>senderAddress</code> which equals the address of the newly created account.</p>
</li>
<li>
<p><code>testing.fixtures.createDefaultAccount&lt;LNSAccountProps&gt;([LnsModule])</code>:
Used to create a default account for the LNS application.</p>
</li>
<li>
<p><code>new testing.mocks.StateStoreMock({accounts: [account]})</code>:
Creates a mock for the StateStore.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="unit-tests-for-the-register-asset"><a class="anchor" href="#unit-tests-for-the-register-asset"></a>Unit tests for the Register asset</h4>
<div class="listingblock">
<div class="title">lisk-name-service/lns/test/unit/modules/lns/assets/register.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { addYears } from 'date-fns';
import { StateStore, testing } from 'lisk-sdk';
import { RegisterAsset } from '../../../../../src/app/modules/lns/assets/register';
import { LNSAccountProps } from '../../../../../src/app/modules/lns/data';
import { LnsModule } from '../../../../../src/app/modules/lns/lns_module';
import {
	getKeyForNode,
	getLNSObject,
	getNodeForName,
} from '../../../../../src/app/modules/lns/storage';

// Tests for the Register asset
describe('RegisterAsset', () =&gt; {
	let transactionAsset: RegisterAsset;

	beforeEach(() =&gt; {
		transactionAsset = new RegisterAsset();
	});

	// Tests for the constructor of the Register asset
	describe('constructor', () =&gt; {
	    // Verify that the asset ID is equal to 1.
		it('should have valid id', () =&gt; {
			expect(transactionAsset.id).toEqual(1);
		});

		// Verify that the asset name equals `'register'`
		it('should have valid name', () =&gt; {
			expect(transactionAsset.name).toEqual('register');
		});

		// Verify that the correct asset schema is used
		it('should have valid schema', () =&gt; {
			expect(transactionAsset.schema).toMatchSnapshot();
		});
	});

	describe('validate', () =&gt; {
		describe('schema validation', () =&gt; {

			it('should throw error if ttl is set less than an hour', () =&gt; {
				const context = testing.createValidateAssetContext({
					asset: { name: 'nazar.hussain', ttl: 60 * 60 - 1, registerFor: 1 },
					transaction: { senderAddress: Buffer.alloc(0) } as any,
				});

				expect(() =&gt; transactionAsset.validate(context)).toThrow(
					'Must set TTL value larger or equal to 3600',
				);
			});

			it('should throw error if name is registered for less than a year', () =&gt; {
				const context = testing.createValidateAssetContext({
					asset: { name: 'nazar.hussain', ttl: 60 * 60, registerFor: 0 },
					transaction: { senderAddress: Buffer.alloc(0) } as any,
				});

				expect(() =&gt; transactionAsset.validate(context)).toThrow(
					'You can register name at least for 1 year.',
				);
			});

			it('should throw error if name is registered for more than 5 years', () =&gt; {
				const context = testing.createValidateAssetContext({
					asset: { name: 'nazar.hussain', ttl: 60 * 60, registerFor: 6 },
					transaction: { senderAddress: Buffer.alloc(0) } as any,
				});

				expect(() =&gt; transactionAsset.validate(context)).toThrow(
					'You can register name maximum for 5 year.',
				);
			});

			it('should throw error if domain contains invalid tld', () =&gt; {
				const context = testing.createValidateAssetContext({
					asset: { name: 'nazar.hussain', ttl: 60 * 60, registerFor: 1 },
					transaction: { senderAddress: Buffer.alloc(0) } as any,
				});

				expect(() =&gt; transactionAsset.validate(context)).toThrow(
					'Invalid TLD found "hussain". Valid TLDs are "lsk"',
				);
			});

			it('should be ok for valid schema', () =&gt; {
				const context = testing.createValidateAssetContext({
					asset: { name: 'nazar.lsk', ttl: 60 * 60, registerFor: 1 },
					transaction: { senderAddress: Buffer.alloc(0) } as any,
				});

				expect(() =&gt; transactionAsset.validate(context)).not.toThrow();
			});
		});
	});

	describe('apply', () =&gt; {
		let stateStore: StateStore;
		let account: any;

		beforeEach(() =&gt; {
			account = testing.fixtures.createDefaultAccount&lt;LNSAccountProps&gt;([LnsModule]);

			stateStore = new testing.mocks.StateStoreMock({
				accounts: [account],
			});

			jest.spyOn(stateStore.chain, 'get');
			jest.spyOn(stateStore.chain, 'set');
		});

		describe('valid cases', () =&gt; {
			it('should update the state store with nameahsh key', async () =&gt; {
				const name = 'nazar.lsk';
				const node = getNodeForName(name);
				const key = getKeyForNode(node);
				const context = testing.createApplyAssetContext({
					stateStore,
					asset: { name: 'nazar.lsk', ttl: 60 * 60, registerFor: 1 },
					transaction: { senderAddress: account.address } as any,
				});

				await transactionAsset.apply(context);

				expect(stateStore.chain.set).toHaveBeenCalledWith(key, expect.any(Buffer));
			});

			it('should update the state store with updated sender account', async () =&gt; {
				const name = 'nazar.lsk';
				const node = getNodeForName(name);
				const context = testing.createApplyAssetContext({
					stateStore,
					asset: { name: 'nazar.lsk', ttl: 60 * 60, registerFor: 1 },
					transaction: { senderAddress: account.address } as any,
				});
				await transactionAsset.apply(context);

				const updatedSender = await stateStore.account.get&lt;LNSAccountProps&gt;(account.address);

				expect(updatedSender.lns.ownNodes).toEqual([node]);
			});

			it('should update the state store with correct ttl value', async () =&gt; {
				const name = 'nazar.lsk';
				const node = getNodeForName(name);
				const context = testing.createApplyAssetContext({
					stateStore,
					asset: { name: 'nazar.lsk', ttl: 60 * 70, registerFor: 1 },
					transaction: { senderAddress: account.address } as any,
				});
				await transactionAsset.apply(context);

				const lsnObject = await getLNSObject(stateStore, node);

				expect(lsnObject?.ttl).toEqual(60 * 70);
			});

			it('should update the state store with correct expiry date', async () =&gt; {
				const name = 'nazar.lsk';
				const node = getNodeForName(name);
				const context = testing.createApplyAssetContext({
					stateStore,
					asset: { name: 'nazar.lsk', ttl: 60 * 70, registerFor: 2 },
					transaction: { senderAddress: account.address } as any,
				});
				const expiryTimestamp = Math.ceil(addYears(new Date(), 2).getTime() / 1000);

				await transactionAsset.apply(context);

				const lsnObject = await getLNSObject(stateStore, node);

				expect(lsnObject?.expiry).toBeGreaterThanOrEqual(expiryTimestamp);
			});
		});

		describe('invalid cases', () =&gt; {
			it('should throw error if name is already registered', async () =&gt; {
				const context = testing.createApplyAssetContext({
					stateStore,
					asset: { name: 'nazar.lsk', ttl: 60 * 60, registerFor: 1 },
					transaction: { senderAddress: account.address } as any,
				});

				await transactionAsset.apply(context);

				await expect(transactionAsset.apply(context)).rejects.toThrow(
					'The name "nazar.lsk" already registered',
				);
			});
		});
	});
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing-the-reverse-lookup-asset"><a class="anchor" href="#testing-the-reverse-lookup-asset"></a>Testing the Reverse Lookup asset</h3>
<div class="paragraph">
<p>The entire code for the tests of the Reverse Lookup asset is described below.
The majority of the code is self-explanatory, however, the most important parts of the tests are summarized here to provide a better overview:</p>
</div>
<div class="sect3">
<h4 id="testing-the-apply-function-2"><a class="anchor" href="#testing-the-apply-function-2"></a>Testing the apply() function</h4>
<div class="paragraph">
<p>Tests for the <a href="1-blockchain.html#state-change-2" class="xref page">apply() function</a> of the Reverse Lookup asset.</p>
</div>
<div class="paragraph">
<p>Write tests to check the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Valid cases:</p>
<div class="ulist">
<ul>
<li>
<p>It should update the lns reverse-lookup of the sender account with the given node if it is not already set.</p>
</li>
<li>
<p>It should update the lns reverse-lookup of the sender account with the given node even if it is already set.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Invalid cases:</p>
<div class="ulist">
<ul>
<li>
<p>It should throw an error if the node to set-lookup is not owned by the sender.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before each test:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new default account for the LNS application.</p>
</li>
<li>
<p>Add two registered names to the account: <code>john.lsk</code> and <code>doe.lsk</code>.</p>
</li>
<li>
<p>Add the newly created account to the <code>accounts</code> list of the <code>StateStore</code> mock.</p>
</li>
<li>
<p>Spy on the functions <code>stateStore.chain.get</code> and <code>stateStore.chain.set</code>.
This allows checking in the tests, if the respective functions have been called or not.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use of the SDK testing utilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>testing.createApplyAssetContext()</code>: Returns valid parameters for the <code>apply()</code> function.
If the function is called with an empty object, it returns the default parameters for the <code>apply()</code> function.
For the test, overwrite the default <code>asset</code> value (<code>undefined</code>), with a valid transaction asset for the Reverse Lookup asset.
Additionally, overwrite the default transaction value of the context (<code>undefined</code>), with a transaction containing a property <code>senderAddress</code> which equals the address of the newly created account.</p>
</li>
<li>
<p><code>testing.fixtures.createDefaultAccount&lt;LNSAccountProps&gt;([LnsModule])</code>:
Used to create a default account for the LNS application.</p>
</li>
<li>
<p><code>new testing.mocks.StateStoreMock({accounts: [account]})</code>:
Creates a mock for the StateStore.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="unit-tests-for-the-reverse-lookup-asset"><a class="anchor" href="#unit-tests-for-the-reverse-lookup-asset"></a>Unit tests for the Reverse Lookup asset</h3>
<div class="listingblock">
<div class="title">lisk-name-service/lns/test/unit/modules/lns/assets/reverse_lookup.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { chain, cryptography, StateStore, testing } from 'lisk-sdk';
import { ReverseLookupAsset } from '../../../../../src/app/modules/lns/assets/reverse_lookup';
import { LNSAccountProps } from '../../../../../src/app/modules/lns/data';
import { LnsModule } from '../../../../../src/app/modules/lns/lns_module';
import { getNodeForName } from '../../../../../src/app/modules/lns/storage';

describe('ReverseLookupAsset', () =&gt; {
	let transactionAsset: ReverseLookupAsset;

	beforeEach(() =&gt; {
		transactionAsset = new ReverseLookupAsset();
	});

	describe('constructor', () =&gt; {
		it('should have valid id', () =&gt; {
			expect(transactionAsset.id).toEqual(2);
		});

		it('should have valid name', () =&gt; {
			expect(transactionAsset.name).toEqual('reverse-lookup');
		});

		it('should have valid schema', () =&gt; {
			expect(transactionAsset.schema).toMatchSnapshot();
		});
	});

	describe('apply', () =&gt; {
		let stateStore: StateStore;
		let account: chain.Account&lt;LNSAccountProps&gt;;
		let ownNodes: Buffer[];

		beforeEach(() =&gt; {
			ownNodes = [getNodeForName('john.lsk'), getNodeForName('doe.lsk')];
			account = testing.fixtures.createDefaultAccount&lt;LNSAccountProps&gt;([LnsModule]);
			account.lns.ownNodes = ownNodes;

			stateStore = new testing.mocks.StateStoreMock({
				accounts: [account],
			});

			jest.spyOn(stateStore.chain, 'get');
			jest.spyOn(stateStore.chain, 'set');
		});

		describe('valid cases', () =&gt; {
			it('should update sender account lns reverse-lookup with given node if not already set', async () =&gt; {
				const context = testing.createApplyAssetContext({
					stateStore,
					asset: { name: 'john.lsk' },
					transaction: { senderAddress: account.address } as any,
				});
				await transactionAsset.apply(context);

				const updatedAccount = stateStore.account.get&lt;LNSAccountProps&gt;(account.address);

				expect((await updatedAccount).lns.reverseLookup).toEqual(ownNodes[0]);
			});

			it('should update sender account lns reverse-lookup with given node even if already set', async () =&gt; {
				account.lns.reverseLookup = cryptography.getRandomBytes(20);
				stateStore = new testing.mocks.StateStoreMock({
					accounts: [account],
				});
				const context = testing.createApplyAssetContext({
					stateStore,
					asset: { name: 'john.lsk' },
					transaction: { senderAddress: account.address } as any,
				});
				await transactionAsset.apply(context);

				const updatedAccount = stateStore.account.get&lt;LNSAccountProps&gt;(account.address);

				expect((await updatedAccount).lns.reverseLookup).toEqual(ownNodes[0]);
			});
		});

		describe('invalid cases', () =&gt; {
			it('should throw error if node to set-lookup is not owned by sender', async () =&gt; {
				const context = testing.createApplyAssetContext({
					stateStore,
					asset: { name: 'alpha.lsk' },
					transaction: { senderAddress: account.address } as any,
				});

				await expect(transactionAsset.apply(context)).rejects.toThrow(
					'You can only assign lookup node which you own.',
				);
			});
		});
	});
});</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-functional-tests"><a class="anchor" href="#writing-functional-tests"></a>Writing functional tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Functional_testing">Functional testing</a> is a quality assurance (QA) process and a type of black-box testing that bases its test cases on the specifications of the software component under test. Functions are tested by feeding them input and examining the output, and in this case the internal program structure is rarely considered (unlike white-box testing).
Functional testing is conducted to evaluate the compliance of a system or component with specified functional requirements.
Functional testing usually describes what the system does.</p>
</div>
<div class="paragraph">
<p>As a final exercise, write a functional test, that checks if a domain name was correctly resolved after calling the action <code>lns:resolveName</code>.</p>
</div>
<div class="paragraph">
<p>Create a new file <code>lns_modules.spec.ts</code> in the <code>test/network/</code> folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.
├── _setup.js
├── commands
├── integration
├── network
│   └── lns_modules.spec.ts
├── tsconfig.json
├── unit
│   └── modules
│       └── lns
│           ├── assets
│           │   ├── register.spec.ts
│           │   └── reverse_lookup.spec.ts
│           └── lns.spec.ts
└── utils</pre>
</div>
</div>
<div class="paragraph">
<p>The functional test should verify the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>resolveName</code> action of the LNS module.</p>
<div class="ulist">
<ul>
<li>
<p>It should throw an error on resolving a non-registered name.</p>
</li>
<li>
<p>It should resolve the name after registration.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before all tests:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new default environment for the LNS application.</p>
</li>
<li>
<p>Start the application of the application environment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use of the SDK testing utilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>testing.createDefaultApplicationEnv({ modules: [LnsModule] })</code>:
Creates a default application environment for the functional test.</p>
</li>
<li>
<p><code>testing.fixtures.createDefaultAccount([LnsModule], { address })</code>:
Creates a default account for the LNS application.</p>
</li>
<li>
<p><code>testing.fixtures.defaultFaucetAccount.passphrase</code>:
Use the passphrase of the default faucet account to send tokens from the faucet to the newly created default account.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="functional-tests-for-the-action-resolvename-of-the-lns-module"><a class="anchor" href="#functional-tests-for-the-action-resolvename-of-the-lns-module"></a>Functional tests for the action <code>resolveName</code> of the LNS module</h3>
<div class="listingblock">
<div class="title">lisk-name-service/lns/test/network/lns_modules.spec.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { cryptography, passphrase, testing, transactions } from 'lisk-sdk';
import { LnsModule } from '../../src/app/modules/lns/lns_module';

jest.setTimeout(150000);

describe('LnsModule', () =&gt; {
	let appEnv: testing.ApplicationEnv;

	beforeAll(async () =&gt; {
		appEnv = testing.createDefaultApplicationEnv({ modules: [LnsModule] });
		await appEnv.startApplication();
	});

	afterAll(async () =&gt; {
		jest.spyOn(process, 'exit').mockImplementation((() =&gt; {}) as never);
		await appEnv.stopApplication();
	});

	describe('actions', () =&gt; {
		describe('resolveName', () =&gt; {
			it('should throw error on resolving non-registered name', async () =&gt; {
				await expect(appEnv.ipcClient.invoke('lns:resolveName', { name: 'nazar' })).rejects.toThrow(
					'Name "nazar" could not resolve.',
				);
			});

			it('should resolve name after registration', async () =&gt; {
				// Create an account
				const accountPassphrase = passphrase.Mnemonic.generateMnemonic();
				const { address } = cryptography.getAddressAndPublicKeyFromPassphrase(accountPassphrase);
				const account = testing.fixtures.createDefaultAccount([LnsModule], { address });

				// Fund with some tokens
				let tx = await appEnv.ipcClient.transaction.create(
					{
						moduleName: 'token',
						assetName: 'transfer',
						asset: {
							recipientAddress: account.address,
							amount: BigInt(transactions.convertLSKToBeddows('100')),
							data: '',
						},
						fee: BigInt(transactions.convertLSKToBeddows('0.1')),
					},
					testing.fixtures.defaultFaucetAccount.passphrase,
				);
				await appEnv.ipcClient.transaction.send(tx);
				await appEnv.waitNBlocks(1);

				tx = await appEnv.ipcClient.transaction.create(
					{
						moduleName: 'lns',
						assetName: 'register',
						asset: {
							registerFor: 1,
							name: 'nazar.lsk',
							ttl: 36000,
						},
						fee: BigInt(transactions.convertLSKToBeddows('0.1')),
					},
					accountPassphrase,
				);
				await appEnv.ipcClient.transaction.send(tx);
				await appEnv.waitNBlocks(1);

				await expect(
					appEnv.ipcClient.invoke('lns:resolveName', { name: 'nazar.lsk' }),
				).resolves.toEqual(
					expect.objectContaining({
						name: 'nazar.lsk',
						ownerAddress: address.toString('hex'),
						ttl: 36000,
						records: [],
					}),
				);
			});
		});
	});
});</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="footerdiv">
    <p>© 2022 Lisk Foundation</p>
    <!-- <div class="community-section">
      <p class="community-section__text">Follow Lisk on: </p>
      <div class="community-section__icons"> -->
    <div class="community_icons">
        <a href="https://lisk.chat" title="Discord" target="_blank" class="footer_icon icon-discord"><p>Discord</p></a>
        <a href="https://dev.lisk.com" title="Discourse" target="_blank" class="footer_icon icon-discourse"><p>Discourse</p></a>
        <a href="https://github.com/LiskHQ" title="GitHub" target="_blank" class="footer_icon icon-github"><p>GitHub</p></a>
  <!--    </div> -->
    </div>
  </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script async src="../../../_/js/vendor/tabs-block-behaviour.js"></script>
<script async src="../../../_/js/vendor/swagger-ui.js"></script>
<script async src="../../../_/js/vendor/component-versions.js"></script>
<script src="../../../_/js/vendor/custom.js"></script>
  </body>
</html>
