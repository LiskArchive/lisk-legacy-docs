<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Testnet and Mainnet v4 migration guide :: Lisk documentation</title>
    <link rel="canonical" href="https://liskhq.github.io/lisk-docs/lisk-core/management/migration.html">
    <link rel="prev" href="configuration.html">
    <link rel="next" href="../core-cli.html">
    <meta name="generator" content="Antora 3.1.1">

<link id="theme" rel="stylesheet" title="Default" href="../../_/css/site.css">
<link rel="stylesheet" title="Dark" href="../../_/css/dark-site.css">

<script>var uiRootPath = '../../_'</script>
<script src="../../_/js/vendor/medium-zoom.js"></script>
<script type="text/javascript" id="Cookiebot" src="https://consent.cookiebot.com/uc.js" data-cbid="e4db29b5-cd94-4bcf-87e4-04f4ca564240" data-blockingmode="manual"></script>
<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://lisk.matomo.cloud/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '2']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src='//cdn.matomo.cloud/lisk.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->
<!-- Matomo Tag Manager -->
<script>
  var _mtm = window._mtm = window._mtm || [];
  _mtm.push({'mtm.startTime': (new Date().getTime()), 'event': 'mtm.Start'});
  var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
  g.async=true; g.src='https://cdn.matomo.cloud/lisk.matomo.cloud/container_RUW6y8yf.js'; s.parentNode.insertBefore(g,s);
</script>
<!-- End Matomo Tag Manager -->
<link rel="icon" href="../../_/img/favicon.png" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="top-logo">
        <a href="../.." class="lisk-logo"></a>
        <a href="../.." class="docs-logo"></a>
      </div>
      <!--<a class="navbar-item" href="https://liskhq.github.io/lisk-docs">Lisk documentation</a>-->
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">APIs</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="../../api/lisk-node-rpc.html">Lisk node RPC API</a>
            <a class="navbar-item" href="../../api/lisk-service-http.html">Lisk Service HTTP
              API</a>
            <a class="navbar-item" href="../../api/lisk-service-rpc.html">Lisk Service RPC
              API</a>
            <a class="navbar-item" href="../../api/lisk-service-pubsub.html">Lisk Service
              Pub/Sub API</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Explorers</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://lisk.observer/" target="_blank">Lisk Observer</a>
            <a class="navbar-item" href="https://liskscan.com/" target="_blank">LiskScan</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="../../lisk-sdk/">Lisk SDK</a>
            <a class="navbar-item" href="../../lisk-service/">Lisk Service</a>
            <a class="navbar-item" href="../../lisk-core/">Lisk Core</a>
            <a class="navbar-item" href="https://lisk.com/wallet" target="_blank">Lisk Wallets</a>
          </div>
        </div>
        <button onclick="switch_style('toggle')" id="theme-toggle" class="theme-toggle navbar-item"></button>
        <!-- <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div> -->
      </div>
    </div>
  </nav>
</header>
<div class="toolbar" role="navigation">
  <button class="nav-toggle"></button>
  <div class="components-versions">
      <div class="page-components">
    <button class="component-menu-toggle" title="Show other documentations">Lisk Core</button>
    <div class="component-menu">
        <a class="component is-current" href="../index.html">Lisk Core</a>
        <a class="component" href="../../lisk-docs-manual/index.html">Lisk docs manual</a>
        <a class="component" href="../../index.html">Lisk Documentation</a>
        <a class="component" href="../../lisk-sdk/index.html">Lisk SDK</a>
        <a class="component" href="../../lisk-service/index.html">Lisk Service</a>
    </div>
  </div>
    <span></span>
    <div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">4.0 (latest)</button>
  <div class="version-menu">
    <a class="version is-current" href="migration.html">4.0 (latest)</a>
    <a class="version" href="../v3/management/migration.html">3.1.1</a>
  </div>
</div>
  </div>
  <span></span>
  <span></span>
    <a href="../../index.html" class="home-link"></a>
  <nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Lisk Core</a></li>
    <li>Management</li>
    <li><a href="migration.html">Testnet and Mainnet v4 migration guide</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/LiskHQ/lisk-core/edit/development/docs/antora/modules/ROOT/pages/management/migration.adoc">Edit this Page</a></div>
</div>

<div class="body">
<div class="nav-container" data-component="lisk-core" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Lisk Core</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Lisk Core</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Setup</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../setup/npm.html">NPM setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../setup/binary.html">Binary setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../setup/docker.html">Docker setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../setup/source.html">Source code setup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Update</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../update/update-docker.html">Update Lisk Core (Docker)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Management</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuration.html">Configuration</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="migration.html">Testnet and Mainnet v4 migration guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../core-cli.html">Core CLI</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Lisk Core</span>
    <span class="version">4.0 (latest)</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Lisk Core</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">4.0 (latest)</a>
        </li>
        <li class="version">
          <a href="../v3/index.html">3.1.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../lisk-docs-manual/index.html">Lisk docs manual</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lisk-docs-manual/index.html">0.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../index.html">Lisk Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../index.html">default</a>
        </li>
        <li class="version">
          <a href="../../lisk-v3/index.html">lisk-v3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../lisk-sdk/index.html">Lisk SDK</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lisk-sdk/index.html">6.0 (latest)</a>
        </li>
        <li class="version">
          <a href="../../lisk-sdk/v5/index.html">5.3.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../lisk-service/index.html">Lisk Service</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lisk-service/index.html">0.7 (latest)</a>
        </li>
        <li class="version">
          <a href="../../lisk-service/v0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
      <h1 class="page">Testnet and Mainnet v4 migration guide</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide explains how to migrate a Lisk Core v3 node to Lisk Core v4 using the Lisk Migrator v2.</p>
</div>
<div class="paragraph">
<p>The Lisk migrator CLI will generate a new genesis block for Lisk Core v4.
The new genesis block is created based on a snapshot of the old blockchain (running on Lisk Core v3.1.0 or later) at a given height.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All active validators on the Lisk Mainnet and the Lisk Testnet need to follow this guide to correctly migrate their nodes to the new network, in order to not miss any blocks after the network hard fork.</p>
</div>
<div class="paragraph">
<p>Optionally, anyone running a Lisk Core v3.1.0 (or later) who is not an active validator can also participate in the migration process.
In this case, the following steps 2.4 and 2.5 in this guide can be skipped, as they are only relevant for the current validators.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#preparation">1. Preparation</a>
<ul class="sectlevel2">
<li><a href="#ensure-you-are-running-version-3-1-0-or-later-of-lisk-core">1.1. Ensure you are running version 3.1.0 (or later) of Lisk Core</a></li>
<li><a href="#setting-up-the-lisk-migrator">1.2. Setting up the Lisk Migrator</a>
<ul class="sectlevel3">
<li><a href="#download-the-migration-script">1.2.1. Download the migration script</a></li>
<li><a href="#download-the-checksum-and-verify">1.2.2. Download the checksum and verify</a></li>
<li><a href="#extract-and-add-to-path">1.2.3. Extract and add to PATH</a></li>
</ul>
</li>
<li><a href="#check-the-announced-snapshot-height">1.3. Check the announced snapshot height</a></li>
<li><a href="#ensure-lisk-core-v3-1-x-is-fully-synced-with-the-network">1.4. Ensure Lisk Core v3.1.x is fully synced with the network</a></li>
<li><a href="#open-ports">1.5. Open ports</a></li>
<li><a href="#run-lisk-migrator">1.6. Run lisk migrator</a></li>
</ul>
</li>
<li><a href="#migration-steps">2. Migration steps</a>
<ul class="sectlevel2">
<li><a href="#wait-until-the-network-reaches-the-snapshot-height">2.1. Wait until the network reaches the snapshot height</a></li>
<li><a href="#stop-lisk-core-v3-1-x">2.2. Stop Lisk Core v3.1.x</a></li>
<li><a href="#start-lisk-core-v4">2.3. Start Lisk Core v4</a></li>
<li><a href="#enable-block-generation-after-the-migration-for-validators">2.4. Enable block generation after the migration (for validators)</a>
<ul class="sectlevel3">
<li><a href="#allow-methods-in-the-node-config">2.4.1. Allow methods in the node config</a></li>
<li><a href="#create-the-validator-keys">2.4.2. Create the validator keys</a></li>
<li><a href="#import-the-validator-keys">2.4.3. Import the validator keys</a></li>
<li><a href="#set-the-hash-onion">2.4.4. Set the hash onion</a></li>
<li><a href="#import-validator-info-data">2.4.5. Import validator info data</a></li>
<li><a href="#enable-block-generation">2.4.6. Enable block generation</a></li>
</ul>
</li>
<li><a href="#register-legacy-validator-keys">2.5. Register legacy validator keys</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="preparation"><a class="anchor" href="#preparation"></a>1. Preparation</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">System requirements</div>
<div class="paragraph">
<p>The following system requirements are recommended for running the migration script:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Memory</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>minimum of 8GB  RAM</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Storage</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>minimum 40GB HDD</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">OS</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Ubuntu 20.04 LTS</p>
</li>
<li>
<p>Ubuntu 22.04 LTS</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Dependencies</div>
<div class="paragraph">
<p>The following dependencies are required for running the migration script:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Node.js</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Version 18 (LTS) installed via NVM</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Lisk Core</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Version 3.1.0 or later</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="ensure-you-are-running-version-3-1-0-or-later-of-lisk-core"><a class="anchor" href="#ensure-you-are-running-version-3-1-0-or-later-of-lisk-core"></a>1.1. Ensure you are running version 3.1.0 (or later) of Lisk Core</h3>
<div class="paragraph">
<p>Ensure you are running version 3.1.0 (or later) of Lisk Core to be able to seamlessly migrate to Lisk Core 4.0.0.</p>
</div>
<div class="paragraph">
<p>We <strong>recommend</strong> to install <strong>v3.1.1</strong> of Lisk Core, because it comes with the Mainnet snapshot height pre-configured. If using an existing data directory, kindly make sure to use the <code>--overwrite-config</code> flag when restarting the application.</p>
</div>
<div class="paragraph">
<p>Print the Lisk Core node info in the terminal, and check the value of <code>version</code>. Also, kindly ensure that the <code>backup.height</code> property is present and the corresponding value matches the announced migration height of 23390991.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-core node:info --pretty</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If your version is 3.1.0, please ensure to set <code>backup.height</code> to the announced snapshot height in your node config and restart the node with the <code>--overwrite-config</code> flag.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="setting-up-the-lisk-migrator"><a class="anchor" href="#setting-up-the-lisk-migrator"></a>1.2. Setting up the Lisk Migrator</h3>
<div class="sect3">
<h4 id="download-the-migration-script"><a class="anchor" href="#download-the-migration-script"></a>1.2.1. Download the migration script</h4>
<div class="paragraph">
<p>Navigate into the folder where you want to install the Lisk Migrator, and then download the migration script by running the following command in the terminal:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_linux-x64"></a>Linux x64</p>
</li>
<li>
<p><a id="tabset1_darwin-x64"></a>Darwin x64</p>
</li>
<li>
<p><a id="tabset1_darwin-arm64"></a>Darwin ARM64</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_linux-x64">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -o lisk-migrator-v2.0.1-linux-x64.tar.gz https://downloads.lisk.com/lisk-migrator/lisk-migrator-v2.0.1-linux-x64.tar.gz</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_darwin-x64">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -o lisk-migrator-v2.0.1-darwin-x64.tar.gz https://downloads.lisk.com/lisk-migrator/lisk-migrator-v2.0.1-darwin-x64.tar.gz</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_darwin-arm64">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -o lisk-migrator-v2.0.1-darwin-arm64.tar.gz https://downloads.lisk.com/lisk-migrator/lisk-migrator-v2.0.1-darwin-arm64.tar.gz</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="download-the-checksum-and-verify"><a class="anchor" href="#download-the-checksum-and-verify"></a>1.2.2. Download the checksum and verify</h4>
<div class="paragraph">
<p>Download the checksum and verify the successful download of the lisk-migrator.</p>
</div>
<div class="paragraph">
<p>A) Download the checksum.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_linux-x64"></a>Linux x64</p>
</li>
<li>
<p><a id="tabset2_darwin-x64"></a>Darwin x64</p>
</li>
<li>
<p><a id="tabset2_darwin-arm64"></a>Darwin ARM64</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_linux-x64">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -o lisk-migrator-v2.0.1-linux-x64.tar.gz.SHA256 https://downloads.lisk.com/lisk-migrator/lisk-migrator-v2.0.1-linux-x64.tar.gz.SHA256</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_darwin-x64">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -o lisk-migrator-v2.0.1-darwin-x64.tar.gz.SHA256 https://downloads.lisk.com/lisk-migrator/lisk-migrator-v2.0.1-darwin-x64.tar.gz.SHA256</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_darwin-arm64">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -o lisk-migrator-v2.0.1-darwin-arm64.tar.gz.SHA256 https://downloads.lisk.com/lisk-migrator/lisk-migrator-v2.0.1-darwin-arm64.tar.gz.SHA256</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>B) Run the following command in the terminal and ensure the output is <code>sha256sum: &lt;file name&gt;: OK</code></p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset3_linux"></a>Linux</p>
</li>
<li>
<p><a id="tabset3_darwin"></a>Darwin</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset3_linux">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sha256sum -c lisk-migrator-v2.0.1-linux-x64.tar.gz.SHA256</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset3_darwin">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sha -a 256 lisk-migrator-v2.0.1-linux-x64.tar.gz.SHA256</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="extract-and-add-to-path"><a class="anchor" href="#extract-and-add-to-path"></a>1.2.3. Extract and add to PATH</h4>
<div class="paragraph">
<p>Unpack it, and then add it to the system path, in order to use it in the terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tar -xf ./lisk-migrator-v2.0.1-linux-x64.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make the <code>lisk-migrator</code> command available in the PATH, e.g. by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export PATH="$PATH:$HOME/lisk-migrator/bin"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the <code>lisk-migrator</code> was extracted somewhere other than your home directory, replace <code>$HOME</code> with the absolute path of where the <code>lisk-migrator</code> folder is located.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="check-the-announced-snapshot-height"><a class="anchor" href="#check-the-announced-snapshot-height"></a>1.3. Check the announced snapshot height</h3>
<div class="ulist">
<ul>
<li>
<p>For Mainnet: 23390991<br>
For more information check the <a href="https://lisk.com/blog/posts/announcing-lisk-mainnet-v4-migration" target="_blank" rel="noopener">Mainnet migration announcement</a>.</p>
</li>
<li>
<p>For Testnet: 20449414<br>
For more information check the <a href="https://lisk.com/blog/posts/announcing-lisk-testnet-v4-migration" target="_blank" rel="noopener">Testnet migration announcement</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The height is needed by the <code>lisk-migrator</code> in the next step.
A snapshot of the blockchain will be created at this particular height, which will then be used to create the genesis block for the new blockchain.</p>
</div>
</div>
<div class="sect2">
<h3 id="ensure-lisk-core-v3-1-x-is-fully-synced-with-the-network"><a class="anchor" href="#ensure-lisk-core-v3-1-x-is-fully-synced-with-the-network"></a>1.4. Ensure Lisk Core v3.1.x is fully synced with the network</h3>
<div class="paragraph">
<p>Check the current block height of your node directly in the terminal by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-core node:info --pretty</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compare the current height of your node to the network height in <a href="https://lisk.com/wallet" target="_blank" rel="noopener">Lisk Desktop</a>, which is shown on the <kbd>Network</kbd> or <kbd>Blocks</kbd> pages.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To view the current height of the <strong>Lisk Testnet</strong>, use the network switcher of Lisk Desktop, which can be enabled in the settings.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, users can also verify the current height by comparing <code>data.height</code> in the response from the <a href="https://service.lisk.com/api/v2/network/status" class="bare" target="_blank" rel="noopener">https://service.lisk.com/api/v2/network/status</a> endpoint.</p>
</div>
<div class="paragraph">
<p>To directly check the current height via the command line, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl --silent https://service.lisk.com/api/v2/network/status | jq '.data.height'</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run the command, both <a href="https://curl.se/" target="_blank" rel="noopener">curl</a> and <a href="https://jqlang.github.io/jq/" target="_blank" rel="noopener">jq</a> are required to be installed.</p>
</div>
<div class="paragraph">
<p>If both heights are equal, it is verified that your node is fully synced with the network.</p>
</div>
</div>
<div class="sect2">
<h3 id="open-ports"><a class="anchor" href="#open-ports"></a>1.5. Open ports</h3>
<div class="paragraph">
<p>Open the necessary ports for Lisk Core v4.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you migrate the existing Lisk Core v3 config with the <code>--auto-migrate-config</code> flag in the next step <a href="#run-lisk-migrator">Run lisk migrator</a>, please ensure that the necessary ports in the final v4 config are open for communication.</p>
</div>
<div class="paragraph">
<p>The final config (when auto-migrating) is printed on the screen for the user&#8217;s confirmation. You can check for the exact port details there.
It should be the same that you were using with v3.
Ideally, they should already be open.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Node P2P communication</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ufw allow 7667</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Node API</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ufw allow 7887</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="run-lisk-migrator"><a class="anchor" href="#run-lisk-migrator"></a>1.6. Run lisk migrator</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<div class="title">When to start the migrator script?</div>
<p><code>lisk-migrator</code> can be started any time before the announced snapshot height.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have added the <code>lisk-migrator</code> to the PATH as described in the section <a href="#setting-up-the-lisk-migrator">Setting up the Lisk Migrator</a>, you can start the migration script by running the following command <sup class="footnote" id="_footnote_snap_footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> in the terminal:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset4_mainnet"></a>Mainnet</p>
</li>
<li>
<p><a id="tabset4_testnet"></a>Testnet</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset4_mainnet">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-migrator --snapshot-height 23390991 --auto-migrate-config --auto-start-lisk-core-v4</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset4_testnet">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-migrator --snapshot-height 20449414 --auto-migrate-config --auto-start-lisk-core-v4</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--snapshot-height</code>:
The height on which the blockchain snapshot will be performed.
The snapshot height will be announced separately.</p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
If you choose to specify custom output path with the <code>--output</code> flag, please don&#8217;t specify the default data directory for Lisk Core (<code>~/.lisk/lisk-core</code>) or any sub-directory within it, as it might lead to errors during the migration.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Custom data path</div>
<div class="paragraph">
<p>In case a custom <a href="../../lisk-sdk/config.html#system" class="xref page">dataPath</a> is defined in the config, that is different from the default path <code>~/.lisk/lisk-core</code>, then it is possible to define the data path with the <code>--lisk-core-v3-data-path</code> flag like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-migrator --snapshot-height 23390991 --lisk-core-v3-data-path ~/lisk/custom/path/  --auto-migrate-config --auto-start-lisk-core-v4</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Custom config</div>
<div class="paragraph">
<p>In case a <a href="../../build-blockchain/configuration.html#how-to-use-a-custom-configuration" class="xref page">custom config</a> is used for Lisk Core v3, then it is also possible to define the path to the custom config file with the <code>--config</code> flag like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-migrator --snapshot-height 23390991 --config=/path/to/config.json --auto-migrate-config --auto-start-lisk-core-v4</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Running the migrator in the background</div>
<div class="paragraph">
<p>It is possible to use tools such as <code>screen</code> to run the Lisk migrator in the background.</p>
</div>
<div class="paragraph">
<p>With <code>screen</code> you can detach the current terminal window into the background:</p>
</div>
<div class="listingblock">
<div class="title">Example (Mainnet) <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">screen -dmSL migration lisk-migrator --snapshot-height 23390991 --auto-migrate-config --auto-start-lisk-core-v4</code></pre>
</div>
</div>
<div class="paragraph">
<p>Shortly before the migration occurs, it is possible to reattach to the screen, in order to check if everything is working correctly.</p>
</div>
<div class="paragraph">
<p>First, check the name of the detached screen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">screen -ls</code></pre>
</div>
</div>
<div class="paragraph">
<p>This returns a list of all detached screens with <code>screen</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>There is a screen on:
	1842.migration	(05/07/2021 12:35:59 PM)	(Detached)
1 Socket in /run/screen/S-lisk.</pre>
</div>
</div>
<div class="paragraph">
<p>Use <code>screen -r</code> and the name of the detached screen you want to connect to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">screen -r 1842.migration</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migration-steps"><a class="anchor" href="#migration-steps"></a>2. Migration steps</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="wait-until-the-network-reaches-the-snapshot-height"><a class="anchor" href="#wait-until-the-network-reaches-the-snapshot-height"></a>2.1. Wait until the network reaches the snapshot height</h3>
<div class="paragraph">
<p>Observe if the <code>lisk-migrator</code> finishes successfully.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Expected migration duration</dt>
<dd>
<p>This can take <strong>~3 mins</strong> against the <strong>Testnet</strong>, and <strong>~5 mins</strong> against the <strong>Mainnet</strong>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The script will download and install Lisk Core v4 for you automatically.</p>
</div>
<div class="paragraph">
<p>The flag <code>--auto-migrate-config</code> will automatically migrate the config from the old to the new node.</p>
</div>
<div class="paragraph">
<p>After the snapshot height is reached, validators have approximately <strong>1 week</strong> to enable block generation, to ensure that they do not miss any blocks after the hard fork.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the node is not migrated, but started at a later point in time, it will simply sync to the current network height.
For validators, this might result in missing blocks.
For everyone else, it will not have any impact.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">How to verify a successful migration</div>
<div class="paragraph">
<p>To verify that the migrator created the correct new genesis block, compare the newly created genesis block with others by comparing the hash of the genesis block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">grep \"id\": ./lisk-migrator/output/4c09e6a781fc4c7bdb936ee815de8f94190f8a7519becd9de2081832be309a99/genesis_block.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>The hashes can be shared in the dedicated network channel on <a href="https://lisk.chat/" target="_blank" rel="noopener">lisk.chat</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="stop-lisk-core-v3-1-x"><a class="anchor" href="#stop-lisk-core-v3-1-x"></a>2.2. Stop Lisk Core v3.1.x</h3>
<div class="paragraph">
<p>After the <code>lisk-migrator</code> script has finished and the announced snapshot height has passed, there is no reason to continue running Lisk Core v3.1.x, and therefore it is recommended to stop it.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is important to stop Lisk Core v3 <strong>before</strong> starting Lisk Core v4.
If the migrator is started with <code>--auto-start-lisk-core-v4</code> flag, the user is prompted to verify that Lisk Core v3 is stopped - only afterwards, the migration script will continue.</p>
</div>
<div class="literalblock">
<div class="title">Prompt when</div>
<div class="content">
<pre>Please stop Lisk Core v3 to continue. Type 'yes' and press Enter when ready. [yes/no]: yes</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Users that have set something up to start Lisk Core on boot, whether it&#8217;s through <code>cron</code> or <code>systemd</code> or something else, should keep that in mind and adjust things accordingly so that Lisk Core 4.0.0 gets started instead of Lisk Core 3.1.x.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Last but not least, remove the folder with Lisk Core v3.1.x.</p>
</div>
</div>
<div class="sect2">
<h3 id="start-lisk-core-v4"><a class="anchor" href="#start-lisk-core-v4"></a>2.3. Start Lisk Core v4</h3>
<div class="paragraph">
<p>If you set the flag <code>--auto-start-lisk-core-v4</code> when running lisk-migrator, it will start Lisk Core v4 in the background (managed by PM2) right after successful migration.</p>
</div>
<div class="paragraph">
<p>Otherwise, start Lisk Core manually like so:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset5_mainnet"></a>Mainnet</p>
</li>
<li>
<p><a id="tabset5_testnet"></a>Testnet</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset5_mainnet">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-core start --network mainnet</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset5_testnet">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-core start --network testnet</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Observe the logs in the terminal, to verify the node is starting correctly.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To run Lisk Core in the background install PM2, as described in the guide <a href="../../run-blockchain/process-management.html" class="xref page">Process management with PM2</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can verify that the node is running correctly by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-core system:node-info --pretty</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check the value of <code>version</code> in the response, to verify you are running version 4.0.0 of Lisk Core.</p>
</div>
</div>
<div class="sect2">
<h3 id="enable-block-generation-after-the-migration-for-validators"><a class="anchor" href="#enable-block-generation-after-the-migration-for-validators"></a>2.4. Enable block generation after the migration (for validators)</h3>
<div class="paragraph">
<p>After migration, <strong>101 initial validators</strong> will be active to generate blocks during the <code>initRounds</code>.
All other validators will be banned during the bootstrap period.</p>
</div>
<div class="paragraph">
<p><code>initRounds</code> is the number of rounds for the bootstrap period of the new network.
The bootstrap period after migration to Core v4 is <strong>587 rounds</strong>.</p>
</div>
<div class="paragraph">
<p>The initial validators will be exactly the 101 validators that were in active positions in the Lisk Core v3 network, at the time of the migration.</p>
</div>
<div class="paragraph">
<p>For the initial validators, it will be important to enable block generation as soon as possible on the new node, to not miss any block rewards.</p>
</div>
<div class="paragraph">
<p>It is also important that a maximum number of validators participate in the network migration.
If only a small number of validators migrate their nodes, this can prolong the bootstrap period.
Additionally, for blocks to be finalized, enough of the active validators (minimum 68) need to participate in the migration process.</p>
</div>
<div class="paragraph">
<p>After 587 rounds, the normal Lisk PoS protocol will be followed to generate the list of active validators, but only for the validators who have <a href="#register-legacy-validator-keys">registered their validator keys</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
All migrated validators who <strong>did not register their keys</strong> until the bootstrap period ends will stay <strong>banned</strong>.
To be un-banned, a validator needs to <a href="#register-legacy-validator-keys">Register legacy validator keys</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="allow-methods-in-the-node-config"><a class="anchor" href="#allow-methods-in-the-node-config"></a>2.4.1. Allow methods in the node config</h4>
<div class="paragraph">
<p>To be able to run certain validator-related commands of the node, it is required to enable security-sensitive methods in the node config.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you used the migrator with the <code>--auto-start-lisk-core-v4</code> flag, it is not necessary to update the config, as it is already done by the migrator.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">config.json</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "rpc": {
    "modes": ["ipc"],
    "allowedMethods": ["generator", "system", "random"]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Restart the node with the <code>--overwrite-config</code> flag, to load the updated configuration.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>allowedMethods</code> refers to the <code>method</code> defined in the <a href="https://www.jsonrpc.org/specification" target="_blank" rel="noopener">JSON-RPC specification</a>.</p>
</div>
<div class="paragraph">
<p>Add the <code>namespace</code>, to allow all endpoints of <code>namespace</code>, or <code>namespace_endpointName</code> to allow a specific endpoint.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="create-the-validator-keys"><a class="anchor" href="#create-the-validator-keys"></a>2.4.2. Create the validator keys</h4>
<div class="paragraph">
<p>It is possible to generate all relevant validator keys to enable block generation from the account passphrase.</p>
</div>
<div class="paragraph">
<p>To do so, use the command <a href="../../lisk-sdk/client-cli.html#keyscreate" class="xref page">keys:create</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The flag <code>--add-legacy</code> is only available in Lisk Core v4.0.0 or later.
</td>
</tr>
</table>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset6_mainnet"></a>Mainnet</p>
</li>
<li>
<p><a id="tabset6_testnet"></a>Testnet</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset6_mainnet">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-core keys:create --chainid 0 --output ./config/keys.json --add-legacy</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset6_testnet">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-core keys:create --chainid 1 --output ./config/keys.json --add-legacy</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Next, you will be prompted for the validator <strong>passphrase</strong>, and it will also ask for a <strong>password</strong>, in order to symmetrically encrypt the passphrase for the config.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>? Please enter passphrase:  [hidden]
? Please re-enter passphrase:  [hidden]
? Please enter password:  [hidden]
? Please re-enter password:  [hidden]</pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The password is sensitive information.
Store the password used here for the encryption somewhere safe.
It will be required every time to enable block generation, in order to decrypt the generator keys on the node.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will generate the following file, which includes all important keys for the validator account:</p>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div class="listingblock">
<div class="title">config/keys.json</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "keys": [
    {
      "address": "lskqaxxmj78frvgpjgwvf4yqjjkcrr9yhn2sxxwm3",
      "keyPath": "legacy",
      "publicKey": "6290c8b58de8b71fedb7e3cb9a6ee9426aa3e7ac0141f278526375d46705b546",
      "privateKey": "759305903f7bbb449cf2fd22e6da476792b63e24558e266a4859f9ed3c91fd7e6290c8b58de8b71fedb7e3cb9a6ee9426aa3e7ac0141f278526375d46705b546",
      "plain": {
        "generatorKeyPath": "m/25519'/134'/0'/0'",
        "generatorKey": "aaecd278a3fadc40a4a824d6f4aa24547d8fb9d075ec4d6967a7084f9a3f2541",
        "generatorPrivateKey": "81316f0582fd2cc0a651318aa0041ce36e7b786033b98ec545ec04078fad67caaaecd278a3fadc40a4a824d6f4aa24547d8fb9d075ec4d6967a7084f9a3f2541",
        "blsKeyPath": "m/12381/134/0/0",
        "blsKey": "815a9e7643cf2bace98d1337f1dca8e39949592cd3fcb79bf3ab5784981468b9987b3340527bc9ca263a2fd061812024",
        "blsProofOfPosession": "add8669bb57f3dceec04dc0f875906cb52a677f1df911536c01f447c8830bf27cd43713af18d84de5a64ec504aeaf9a30521c09438bb5a4d5fd634946c65e0fc4ea3681fdb4f6949cb6c1bc1ac1ddec3df058a13466af5a13d50737938fd7d5f",
        "blsPrivateKey": "36506a53431665265ee03d7e19a5d44db3ff159d9aeee05727a8b24abc67651a"
      },
      "encrypted": {
        "ciphertext": "c3009d4a505ac32a652ffce6aa718073c7ca75b00578420ba20c2533a83f38e2b3e20cf1d6f0c9905efe28b5276142b93fdbdd33134d37bcd2db23654da92bb2becd00971c49ecc749100748c93344477ea52f6073c3fefec7234962d0eccdaa6862d9d0da46dbfe85cef98ad6cab0f2c1cb1b54326617132bb950d1c14a774a1e6403e8fa1bf3a2c7c0d6856266cf738f41ac01b2217d93070c4079e1b82044d3a692ea225290c2b6bcb902e0ffb8132f4c0f29325e6a3a",
        "mac": "2b3c65d0385a870ab499dfcddf411347506671015f412b35600153b132a455ea",
        "kdf": "argon2id",
        "kdfparams": {
          "parallelism": 4,
          "iterations": 1,
          "memorySize": 2024,
          "salt": "a5598628001346f608b3f57dd38b8611"
        },
        "cipher": "aes-256-gcm",
        "cipherparams": {
          "iv": "683600a199d154e51c0f97e6",
          "tag": "32807058f7f89921b4839fc39256cd24"
        },
        "version": "1"
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</details>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The generated keys are very sensitive information.</p>
</div>
<div class="paragraph">
<p>Especially the non-encrypted values need to be treated <strong>as equally sensitive as the passphrase for an account.</strong>
So after the keys are imported in step <a href="#import-the-validator-keys">Import the validator keys</a>, make sure to store the file somewhere safe, or delete the file completely.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="import-the-validator-keys"><a class="anchor" href="#import-the-validator-keys"></a>2.4.3. Import the validator keys</h4>
<div class="paragraph">
<p>After creating the validator keys as suggested in the  <a href="#create-the-validator-keys">Create the validator keys</a> section, the next step is to import them into the node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-core keys:import --file-path config/keys.json</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="set-the-hash-onion"><a class="anchor" href="#set-the-hash-onion"></a>2.4.4. Set the hash onion</h4>
<div class="paragraph">
<p>Without the hash onion, a validator won&#8217;t be able to receive any rewards for generating new blocks, although the blocks would still be valid in that case.
To not miss any rewards, it is of high interest for a validator to set the hash onion, before enabling block generation on the node.</p>
</div>
<div class="paragraph">
<p>Set the hash-onion by invoking the <a href="../../api/module-rpc-api/random-endpoints.html#random_sethashonion" class="xref page">setHashOnion</a> endpoint via the <a href="../core-cli.html#endpointinvoke" class="xref page">endpoint:invoke</a> CLI command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-core endpoint:invoke random_setHashOnion '{"address":"lskqaxxmj78frvgpjgwvf4yqjjkcrr9yhn2sxxwm3"}'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="import-validator-info-data"><a class="anchor" href="#import-validator-info-data"></a>2.4.5. Import validator info data</h4>
<div class="paragraph">
<p>Look in the output directory of the lisk-migrator for a file called <code>forgingStatus.json</code> (the specific location will be in the migrator output), this will contain the valid validator info data to enable block generation on the Lisk Core v4 node.</p>
</div>
<div class="literalblock">
<div class="title">Migrator output example</div>
<div class="content">
<pre>Finished exporting forging status to /root/lisk-migrator/output/15f0dacc1060e91818224a94286b13aa04279c640bd5d6f193182031d133df7c/forgingStatus.json</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Alternative option in the event of data loss</div>
In case the validator info data is lost, the validator can use the <strong>snapshot height</strong> for <code>height</code>, <code>maxHeightPrevoted</code> and <code>maxHeightGenerated</code> to enable block generation safely.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The v3 forging info data corresponds to the v4 validator info data in the following way:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>height</code> &#8594; <code>height</code></p>
</li>
<li>
<p><code>maxHeightPrevoted</code> &#8594; <code>maxHeightPrevoted</code></p>
</li>
<li>
<p><code>maxHeightPreviouslyForged</code> &#8594; <code>maxHeightGenerated</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To import the validator info data, invoke the endpoint <code>generator_setStatus</code> like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-core endpoint:invoke generator_setStatus '{ "address": "lskbgyrx3v76jxowgkgthu9yaf3dr29wqxbtxz8yp", "height": 20432255, "maxHeightGenerated": 20432207, "maxHeightPrevoted": 20432159 }' --pretty</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable-block-generation"><a class="anchor" href="#enable-block-generation"></a>2.4.6. Enable block generation</h4>
<div class="paragraph">
<p>Now, it is possible to enable block generation on the new node for your validator by using the <a href="../core-cli.html#generatorenable" class="xref page">generator:enable</a> command of the Lisk Core CLI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-core generator:enable lskqaxxmj78frvgpjgwvf4yqjjkcrr9yhn2sxxwm3 --use-status-value</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace the address <code>lskqaxxmj78frvgpjgwvf4yqjjkcrr9yhn2sxxwm3</code> with your validator address, the <code>--use-status-value</code> flag will use the validator info data that was imported in the previous step <a href="#import-validator-info-data">Import validator info data</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Don&#8217;t use zeros as validator info data!</div>
<div class="paragraph">
<p>If the validator already generated blocks with Lisk Core v3, they need to use their current validator info data.
The validator info data is migrated during the migration process, and can directly be used to enable block generation on the v4 node.</p>
</div>
<div class="paragraph">
<p>To directly set the values, use the <code>--use-status-value</code> flag, or set the values manually as described below.</p>
</div>
<div class="paragraph">
<p>For setting the values manually, first get the data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-core generator:status --pretty</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then set the values manually by adding the relevant flags:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-core generator:enable lskqaxxmj78frvgpjgwvf4yqjjkcrr9yhn2sxxwm3 --height=123 --max-height-generated=101 --max-height-prevoted=101</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="register-legacy-validator-keys"><a class="anchor" href="#register-legacy-validator-keys"></a>2.5. Register legacy validator keys</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">This step is crucial for migrating validators!</div>
As already mentioned, all non-initial validators will be <strong>banned</strong> during the bootstrap period.
The registration of the legacy validator keys has to be done at the <strong>latest by the end of <code>initRounds</code></strong>, to be eligible to generate blocks in the new network.
Otherwise, the validator will continue to be banned on the network, until the validator keys are registered in the legacy module.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To register the legacy validator keys with the new node, create a new <code>registerKeys</code> transaction like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lisk-core transaction:create legacy registerKeys 400000 --key-derivation-path=legacy --send</code></pre>
</div>
</div>
<div class="paragraph">
<p>It will ask you for the required parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>? Please enter passphrase:  [hidden]
? Please enter: blsKey:
? Please enter: proofOfPossession:
? Please enter: generatorKey:</pre>
</div>
</div>
<div class="paragraph">
<p>The required parameters can be obtained from the <code>keys.json</code> file, which was created in step <a href="#create-the-validator-keys">Create the validator keys</a> previously.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To send transactions from multisignature accounts, please follow the instructions <a href="../../integrate-blockchain/multisignature-accounts-and-transactions.html#how-to-create-a-multi-signature-transaction" class="xref page">here</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The migration of Lisk Core from v3 to v4 is now completed.</p>
</div>
<div class="paragraph">
<p>If you have specific questions regarding the process or need additional support, please reach out in the dedicated community channels, like <a href="https://lisk.chat/" class="bare" target="_blank" rel="noopener">https://lisk.chat/</a>.</p>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Snap versions of Lisk Core store everything in <code>~/snap/lisk-core/current/.lisk/lisk-core</code> instead of <code>~/.lisk/lisk-core</code>
</div>
</div>
  <nav class="pagination">
  <span class="prev"><a href="configuration.html">Configuration</a></span>
  <span class="next"><a href="../core-cli.html">Core CLI</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="footerdiv">
    <p> 2023 Lisk Foundation</p>
    <!-- <div class="community-section">
      <p class="community-section__text">Follow Lisk on: </p>
      <div class="community-section__icons"> -->
    <div class="community_icons">
      <a href="https://lisk.chat" title="Discord" target="_blank" class="footer_icon icon-discord"><p>Discord</p></a>
      <a href="https://dev.lisk.com" title="Discourse" target="_blank" class="footer_icon icon-discourse"><p>Discourse</p></a>
      <a href="https://github.com/LiskHQ" title="GitHub" target="_blank" class="footer_icon icon-github"><p>GitHub</p></a>
      <!--    </div> -->
    </div>
  </div>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/glossary.js"></script>
<script async src="../../_/js/vendor/tabs-block-behaviour.js"></script>
<script async src="../../_/js/vendor/swagger-ui.js"></script>
<script async src="../../_/js/vendor/component-versions.js"></script>
<script src="../../_/js/vendor/custom.js"></script>

  </body>
</html>
