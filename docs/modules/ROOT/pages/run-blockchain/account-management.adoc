= Managing accounts
Mona Bärenfänger <mona@lightcurve.io>
:description: How to create and manage accounts including creating and sending transactions, transferring tokens & voting.
// Settings
:idprefix:
:idseparator: -
:toc: preamble
//URLs
:url_wiki_Ed25519: https://en.wikipedia.org/wiki/EdDSA#Ed25519
:url_rfc8032: https://datatracker.ietf.org/doc/html/rfc8032#section-5.1.5
:url_lisk_wallet: https://lisk.com/wallet
:url_github_bip_39: https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki#generating-the-mnemonic
:url_github_bip_173: https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki
:url_github_lip_18: https://github.com/LiskHQ/lips/blob/master/proposals/lip-0018.md
:url_github_lip_66_getprivatekeyfromphraseandpath: https://github.com/LiskHQ/lips/blob/main/proposals/lip-0066.md#getprivatekeyfromphraseandpath

// Project URLs
:url_core_cli: v4@lisk-core::core-cli.adoc
:url_sdk_cli: v6@lisk-sdk::client-cli.adoc
:url_sdk_keyscreate: {url_sdk_cli}#keyscreate

====
On this page, you'll learn how to  manage your account directly from the command-line with the CLI of a Lisk node.

Specifically, you'll learn about:

* [x] The different credentials for an account
* [x] How to create new account credentials
* [x] How to manage multiple accounts with a single passphrase
* [x] How to initialize a new account on the blockchain
* [x] How safely manage account credentials
====

TIP: If you prefer a graphical user interface to manage your account, it is possible to use supported wallets like {url_lisk_wallet}[Lisk Wallet^].

== Overview of the account credentials

.General account credentials
[cols="1,1,3",options="header",stripes="hover"]
|===
|Name
|Example
|Description

|`passphrase`
|"anger system news one finger rifle kiss expect arena swift spirit decline"
|A 12 word mnemonic passphrase.
Human-readable representation of the `privateKey`.

|`keyPath`
|"m/44'/134'/0'"
|<<managing-multiple-accounts-with-a-single-passphrase,Key derivation>> allows multiple key pairs to be derived from the same secret recovery phrase.


|`address`
|lsk7dqp2w7447pqhuzmh
xsxr65qeoq7nbfox28wxc
a|The address is the main identifier of the account and the human-readable representation of the `publicKey`.
For example, it is used to identify the recipient when transferring the balance between users.

Depending on the context, the address is represented in <<account-address-formats,different formats>>.


|`publicKey`
|0ca6a5d44cc366de186a2589
e3e51849272fa0ae9c526467
66ddb7820dfe770c
|{url_wiki_Ed25519}[Ed25519^] public key

|`privateKey`
|bd7e42529df375cb9133ddf2
99641d38975fa4d0930eff6e
7c072d4d3ff190830ca6a5d4
4cc366de186a2589e3e51849
272fa0ae9c52646766ddb782
0dfe770c
|{url_wiki_Ed25519}[Ed25519^] private key

|===

.Credentials required for block generation
[cols="1,1,4",options="header",stripes="hover"]
|===
|`generatorKeyPath`
|"m/25519'/134'/0'/0'"
|description

|`generatorKey`
|e59f2f603b84b9c491e2672
40a3425a09adaad348b984cc
6e21c14fd02f28e7e
|To be able to create block signatures, the secret key of the validator account needs to be accessible for a validator node.
The most common approach is to store the encrypted secret recovery phrase that yields the secret key (or the encrypted secret key) on the node, where the encryption key is derived from a password-based key derivation function.
This results in a small security risk: If an attacker is able to get the encrypted secret recovery phrase (or encrypted secret key) and the password for the encryption key derivation, the attacker has full control over the validator account.
This may be a bigger concern for validators running a Lisk node on a remote data center.
To mitigate this risk, an extra key pair, the generator keys, is added to a validator account that is used for creating block signatures.
A validator node only requires access to the secret generator key, but not to the secret that is used for signing transactions.

|`generatorPrivateKey`
|398a04e2a001dc4580bb1fa
b2c6e71dbbbd81c9f22170e
1073cd4084d81588f4e59f2
f603b84b9c491e267240a34
25a09adaad348b984cc6e21
c14fd02f28e7e
|description

|`blsKeyPath`
|"m/12381/134/0/0"
|description

|`blsKey`
|95c7a571ecf569f91f6995
f9a8d8a2e70904cb079350
372b66d8a2b6986788f6d4
589c79fffefd952debc96a
17317e18
|Required for validator registration:
Validators will be required to register their BLS public key on-chain, while performing a validator registration.

|`blsProofOfPossession`
|a02f2672621b3adcd25079
c6646e751517c514c70d11
ec4ec4846310f5f7cddedd
598ade849496bcfe15d3ba
a554d06b148a2e9f2d349e2
010df2a17d7a3d57f13ab9b
f290042c552d47d925c0877
596ca8865b96ba2972eea5c
e7831b014cca
|description

|`blsPrivateKey`
|4ce94d4439152ec5e0ae
88a5c77c12cf0b5d9304
111359c5f42b49050342
9c26
|description

|===

== Key pair and address creation

A *private key* is derived, as defined in {url_rfc8032}[RFC 8032^], from a {url_github_bip_39}[BIP 39^] *mnemonic passphrase* and a <<key-derivation-path>>.

.Generating multiple private keys from 1 passphrase with key derivation
image::run-blockchain/key_derivation.png[addressCreation]

NOTE: Any of the child keys could be used to create an {url_wiki_Ed25519}[Ed25519^] private key, but by default, only the child key at the end of the path is used to create the Ed25519 private key.

The corresponding *public key* can then be obtained following the key generation section of {url_rfc8032}[RFC 8032^].

Finally, the *address* is generated by taking the first 20 bytes of the SHA-256 hash of the public key.

=== Key Derivation path

The *key derivation path* allows to derive a specific key from within a tree of keys.

The derivation path is an array of non-negative integers smaller than 2^32.
To make it easier to read a derivation path, they are often written in a form that omits a large constant.
For example, the path 44'/134'/0' (notice the apostrophe after each number) represents the array [44+2^31, 134+2^31, 2^31].

The whole derivation path is then written m/44'/134'/0', indicating that we start by deriving a master key before deriving successive child keys.

=== Creating a new passphrase

A 12 word mnemonic passphrase is required as an input to generate all corresponding account credentials for an account.

You may choose the passphrase for yourself, or generate a new random passphrase.

The node CLI can be utilized to auto-generate the passphrase quickly from the command-line.

First, start the console:

[tabs]
=====
Lisk Core::
+
--
[source,bash]
----
lisk-core console
----
--
Lisk app::
+
--
[source,bash]
----
./bin/run console
----
--
=====

Generate a new mnemonic passphrase using the Lisk Passphrase library:

----
 > lisk.passphrase.Mnemonic.generateMnemonic()
----

This will return a randomly generated 12 word mnemonic passphrase.

----
'anger system news one finger rifle kiss expect arena swift spirit decline'
----

=== Creating the other credentials

Next, use the xref:{url_sdk_keyscreate}[keys:create] command to generate all relevant account credentials:

IMPORTANT: Creation of new account credentials always happens off-chain.
To put the new account on-chain, it is necessary to <<initializing-a-new-account,initialize>> the new account by sending some initial tokens to the address and paying the account initialization fee.

[tabs]
=====
Lisk Core::
+
--
[source,bash]
----
lisk-core keys:create
----
--
Lisk app::
+
--
[source,bash]
----
./bin/run keys:create
----
--
=====

When asked for the passphrase, enter the passphrase created in step <<creating-a-new-passphrase>>.

----
? Please enter passphrase:  [hidden]
? Please re-enter passphrase:  [hidden]
----

Next, you will be also asked for a password.
This password will be used to encrypt your account credentials symmetrically.

The encrypted credentials are used for example in the config, when the node needs account information to generate new blocks for a validator.

TIP: If you don't wish to encrypt your credentials, it is possible to skip this step by adding the `--no-encryption` flag to the `keys:create` command.

The password will be required everytime the credentials need to be decrypted, for example when enabling block generation on a node.
Therefore, the password should be saved and kept at a secure place, similar to the passphrase of the account.

----
? Please enter password:  [hidden]
? Please re-enter password:  [hidden]
----

This will then return the credentials for the account:

.Example output
[%collapsible]
====
[source,json]
----
{
  "keys": [
    {
      "address": "lsk7dqp2w7447pqhuzmhxsxr65qeoq7nbfox28wxc",
      "keyPath": "m/44'/134'/0'",
      "publicKey": "0ca6a5d44cc366de186a2589e3e51849272fa0ae9c52646766ddb7820dfe770c",
      "privateKey": "bd7e42529df375cb9133ddf299641d38975fa4d0930eff6e7c072d4d3ff190830ca6a5d44cc366de186a2589e3e51849272fa0ae9c52646766ddb7820dfe770c",
      "plain": {
        "generatorKeyPath": "m/25519'/134'/0'/0'",
        "generatorKey": "e59f2f603b84b9c491e267240a3425a09adaad348b984cc6e21c14fd02f28e7e",
        "generatorPrivateKey": "398a04e2a001dc4580bb1fab2c6e71dbbbd81c9f22170e1073cd4084d81588f4e59f2f603b84b9c491e267240a3425a09adaad348b984cc6e21c14fd02f28e7e",
        "blsKeyPath": "m/12381/134/0/0",
        "blsKey": "95c7a571ecf569f91f6995f9a8d8a2e70904cb079350372b66d8a2b6986788f6d4589c79fffefd952debc96a17317e18",
        "blsProofOfPossession": "a02f2672621b3adcd25079c6646e751517c514c70d11ec4ec4846310f5f7cddedd598ade849496bcfe15d3baa554d06b148a2e9f2d349e2010df2a17d7a3d57f13ab9bf290042c552d47d925c0877596ca8865b96ba2972eea5ce7831b014cca",
        "blsPrivateKey": "4ce94d4439152ec5e0ae88a5c77c12cf0b5d9304111359c5f42b490503429c26"
      },
      "encrypted": {
        "ciphertext": "5cc26d74c2b6ed7d56a1268eb04cd3878190695bd2546bca82885cc5d7171d71e397cab265544436d9feadd143e17deeeb5f32a00e6d6cf8d0e64afc5475067875a6836a5c7f78d3e0b4937c464817f40359c869bd0b01762a18169296774d1c76821a752e53dc96390c27a15ba8b1b3eef7016335dabcef424ed0dd3bf972f89451d2ea8db113b310e9ecda7ea3a044c68e4dc57f8c992e84729c62f952c7c24688f375b39311ef069d8a2ccde6c272ce65645839da3dfb",
        "mac": "ebdb87bb0be482ea6ec867bb3355d3c9aece28520d56d7b1c17463dc06e1eb97",
        "kdf": "argon2id",
        "kdfparams": {
          "parallelism": 4,
          "iterations": 1,
          "memorySize": 2024,
          "salt": "63092ee970b05d28017a606c39ff799b"
        },
        "cipher": "aes-256-gcm",
        "cipherparams": {
          "iv": "1a188eb0d5eab9eca50b7b3c",
          "tag": "2578354b532bec4485eeb7123c27f855"
        },
        "version": "1"
      }
    }
  ]
}
----
====

== Managing multiple accounts with a single passphrase

Key derivation allows multiple key pairs to be derived from the same secret passphrase as a tree of keys.

This means, a user can manage multiple different accounts, while they only need to remember a single passphrase.

To generate multiple accounts from the same passphrase, use the `--count` flag of the `keys:create` command, and set it to the number of accounts that you wish to create.

The key path for the new accounts will always start with the default key-derivation path and increment by +1 onwards.
If you wish to start from a different key path, you can specify an `--offset`.

[tabs]
=====
Lisk Core::
+
--
[source,bash]
----
lisk-core keys:create --passphrase your-passphrase --no-encrypt --count 2 --offset 1
----
--
Lisk app::
+
--
[source,bash]
----
./bin/run keys:create --passphrase your-passphrase --no-encrypt --count 2 --offset 1
----
--
=====

The same passphrase is used for every account, the only thing that will change is the <<key-derivation-path>>, for example when signing transactions.

[NOTE]
====
If a user uses the *default key-derivation path* `m/44'/134'/0`, it is not necessary to mention it as a parameter when the account credentials are requested.

If you are using a custom key-derivation path, make sure to always specify the key derivation path when providing the passphrase.
For example, for the `transaction:create` command, the key derivation path can be specified like so:

 % ./bin/run transaction:create hello createHello 10000000 --key-derivation-path="m/44'/134'/1'" --params='{"message":"Hello world!"}'

====

== Initializing a new account

How to initialize a new account in the network

== Account address formats

Format examples and explanations for what it is used


=== Lisk32 representation
The Lisk32 address representation provides a user-friendly address format for frontends.
whereby each address starts with the prefix “lsk" and a checksum is appended

The *Lisk32 representation* displays addresses as a checksum with the "lsk" prefix to prevent accidental typing mistakes..
The procedure to obtain the Lisk32 representation of an <<hexadecimal-representation>> of an address is as follows:

. Calculate a 30-bit checksum of the address of the account using a BCH code, see {url_github_bip_173}[BIP173].
This step provides protection against accidental typing mistakes.
. Concatenate the address and the output of step 1.
. Encode the output of step 2 in a custom Base32 format, see {url_github_lip_18}[LIP 0018] for details.
Lower-case letters and digits are used, the characters i, l, 1 and 0 are removed for usability reasons.
. Add the prefix "lsk" to the output of step 3.

NOTE: The Lisk32 representation always tarts with "lsk" and the final address is 41 characters long.

As an example, the address `0xc247a42e09e6aafd818821f75b2f5b0de47c8235` has the Lisk32 representation `lsk24cd35u4jdq8szo3pnsqe5dsxwrnazyqqqg5eu`.

=== Hexadecimal representation

== Key Management
There are two recommended ways to manage the account keys, depending on the use case:

.Account credentials
[cols="1,2",options="header",stripes="hover"]
|===
|Key management method
|Use Case

|Using a secret passphrase
|For users that need their key pair only on local machines, e.g., for singing transactions.
Requires to remember or store secretly a secret recovery phrase and a password, but does not require to store and backup any encrypted data locally.

|Storing the encrypted secret key
|For users that need the key pair only on some remote server, e.g., a validator node on a remote data center.
Requires to store and backup an encrypted file, but needs to remember or secretly store only one password.
|===
