= Managing accounts
Mona Bärenfänger <mona@lightcurve.io>
:description: How to create and manage accounts including creating and sending transactions, transferring tokens & voting.
// Settings
:idprefix:
:idseparator: -
:toc: preamble
//URLs
:url_wiki_Ed25519: https://en.wikipedia.org/wiki/EdDSA#Ed25519
:url_eip2334: https://eips.ethereum.org/EIPS/eip-2334
:url_eip2333: https://eips.ethereum.org/EIPS/eip-2333
:url_rfc8032: https://datatracker.ietf.org/doc/html/rfc8032#section-5.1.5
:url_lisk_wallet: https://lisk.com/wallet
:url_github_bip_39: https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki#generating-the-mnemonic
:url_github_bip_173: https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki
:url_github_lip_18: https://github.com/LiskHQ/lips/blob/master/proposals/lip-0018.md
:url_github_lip_66_getprivatekeyfromphraseandpath: https://github.com/LiskHQ/lips/blob/main/proposals/lip-0066.md#getprivatekeyfromphraseandpath

// Project URLs
:url_core_cli: v4@lisk-core::core-cli.adoc
:url_sdk_cli: v6@lisk-sdk::client-cli.adoc
:url_sdk_keyscreate: {url_sdk_cli}#keyscreate

====
On this page, you'll learn how to  manage your account directly from the command-line with the CLI of a Lisk node.

Specifically, you'll learn about:

* [x] The different credentials for an account
* [x] How to create new account credentials
* [x] How to create multiple accounts with a single passphrase
* [x] How a new account is initialized on the blockchain
* [x] Methods to manage account credentials
====

TIP: If you prefer a graphical user interface to manage your account, it is possible to use supported wallets like {url_lisk_wallet}[Lisk Wallet^].

== Overview of the account credentials

.General account credentials
[cols="1,1,3",options="header",stripes="hover"]
|===
|Name
|Example
|Description

|`passphrase`
|"anger system news one finger rifle kiss expect arena swift spirit decline"
|Human-readable representation of the `privateKey`.
A 12 word mnemonic passphrase.
Together with the `keyPath`, it identifies an account on the blockchain.

|`keyPath`
|"m/44'/134'/0'"
|<<managing-multiple-accounts-with-a-single-passphrase,Key derivation>> allows multiple key pairs to be derived from the same passphrase.

|`address`
|lsk7dqp2w7447pqhuzmhx
sxr65qeoq7nbfox28wxc
a|The address is the main public identifier of the account and the human-readable representation of the `publicKey`.

Depending on the context, the address is represented in <<account-address-formats,different formats>>.

|`publicKey`
|0ca6a5d44cc366de186a2589
e3e51849272fa0ae9c526467
66ddb7820dfe770c
|A {url_wiki_Ed25519}[Ed25519^] public key.
The public identifier of the account.
Derived from the `passphrase`, together with the `keyPath`.
The first part of the public key is used to derive the `address` for an account.

|`privateKey`
|bd7e42529df375cb9133ddf2
99641d38975fa4d0930eff6efe
7c072d4d3ff190830ca6a5d477
4cc366de186a2589e3e518490c
272fa0ae9c52646766ddb7820d
|{url_wiki_Ed25519}[Ed25519^] private key
The private identifier of the account.
Derived from the `passphrase`, together with the `keyPath`.
|===

.Credentials required for block generation
[cols="1,1,4",options="header",stripes="hover"]
|===
|`generatorKeyPath`
|"m/25519'/134'/0'/0'"
|The derivation path for the <<generator-keys>>.

|`generatorKey`
|e59f2f603b84b9c491e2672
40a3425a09adaad348b984cc
6e21c14fd02f28e7e
a|The public <<generator-keys,generator key>>.
[#generator-keys]
An extra {url_wiki_Ed25519}[Ed25519^] key pair, the generator keys, is added to a validator account to sign blocks.
A validator node only requires access to the private generator key, but not to the private key that is used for signing transactions.
This mitigates the risk, that if an attacker is able to get the encrypted passphrase and the password used for encryption, the attacker has full control over the validator account.

|`generatorPrivateKey`
|398a04e2a001dc4580bb1fac14
b2c6e71dbbbd81c9f22170efd0
1073cd4084d81588f4e59f22f2
f603b84b9c491e267240a348e
25a09adaad348b984cc6e217e
|The private <<generator-keys,generator key>>.


|`blsKeyPath`
|"m/12381/134/0/0"
|Similarly to the specifications of {url_eip2334}[EIP 2334^], Lisk uses the path `m/12381/134/chainIDConverted/0` for the BLS key derived for a chain, where `chainIDConverted = bytesToUint(chainID)`.

|`blsKey`
|95c7a571ecf569f91f699517
f9a8d8a2e70904cb07935031
372b66d8a2b6986788f6d4e1
589c79fffefd952debc96a79

a|The public <<bls-keys,BLS key>>.
[#bls-keys]
An extra key pair, the BLS keys, is added to a validator account, following the key derivation method described in {url_eip2333}[EIP 2333^].
BLS keys are used by validators to create aggregated signatures, among other things, for commits in Lisk blockchains.

|`blsProofOfPossession`
|a02f2672621b3adcd25079
c6646e751517c514c70d11ed
ec4ec4846310f5f7cddedd83
598ade849496bcfe15d3ba1b
a554d06b148a2e9f2d349e201
010df2a17d7a3d57f13ab9b4c
f290042c552d47d925c0877c
596ca8865b96ba2972eea5ca
|The proof that a validator owns the private key for the corresponding BLS public key.
The proof-of-possession is important to prevent the “rogue key" attack when creating aggregated signatures.

|`blsPrivateKey`
|4ce94d4439152ec5e0ae
88a5c77c12cf0b5d93049c
111359c5f42b4905034226
|The private <<bls-keys,BLS key>>

|===

== Key pair and address creation

A *private key* is derived, as defined in {url_rfc8032}[RFC 8032^], from a {url_github_bip_39}[BIP 39^] *mnemonic passphrase* and a <<key-derivation-path>>.

.Generating multiple private keys from 1 passphrase with key derivation
image::run-blockchain/key_derivation.png[addressCreation]

NOTE: Any of the child keys could be used to create an {url_wiki_Ed25519}[Ed25519^] private key, but by default, only the child key at the end of the path is used to create the Ed25519 private key.

The corresponding *public key* can then be obtained following the key generation section of {url_rfc8032}[RFC 8032^].

Finally, the *address* is generated by taking the first 20 bytes of the public key.

=== Key Derivation path

The *key derivation path* allows to derive a specific key from within a tree of keys.

The derivation path is an array of non-negative integers smaller than 2^32.
To make it easier to read a derivation path, they are often written in a form that omits a large constant.
For example, the path 44'/134'/0' (notice the apostrophe after each number) represents the array [44+2^31, 134+2^31, 2^31].

The whole derivation path is then written m/44'/134'/0', indicating that we start by deriving a master key before deriving successive child keys.

=== Creating a new passphrase

A 12 word mnemonic passphrase is required as an input to generate all corresponding account credentials for an account.

You may choose the passphrase for yourself, or generate a new random passphrase.

The node CLI can be utilized to auto-generate the passphrase quickly from the command-line.

First, start the console:

[tabs]
=====
Lisk Core::
+
--
[source,bash]
----
lisk-core console
----
--
Lisk app::
+
--
[source,bash]
----
./bin/run console
----
--
=====

Generate a new mnemonic passphrase using the Lisk Passphrase library:

----
 > lisk.passphrase.Mnemonic.generateMnemonic()
----

This will return a randomly generated 12 word mnemonic passphrase.

----
'anger system news one finger rifle kiss expect arena swift spirit decline'
----

=== Creating the other credentials

Next, use the xref:{url_sdk_keyscreate}[keys:create] command to generate all relevant account credentials:

IMPORTANT: Creation of new account credentials always happens off-chain.
To put the new account on-chain, it is necessary to <<account-initialization,initialize>> the new account by sending some initial tokens to the address and paying the account initialization fee.

[tabs]
=====
Lisk Core::
+
--
[source,bash]
----
lisk-core keys:create
----
--
Lisk app::
+
--
[source,bash]
----
./bin/run keys:create
----
--
=====

When asked for the passphrase, enter the passphrase created in step <<creating-a-new-passphrase>>.

----
? Please enter passphrase:  [hidden]
? Please re-enter passphrase:  [hidden]
----

Next, you will be also asked for a password.
This password will be used to encrypt your account credentials symmetrically.

The encrypted credentials are used for example in the config, when the node needs account information to generate new blocks for a validator.

TIP: If you don't wish to encrypt your credentials, it is possible to skip this step by adding the `--no-encryption` flag to the `keys:create` command.

The password will be required everytime the credentials need to be decrypted, for example when enabling block generation on a node.
Therefore, the password should be saved and kept at a secure place, similar to the passphrase of the account.

----
? Please enter password:  [hidden]
? Please re-enter password:  [hidden]
----

This will then return the credentials for the account:

.Example output
[%collapsible]
====
[source,json]
----
{
  "keys": [
    {
      "address": "lsk7dqp2w7447pqhuzmhxsxr65qeoq7nbfox28wxc",
      "keyPath": "m/44'/134'/0'",
      "publicKey": "0ca6a5d44cc366de186a2589e3e51849272fa0ae9c52646766ddb7820dfe770c",
      "privateKey": "bd7e42529df375cb9133ddf299641d38975fa4d0930eff6e7c072d4d3ff190830ca6a5d44cc366de186a2589e3e51849272fa0ae9c52646766ddb7820dfe770c",
      "plain": {
        "generatorKeyPath": "m/25519'/134'/0'/0'",
        "generatorKey": "e59f2f603b84b9c491e267240a3425a09adaad348b984cc6e21c14fd02f28e7e",
        "generatorPrivateKey": "398a04e2a001dc4580bb1fab2c6e71dbbbd81c9f22170e1073cd4084d81588f4e59f2f603b84b9c491e267240a3425a09adaad348b984cc6e21c14fd02f28e7e",
        "blsKeyPath": "m/12381/134/0/0",
        "blsKey": "95c7a571ecf569f91f6995f9a8d8a2e70904cb079350372b66d8a2b6986788f6d4589c79fffefd952debc96a17317e18",
        "blsProofOfPossession": "a02f2672621b3adcd25079c6646e751517c514c70d11ec4ec4846310f5f7cddedd598ade849496bcfe15d3baa554d06b148a2e9f2d349e2010df2a17d7a3d57f13ab9bf290042c552d47d925c0877596ca8865b96ba2972eea5ce7831b014cca",
        "blsPrivateKey": "4ce94d4439152ec5e0ae88a5c77c12cf0b5d9304111359c5f42b490503429c26"
      },
      "encrypted": {
        "ciphertext": "5cc26d74c2b6ed7d56a1268eb04cd3878190695bd2546bca82885cc5d7171d71e397cab265544436d9feadd143e17deeeb5f32a00e6d6cf8d0e64afc5475067875a6836a5c7f78d3e0b4937c464817f40359c869bd0b01762a18169296774d1c76821a752e53dc96390c27a15ba8b1b3eef7016335dabcef424ed0dd3bf972f89451d2ea8db113b310e9ecda7ea3a044c68e4dc57f8c992e84729c62f952c7c24688f375b39311ef069d8a2ccde6c272ce65645839da3dfb",
        "mac": "ebdb87bb0be482ea6ec867bb3355d3c9aece28520d56d7b1c17463dc06e1eb97",
        "kdf": "argon2id",
        "kdfparams": {
          "parallelism": 4,
          "iterations": 1,
          "memorySize": 2024,
          "salt": "63092ee970b05d28017a606c39ff799b"
        },
        "cipher": "aes-256-gcm",
        "cipherparams": {
          "iv": "1a188eb0d5eab9eca50b7b3c",
          "tag": "2578354b532bec4485eeb7123c27f855"
        },
        "version": "1"
      }
    }
  ]
}
----
====

== Managing multiple accounts with a single passphrase

Key derivation allows multiple key pairs to be derived from the same secret passphrase as a tree of keys.

This means, a user can manage multiple different accounts, while they only need to remember a single passphrase.

To generate multiple accounts from the same passphrase, use the `--count` flag of the `keys:create` command, and set it to the number of accounts that you wish to create.

The key path for the new accounts will always start with the default key-derivation path and increment by +1 onwards.
If you wish to start from a different key path, you can specify an `--offset`.

[tabs]
=====
Lisk Core::
+
--
[source,bash]
----
lisk-core keys:create --passphrase your-passphrase --no-encrypt --count 2 --offset 1
----
--
Lisk app::
+
--
[source,bash]
----
./bin/run keys:create --passphrase your-passphrase --no-encrypt --count 2 --offset 1
----
--
=====

The same passphrase is used for every account, the only thing that will change is the <<key-derivation-path>>, for example when signing transactions.

[NOTE]
====
If a user uses the *default key-derivation path* `m/44'/134'/0`, it is not necessary to mention it as a parameter when the account credentials are requested.

If you are using a custom key-derivation path, make sure to always specify the key derivation path when providing the passphrase.
For example, for the `transaction:create` command, the key derivation path can be specified like so:

 % ./bin/run transaction:create hello createHello 10000000 --key-derivation-path="m/44'/134'/1'" --params='{"message":"Hello world!"}'

====

== Account initialization

To create a new account in the blockchain network, it is necessary to initialize the account.

A new account is initialized by sending tokens to an address for the first time.

When tokens are sent to a new address, it is required to pay an *account initialization fee*.

In the Lisk Mainnet, the account initialization fee is 0.05 LSK.

The account initialization fee has to be paid on top of the other fees for a transaction.

After the address received first tokens, the address is stored in the user substore.

=== User Substore
The user substore is a data store of the Token module and contains entries dedicated to storing the balances of users for a given address and tokenID.

The user substore contains entries with:

* key: the concatenation of an address and a token ID: address + tokenID
* value: the serialization of an object following the `userStoreSchema`.

.userStoreSchema
[%collapsible]
====
[source,json]
----
{
    "type": "object",
    "required": ["availableBalance", "lockedBalances"],
    "properties": {
        "availableBalance": {
            "dataType": "uint64",
            "fieldNumber": 1
        },
        "lockedBalances": {
            "type": "array",
            "fieldNumber": 2,
            "items": {
                "type": "object",
                "required":[ "module", "amount" ],
                "properties": {
                    "module": {
                        "dataType": "string",
                        "minLength": MIN_MODULE_NAME_LENGTH,
                        "maxLength": MAX_MODULE_NAME_LENGTH,
                        "pattern": "^[a-zA-Z0-9]*$",
                        "fieldNumber": 1
                    },
                    "amount": {
                        "dataType": "uint64",
                        "fieldNumber": 2
                    }
                }
            }
        }
    }
}
----
====

== Account address formats

The account address can be displayed in different formats, depending on the context.

=== Hexadecimal representation
The hexadecimal representation of the address is directly derived from the 20 first Bytes of the public key.
The address in hex format is often used internally as parameter.

.Hex-format address example
 0xc247a42e09e6aafd818821f75b2f5b0de47c8235

==== Hex address computation
To compute the address in hex format, the following information is required:

* account public key, e.g. 0x0eb0a6d7b862dc35c856c02c47fde3b4f60f2f3571a888b9a8ca7540c6793243

First, create the SHA-236 hash of the public key

 SHA-256(pubkey) = 0xc247a42e09e6aafd818821f75b2f5b0de47c8235b580881bd7750c9365993d25

To get the address, take the first 160 bits of the hash:

 address = 0xc247a42e09e6aafd818821f75b2f5b0de47c8235

=== Lisk32 representation
The Lisk32 address representation provides a user-friendly address format for frontends.

Each address starts with the prefix “lsk" and a checksum is appended.

.Lisk32 address example
 lsk24cd35u4jdq8szo3pnsqe5dsxwrnazyqqqg5eu

The *Lisk32 representation* displays addresses as a checksum with the "lsk" prefix to prevent accidental typing mistakes.

==== Lisk32 address computation
The procedure to obtain the Lisk32 representation of an <<hexadecimal-representation>> of an address is as follows:

. Calculate a 30-bit checksum of the address of the account using a BCH code, see {url_github_bip_173}[BIP173].
This step provides protection against accidental typing mistakes.
. Concatenate the address and the output of step 1.
. Encode the output of step 2 in a custom Base32 format, see {url_github_lip_18}[LIP 0018] for details.
Lower-case letters and digits are used, the characters i, l, 1 and 0 are removed for usability reasons.
. Add the prefix "lsk" to the output of step 3.

NOTE: The Lisk32 representation always tarts with "lsk" and the final address is 41 characters long.

== Key Management
There are two recommended ways to manage the account keys, depending on the use case:

.Account credentials
[cols="1,2",options="header",stripes="hover"]
|===
|Key management method
|Use Case

|Using a secret passphrase
|For users that need their key pair only on local machines, e.g., for singing transactions.
Requires to remember or store secretly a secret recovery phrase and a password, but does not require to store and backup any encrypted data locally.

|Storing the encrypted secret key
|For users that need the key pair only on some remote server, e.g., a validator node on a remote data center.
Requires to store and backup an encrypted file, but needs to remember or secretly store only one password.
|===
