<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Setting up an Off-chain database :: Lisk documentation</title>
    <link rel="canonical" href="https://liskhq.github.io/lisk-docs/beta/build-blockchain/plugin/offchain-db.html">
    <link rel="prev" href="schema-types.html">
    <link rel="next" href="configuring-plugin.html">
    <meta name="generator" content="Antora 3.1.1">

<link id="theme" rel="stylesheet" title="Default" href="../../../_/css/site.css">
<link rel="stylesheet" title="Dark" href="../../../_/css/dark-site.css">

<script>var uiRootPath = '../../../_'</script>
<script src="../../../_/js/vendor/medium-zoom.js"></script>
<script type="text/javascript" id="Cookiebot" src="https://consent.cookiebot.com/uc.js" data-cbid="e4db29b5-cd94-4bcf-87e4-04f4ca564240" data-blockingmode="manual"></script>
<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://lisk.matomo.cloud/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '2']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src='//cdn.matomo.cloud/lisk.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->
<!-- Matomo Tag Manager -->
<script>
  var _mtm = window._mtm = window._mtm || [];
  _mtm.push({'mtm.startTime': (new Date().getTime()), 'event': 'mtm.Start'});
  var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
  g.async=true; g.src='https://cdn.matomo.cloud/lisk.matomo.cloud/container_RUW6y8yf.js'; s.parentNode.insertBefore(g,s);
</script>
<!-- End Matomo Tag Manager -->
<link rel="icon" href="../../../_/img/favicon.png" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="top-logo">
        <a href="../../.." class="lisk-logo"></a>
        <a href="../../.." class="docs-logo"></a>
      </div>
      <!--<a class="navbar-item" href="https://liskhq.github.io/lisk-docs">Lisk documentation</a>-->
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">APIs</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="../../../api/lisk-node-rpc.html">Lisk node RPC API</a>
            <a class="navbar-item" href="../../../api/lisk-service-http.html">Lisk Service HTTP
              API</a>
            <a class="navbar-item" href="../../../api/lisk-service-rpc.html">Lisk Service RPC
              API</a>
            <a class="navbar-item" href="../../../api/lisk-service-pubsub.html">Lisk Service
              Pub/Sub API</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Explorers</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://lisk.observer/" target="_blank">Lisk Observer</a>
            <a class="navbar-item" href="https://liskscan.com/" target="_blank">LiskScan</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="../../../lisk-sdk/">Lisk SDK</a>
            <a class="navbar-item" href="../../../lisk-service/">Lisk Service</a>
            <a class="navbar-item" href="../../../lisk-core/">Lisk Core</a>
            <a class="navbar-item" href="https://lisk.com/wallet" target="_blank">Lisk Wallets</a>
          </div>
        </div>
        <button onclick="switch_style('toggle')" id="theme-toggle" class="theme-toggle navbar-item"></button>
        <!-- <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div> -->
      </div>
    </div>
  </nav>
</header>
<div class="toolbar" role="navigation">
  <button class="nav-toggle"></button>
  <div class="components-versions">
      <div class="page-components">
    <button class="component-menu-toggle" title="Show other documentations">Lisk Documentation</button>
    <div class="component-menu">
        <a class="component" href="../../../lisk-core/index.html">Lisk Core</a>
        <a class="component" href="../../../lisk-docs-manual/index.html">Lisk docs manual</a>
        <a class="component is-current" href="../../../index.html">Lisk Documentation</a>
        <a class="component" href="../../../lisk-sdk/index.html">Lisk SDK</a>
        <a class="component" href="../../../lisk-service/index.html">Lisk Service</a>
    </div>
  </div>
    <span></span>
    <div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">beta</button>
  <div class="version-menu">
    <a class="version is-missing" href="../../../index.html">default</a>
    <a class="version is-current" href="offchain-db.html">beta</a>
  </div>
</div>
  </div>
  <span></span>
  <span></span>
    <a href="../../../index.html" class="home-link"></a>
  <nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Lisk Documentation</a></li>
    <li><a href="../index.html">Build Blockchain</a></li>
    <li><a href="index.html">How to create a plugin</a></li>
    <li><a href="offchain-db.html">2. Setting up an Off-chain database</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/LiskHQ/lisk-docs/edit/1497-blockchain-interoperability-page-in-lisk-docs/docs/modules/ROOT/pages/build-blockchain/plugin/offchain-db.adoc">Edit this Page</a></div>
</div>

<div class="body">
<div class="nav-container" data-component="ROOT" data-version="beta">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Lisk Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../intro/what-is-blockchain.html">What is blockchain?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../intro/how-blockchain-works.html">How blockchain works</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../intro/blockchain-scalability.html">Blockchain Scalability</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../intro/lisk-products.html">Lisk products</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../intro/blockchain-interoperability.html">Blockchain Interoperability</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../understand-blockchain/index.html">Understand Lisk Blockchain</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../understand-blockchain/state-machine.html">State machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../understand-blockchain/consensus/index.html">Consensus protocols</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../understand-blockchain/consensus/pos-poa.html">Proof of Stake (PoS) &amp; Proof of Authority (PoA) in Lisk</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../understand-blockchain/network.html">Network</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../understand-blockchain/mainchain.html">Mainchain</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../understand-blockchain/interoperability/index.html">Lisk Interoperability</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../understand-blockchain/interoperability/communication.html">Cross-chain communication</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../understand-blockchain/interoperability/sidechain-registration-and-recovery.html">Sidechain Registration &amp; Recovery</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../understand-blockchain/blocks-txs.html">Blocks and Transactions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Lisk SDK</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../understand-blockchain/sdk/modules-commands.html">Modules and Commands</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../understand-blockchain/sdk/plugins.html">Plugins</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../understand-blockchain/sdk/rpc.html">Communicating to a Lisk node via RPC</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../understand-blockchain/sdk/codec-schema.html">Schemas &amp; Codec</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../index.html">Build Blockchain</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../create-blockchain-client.html">Creating a new blockchain client</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration.html">Blockchain client configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../module/index.html">How to create a module</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../module/configuration.html">1. How to create a module configuration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../module/stores.html">2. How to create stores</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../module/command.html">3. How to create a command</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../module/endpoints-methods.html">4. How to create endpoints and methods</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../module/blockchain-event.html">5. How to create a blockchain event</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">How to create a plugin</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="schema-types.html">1. Defining off-chain data structures</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="offchain-db.html">2. Setting up an Off-chain database</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="configuring-plugin.html">3. Configuring a Plugin</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="plugin-class.html">4. Updating the Plugin Class</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="plugin-endpoints.html">5. Creating an endpoint &amp; Testing the plugin</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../using-dashboard.html">Using the Dashboard with a blockchain client</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../enable-faucet.html">How to enable a Faucet for testing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../create-genesis-block.html">How to create a new genesis block</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../register-sidechain.html">How to register a sidechain</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../interoperable-module/index.html">How to implement cross-chain communication</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../interoperable-module/create-ccm.html">How to create a CCM</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../interoperable-module/execute-ccm.html">How to execute a CCM</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../run-blockchain/index.html">Run Blockchain</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/process-management.html">Process management with PM2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/account-management.html">Managing accounts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/become-a-validator.html">How to become a validator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/staking.html">How to stake and un-stake tokens</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/enable-block-generation.html">How to enable/disable block generation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/reward-sharing.html">How to share block rewards</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/setup-relayer.html">Setting up a relayer node</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/blockchain-reset.html">Resetting and snapshotting the blockchain</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/enabling-misbehavior-report.html">How to enable the "Report Misbehavior" plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../run-blockchain/logging.html">Managing logs</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../integrate-blockchain/index.html">Integrate Blockchain</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrate-blockchain/connecting-endpoints.html">Connecting via endpoints</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrate-blockchain/subscribing-to-events.html">Retrieving on-chain events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Transaction creation, signing, and posting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../integrate-blockchain/create-sign-transactions.html">How to create and sign a transaction</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../integrate-blockchain/create-tx-offline.html">Creating transactions and signing them offline</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../integrate-blockchain/multisignature-accounts-and-transactions.html">How to create multi-signature accounts and transactions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../integrate-blockchain/create-multiSig-tx-offline.html">Creating and signing a multi-signature transaction (Offline)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../integrate-blockchain/calculating-min-fee.html">How to calculate the minimum fee for a transaction</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../integrate-blockchain/posting-transactions.html">How to post a transaction</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrate-blockchain/encode-decode.html">Decoding &amp; encoding data</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrate-blockchain/overwriting-transactions.html">How to overwrite a transaction in the transaction pool</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../integrate-blockchain/integrate-ui/index.html">Integrating a user interface</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../integrate-blockchain/integrate-ui/create-get-account.html">1. Handling accounts</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../integrate-blockchain/integrate-ui/faucet-transfer.html">2. Using faucet and transferring tokens</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../integrate-blockchain/integrate-ui/send-get-hello.html">3. Sending and retrieving hello</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrate-blockchain/aggregate-blockchain-data/index.html">Aggregate blockchain data with Lisk Service</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">APIs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../api/lisk-node-rpc.html">RPC API for Lisk nodes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Module RPC APIs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../api/module-rpc-api/auth-endpoints.html">Auth module: Endpoint reference</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../api/module-rpc-api/dynamic-reward-endpoints.html">Dynamic Reward module: Endpoint reference</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../api/module-rpc-api/fee-endpoints.html">Fee module: Endpoint reference</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../api/module-rpc-api/interoperability-endpoints.html">Sidechain Interoperability module: Endpoint reference</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../api/module-rpc-api/mainchain-interoperability-endpoints.html">Mainchain Interoperability module: Endpoint reference</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../api/module-rpc-api/token-endpoints.html">Token module: Endpoint reference</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../api/module-rpc-api/validators-endpoints.html">Validators module: Endpoint reference</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../api/module-rpc-api/random-endpoints.html">Random module: Endpoint reference</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../api/module-rpc-api/pos-endpoints.html">Proof of Stake module: Endpoint reference</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Plugin RPC APIs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../api/plugin-rpc-api/chain-connector-api.html">Chain Connector plugin: Endpoint reference</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Lisk Service APIs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../api/lisk-service-rpc.html">RPC API of Lisk Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../api/lisk-service-http.html">HTTP API (Lisk Service)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../api/lisk-service-pubsub.html">Publish/Subscribe API (Lisk Service)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../api/lisk-service-api-migration.html">Lisk Service API v2 vs v3</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Products</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../lisk-sdk/v6/index.html">Lisk SDK</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../lisk-core/v4/index.html">Lisk Core</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../bug-bounty-program.html">Lisk Bug Bounty Program</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Lisk Documentation</span>
    <span class="version">beta</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../lisk-core/index.html">Lisk Core</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../lisk-core/index.html">3.1.0 (latest)</a>
        </li>
        <li class="version">
          <a href="../../../lisk-core/v4/index.html">4.0.0 (beta)</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../lisk-docs-manual/index.html">Lisk docs manual</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../lisk-docs-manual/index.html">0.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../../index.html">Lisk Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../index.html">default</a>
        </li>
        <li class="version is-current">
          <a href="../../index.html">beta</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../lisk-sdk/index.html">Lisk SDK</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../lisk-sdk/index.html">5.2.2 (latest)</a>
        </li>
        <li class="version">
          <a href="../../../lisk-sdk/v6/index.html">6.0.0 (beta)</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../lisk-service/index.html">Lisk Service</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../lisk-service/index.html">0.6.6 (latest)</a>
        </li>
        <li class="version">
          <a href="../../../lisk-service/0.7/index.html">0.7 (beta)</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
      <h1 class="page">Setting up an Off-chain database</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>On this page, you&#8217;ll learn:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p><i class="fa fa-check-square-o"></i> Defining method for initiating database.</p>
</li>
<li>
<p><i class="fa fa-check-square-o"></i> Defining methods for storing data in the database.</p>
</li>
<li>
<p><i class="fa fa-check-square-o"></i> Defining methods for retrieving data from the database.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Plugins can use any database for their off-chain data storage needs, contrary to modules that use both on-chain and off-chain data stores offered by the Lisk SDK.</p>
</div>
<div class="paragraph">
<p>A plugin&#8217;s data store stays only on the node that registers it to the blockchain and is not shared with other nodes.</p>
</div>
<div class="paragraph">
<p>For this guide, we want to store the NewHelloEvent&#8217;s data in an off-chain store by using <code>lisk-db</code>.
Lisk-db is a key-value store based on <a href="https://rocksdb.org/" target="_blank" rel="noopener">RocksDB</a>.</p>
</div>
<div class="paragraph">
<p>The database-related operations will exist in a <code>db.ts</code> file which will be located in the plugin&#8217;s root folder: <code>hello_info</code>.
Create the new file in the aforementioned directory.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The relevant file discussed in this guide is <a href="https://github.com/LiskHQ/lisk-sdk-examples/tree/development/tutorials/hello/hello_client/src/app/plugins/hello_info/db.ts" target="_blank" rel="noopener">db.ts</a>.
</td>
</tr>
</table>
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#getting-the-databases-instance">1. Getting the database&#8217;s instance</a></li>
<li><a href="#getting-and-setting-event-data">2. Getting and Setting event data</a>
<ul class="sectlevel2">
<li><a href="#setting-event-data">2.1. Setting event data</a></li>
<li><a href="#getting-events-data">2.2. Getting events data</a></li>
</ul>
</li>
<li><a href="#getting-and-setting-counter">3. Getting and Setting Counter</a>
<ul class="sectlevel2">
<li><a href="#setting-last-counter">3.1. Setting last counter</a></li>
<li><a href="#getting-last-counter">3.2. Getting last counter</a></li>
</ul>
</li>
<li><a href="#getting-and-setting-height">4. Getting and Setting Height</a>
<ul class="sectlevel2">
<li><a href="#setting-height">4.1. Setting Height</a></li>
<li><a href="#getting-height">4.2. Getting Height</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="getting-the-databases-instance"><a class="anchor" href="#getting-the-databases-instance"></a>1. Getting the database&#8217;s instance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <code>lisk-db</code> instance requires a <strong>data path</strong> and the <strong>name</strong> of the database.
The data path of a plugin inherits the data path of the blockchain client and is mentioned in the <em>config.json</em> or <em>custom_config.json</em> file.</p>
</div>
<div class="paragraph">
<p>Add the following code to your <code>db.ts</code> for getting a database instance.</p>
</div>
<div class="listingblock">
<div class="title">getDBInstance</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { codec, db as liskDB, cryptography } from 'lisk-sdk';
import * as os from 'os';
import { join } from 'path';
import { ensureDir } from 'fs-extra';

// [...]

const { Database } = liskDB;
type KVStore = liskDB.Database;

// Returns DB's instance.
export const getDBInstance = async (
	dataPath: string,
	dbName = 'lisk-framework-helloInfo-plugin.db',
): Promise&lt;KVStore&gt; =&gt; {
	const dirPath = join(dataPath.replace('~', os.homedir()), 'database', dbName);
	await ensureDir(dirPath);
	return new Database(dirPath);
};

// [...]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-and-setting-event-data"><a class="anchor" href="#getting-and-setting-event-data"></a>2. Getting and Setting event data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we have our function to get a db instance, let&#8217;s create functions for setting and getting data from the database.</p>
</div>
<div class="sect2">
<h3 id="setting-event-data"><a class="anchor" href="#setting-event-data"></a>2.1. Setting event data</h3>
<div class="paragraph">
<p>As mentioned in the <a href="schema-types.html#NewHelloEvent" class="xref page">newHello</a> event&#8217;s schema, we need to store the <em>senderAddress</em>, the hello <em>message</em> sent, and the <em>height</em> of the block where a <code>newHello</code> event was found.</p>
</div>
<div class="paragraph">
<p>Along with passing the aforementioned to our <code>setEventHelloInfo()</code>, we also need to pass a <em>counter</em> value.
This counter will be converted into a Buffer and will be concatenated with the Buffer value of our constant <code>DB_KEY_ADDRESS_INFO</code> to form a unique key for each <code>newHello</code> event.</p>
</div>
<div class="listingblock">
<div class="title">setEventHelloInfo</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// [...]

// Import required "Schemas", "Types" and "Constants"
import { offChainEventSchema, counterSchema, heightSchema } from './schemas';
import { Event, Counter, Height } from './types';
import { DB_KEY_EVENT_INFO, DB_LAST_COUNTER_INFO, DB_LAST_HEIGHT_INFO } from './constants';

// [...]

// Stores event data in the database.
export const setEventHelloInfo = async (
	db: KVStore,
	_lskAddress: Buffer,
	_message: string,
	_eventHeight: number,
	lastCounter: number,
): Promise&lt;void&gt; =&gt; {
	const encodedAddressInfo = codec.encode(offChainEventSchema, {
		senderAddress: _lskAddress,
		message: _message,
		height: _eventHeight,
	});
	// Creates a unique key for each event
	const dbKey = Buffer.concat([DB_KEY_EVENT_INFO, cryptography.utils.intToBuffer(lastCounter, 4)]);
	await db.set(dbKey, encodedAddressInfo);
	console.log('** Event data saved successfully in the database **');
};

// [...]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getting-events-data"><a class="anchor" href="#getting-events-data"></a>2.2. Getting events data</h3>
<div class="paragraph">
<p>Getting the stored events data is fairly simple.
A ReadStream will be created by passing the starting and ending clauses to the <code>createReadStream()</code>.</p>
</div>
<div class="paragraph">
<p>Once the stream gets all the stored data, the data will be filtered out one by one for each event and each event will be pushed into an array of objects.
Finally, the array containing all the <code>newHello</code> events will be returned.</p>
</div>
<div class="listingblock">
<div class="title">getEventHelloInfo</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// [...]

// Returns event's data stored in the database.
export const getEventHelloInfo = async (db: KVStore): Promise&lt;(Event &amp; { id: Buffer })[]&gt; =&gt; {
	// 1. Look for all the given key-value pairs in the database
	const stream = db.createReadStream({
		gte: Buffer.concat([DB_KEY_EVENT_INFO, Buffer.alloc(4, 0)]),
		lte: Buffer.concat([DB_KEY_EVENT_INFO, Buffer.alloc(4, 255)]),
	});
	// 2. Get event's data out of the collected stream and push it in an array.
	const results = await new Promise&lt;(Event &amp; { id: Buffer })[]&gt;((resolve, reject) =&gt; {
		const events: (Event &amp; { id: Buffer })[] = [];
		stream
			.on('data', ({ key, value }: { key: Buffer; value: Buffer }) =&gt; {
				events.push({
					...codec.decode&lt;Event&gt;(offChainEventSchema, value),
					id: key.slice(DB_KEY_EVENT_INFO.length),
				});
			})
			.on('error', error =&gt; {
				reject(error);
			})
			.on('end', () =&gt; {
				resolve(events);
			});
	});
	return results;
};

// [...]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-and-setting-counter"><a class="anchor" href="#getting-and-setting-counter"></a>3. Getting and Setting Counter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After implementing the getter and setter for the event&#8217;s data, we also want functions for getting and setting the counter.</p>
</div>
<div class="sect2">
<h3 id="setting-last-counter"><a class="anchor" href="#setting-last-counter"></a>3.1. Setting last counter</h3>
<div class="paragraph">
<p>Every time an event&#8217;s data is stored in the database, we intend to also store the <strong>number of total events stored + 1</strong> as a counter inside the database.
For that, add the <code>setLastCounter()</code> function to our <code>db.ts</code> file.</p>
</div>
<div class="paragraph">
<p>Since we only intend to store a single value, there is no need to create a series of unique keys so we will use our <code>DB_LAST_COUNTER_INFO</code> constant as the key for storing the last counter.</p>
</div>
<div class="listingblock">
<div class="title">setLastCounter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// [...]

// Stores lastCounter for key generation.
export const setLastCounter = async (db: KVStore, lastCounter: number): Promise&lt;void&gt; =&gt; {
	const encodedCounterInfo = codec.encode(counterSchema, { counter: lastCounter });
	await db.set(DB_LAST_COUNTER_INFO, encodedCounterInfo);
	console.log('** Counter saved successfully in the database **');
};

// [...]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getting-last-counter"><a class="anchor" href="#getting-last-counter"></a>3.2. Getting last counter</h3>
<div class="paragraph">
<p>The function will fetch the last stored value of the counter from the database.
The counter value is incremented based on the last stored value of the counter.</p>
</div>
<div class="listingblock">
<div class="title">getLastCounter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// [...]

// Returns lastCounter.
export const getLastCounter = async (db: KVStore): Promise&lt;Counter&gt; =&gt; {
	const encodedCounterInfo = await db.get(DB_LAST_COUNTER_INFO);
	return codec.decode&lt;Counter&gt;(counterSchema, encodedCounterInfo);
};
// [...]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-and-setting-height"><a class="anchor" href="#getting-and-setting-height"></a>4. Getting and Setting Height</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To ensure efficiency, the <code>HelloInfoPlugin</code> should only look for <code>newHello</code> event in blocks previously unchecked.
For that, we will store the last checked block height in the plugin&#8217;s database.</p>
</div>
<div class="sect2">
<h3 id="setting-height"><a class="anchor" href="#setting-height"></a>4.1. Setting Height</h3>
<div class="paragraph">
<p>Similarly to the counter, we intend to store only the last checked block height which is a single value.
So, we will use the <code>DB_LAST_HEIGHT_INFO</code> constant as the key.</p>
</div>
<div class="listingblock">
<div class="title">setLastEventHeight</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// [...]

// Stores height of block where hello event exists.
export const setLastEventHeight = async (db: KVStore, lastHeight: number): Promise&lt;void&gt; =&gt; {
	const encodedHeightInfo = codec.encode(heightSchema, { height: lastHeight });
	await db.set(DB_LAST_HEIGHT_INFO, encodedHeightInfo);
	console.log('**Height saved successfully in the database **');
};

// [...]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getting-height"><a class="anchor" href="#getting-height"></a>4.2. Getting Height</h3>
<div class="paragraph">
<p>As the name suggests, the <code>getLastEventHeight()</code> will return the last stored value of block height.
This value will be used in the search of <code>newHello</code> event.</p>
</div>
<div class="listingblock">
<div class="title">getLastEventHeight</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// [...]

// Returns height of block where hello event exists.
export const getLastEventHeight = async (db: KVStore): Promise&lt;Height&gt; =&gt; {
	const encodedHeightInfo = await db.get(DB_LAST_HEIGHT_INFO);
	return codec.decode&lt;Height&gt;(heightSchema, encodedHeightInfo);
};

// [...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The database logic completes here, now we should add configuration to <code>HelloInfoPlugin</code>, as described in the next guide.</p>
</div>
</div>
</div>
</div>
  <nav class="pagination">
  <span class="prev"><a href="schema-types.html">1. Defining off-chain data structures</a></span>
  <span class="next"><a href="configuring-plugin.html">3. Configuring a Plugin</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="footerdiv">
    <p>Â© 2023 Lisk Foundation</p>
    <!-- <div class="community-section">
      <p class="community-section__text">Follow Lisk on: </p>
      <div class="community-section__icons"> -->
    <div class="community_icons">
      <a href="https://lisk.chat" title="Discord" target="_blank" class="footer_icon icon-discord"><p>Discord</p></a>
      <a href="https://dev.lisk.com" title="Discourse" target="_blank" class="footer_icon icon-discourse"><p>Discourse</p></a>
      <a href="https://github.com/LiskHQ" title="GitHub" target="_blank" class="footer_icon icon-github"><p>GitHub</p></a>
      <!--    </div> -->
    </div>
  </div>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script async src="../../../_/js/vendor/glossary.js"></script>
<script async src="../../../_/js/vendor/tabs-block-behaviour.js"></script>
<script async src="../../../_/js/vendor/swagger-ui.js"></script>
<script async src="../../../_/js/vendor/component-versions.js"></script>
<script src="../../../_/js/vendor/custom.js"></script>

  </body>
</html>
