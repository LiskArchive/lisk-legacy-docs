<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Social Recovery System (SRS) Tutorial :: Lisk documentation</title>
    <link rel="canonical" href="https://liskhq.github.io/lisk-docs/tutorial/srs.html">
    <link rel="prev" href="nft.html">
    <link rel="next" href="lns/index.html">
    <meta name="generator" content="Antora 3.1.1">

<link id="theme" rel="stylesheet" title="Default" href="../../_/css/site.css">
<link rel="stylesheet" title="Dark" href="../../_/css/dark-site.css">

<script>var uiRootPath = '../../_'</script>
<script src="../../_/js/vendor/medium-zoom.js"></script>
<script type="text/javascript" id="Cookiebot" src="https://consent.cookiebot.com/uc.js" data-cbid="e4db29b5-cd94-4bcf-87e4-04f4ca564240" data-blockingmode="manual"></script>
<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://lisk.matomo.cloud/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '2']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src='//cdn.matomo.cloud/lisk.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->
<!-- Matomo Tag Manager -->
<script>
  var _mtm = window._mtm = window._mtm || [];
  _mtm.push({'mtm.startTime': (new Date().getTime()), 'event': 'mtm.Start'});
  var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
  g.async=true; g.src='https://cdn.matomo.cloud/lisk.matomo.cloud/container_RUW6y8yf.js'; s.parentNode.insertBefore(g,s);
</script>
<!-- End Matomo Tag Manager -->
<link rel="icon" href="../../_/img/favicon.png" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="top-logo">
        <a href="../.." class="lisk-logo"></a>
        <a href="../.." class="docs-logo"></a>
      </div>
      <!--<a class="navbar-item" href="https://liskhq.github.io/lisk-docs">Lisk documentation</a>-->
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">APIs</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="../../api/lisk-node-rpc.html">Lisk node RPC API</a>
            <a class="navbar-item" href="../../api/lisk-service-http.html">Lisk Service HTTP
              API</a>
            <a class="navbar-item" href="../../api/lisk-service-rpc.html">Lisk Service RPC
              API</a>
            <a class="navbar-item" href="../../api/lisk-service-pubsub.html">Lisk Service
              Pub/Sub API</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Explorers</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://lisk.observer/" target="_blank">Lisk Observer</a>
            <a class="navbar-item" href="https://liskscan.com/" target="_blank">LiskScan</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="../../lisk-sdk/">Lisk SDK</a>
            <a class="navbar-item" href="../../lisk-service/">Lisk Service</a>
            <a class="navbar-item" href="../../lisk-core/">Lisk Core</a>
            <a class="navbar-item" href="https://lisk.com/wallet" target="_blank">Lisk Wallets</a>
          </div>
        </div>
        <button onclick="switch_style('toggle')" id="theme-toggle" class="theme-toggle navbar-item"></button>
        <!-- <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div> -->
      </div>
    </div>
  </nav>
</header>
<div class="toolbar" role="navigation">
  <button class="nav-toggle"></button>
  <div class="components-versions">
      <div class="page-components">
    <button class="component-menu-toggle" title="Show other documentations">Lisk Documentation</button>
    <div class="component-menu">
        <a class="component" href="../../lisk-core/index.html">Lisk Core</a>
        <a class="component" href="../../lisk-docs-manual/index.html">Lisk docs manual</a>
        <a class="component is-current" href="../../index.html">Lisk Documentation</a>
        <a class="component" href="../../lisk-sdk/index.html">Lisk SDK</a>
        <a class="component" href="../../lisk-service/index.html">Lisk Service</a>
    </div>
  </div>
    <span></span>
    <div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">lisk-v3</button>
  <div class="version-menu">
    <a class="version" href="../../tutorial/srs.html">default</a>
    <a class="version is-current" href="srs.html">lisk-v3</a>
  </div>
</div>
  </div>
  <span></span>
  <span></span>
    <a href="../../index.html" class="home-link"></a>
  <nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Lisk Documentation</a></li>
    <li><a href="index.html">Tutorials</a></li>
    <li><a href="srs.html">Social Recovery System (SRS) Tutorial</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/LiskHQ/lisk-docs/edit/docs-lisk-v3/docs/modules/ROOT/pages/tutorial/srs.adoc">Edit this Page</a></div>
</div>

<div class="body">
<div class="nav-container" data-component="ROOT" data-version="lisk-v3">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Lisk Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../understand-blockchain/index.html">Understand Blockchain</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../understand-blockchain/architecture.html">SDK Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../understand-blockchain/block-life-cycle.html">Block life cycle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../understand-blockchain/modules-assets.html">Modules and assets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../understand-blockchain/plugins.html">Plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../understand-blockchain/endpoints.html">RPC endpoints of a Lisk node</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../understand-blockchain/reducers.html">Reducers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../understand-blockchain/codec-schema.html">Codec &amp; schema</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../understand-blockchain/lisk-protocol/index.html">Lisk Protocol</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../understand-blockchain/lisk-protocol/accounts.html">Accounts</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../understand-blockchain/lisk-protocol/blocks.html">Blocks</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../understand-blockchain/lisk-protocol/consensus-algorithm.html">Consensus algorithm</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../understand-blockchain/lisk-protocol/network.html">Network</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../understand-blockchain/lisk-protocol/transactions.html">Transactions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../understand-blockchain/lisk-protocol/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../build-blockchain/index.html">Build Blockchain</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../build-blockchain/create-blockchain-app.html">Creating a new blockchain application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../build-blockchain/create-module.html">Creating a new module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../build-blockchain/create-asset.html">Creating a new asset</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../build-blockchain/create-genesis-block.html">How to create a new genesis block</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../build-blockchain/create-plugin.html">Creating a new plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../build-blockchain/configure-app.html">How to configure a blockchain application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../build-blockchain/test-app.html">Testing the blockchain application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../build-blockchain/using-dashboard.html">Using dashboard with the blockchain application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../build-blockchain/enable-faucet.html">How to enable a faucet for testing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../build-blockchain/launch-test-network.html">Launching a public test network</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../run-blockchain/index.html">Run Blockchain</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../run-blockchain/account-management.html">Managing accounts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../run-blockchain/forging.html">Enabling forging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../run-blockchain/blockchain-reset.html">Resetting and snapshotting the blockchain</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../run-blockchain/forging-node-protection.html">Protecting a forging node</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../run-blockchain/non-forging-node-protection.html">Protecting a non-forging node</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../run-blockchain/logging.html">Managing logs</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../integrate-blockchain/index.html">Integrate Blockchain</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrate-blockchain/calculating-min-fee.html">Calculating the minimum fee for a transaction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrate-blockchain/create-send-transactions.html">How to send a transaction to the network</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrate-blockchain/create-tx-offline.html">Creating transactions and signing them offline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrate-blockchain/encode-decode.html">Decoding &amp; encoding data</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrate-blockchain/create-user-interface.html">Creating a user interface</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Tutorials</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="nft.html">Non-fungible token (NFT) Tutorial</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="srs.html">Social Recovery System (SRS) Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="lns/index.html">Lisk Name Service (LNS) Tutorial</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lns/1-blockchain.html">Chapter 1: Blockchain</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lns/2-frontend.html">Chapter 2: Frontend</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lns/3-cli.html">Chapter 3: CLI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lns/4-tests.html">Chapter 4: Tests</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">APIs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../api/lisk-node-http.html">HTTP API for Lisk nodes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../api/lisk-node-rpc.html">RPC API for Lisk nodes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../api/lisk-service-http.html">Mainnet HTTP API (Lisk Service)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../api/lisk-service-rpc.html">RPC endpoints (Lisk Service)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../api/lisk-service-pubsub.html">Publish/Subscribe API (Lisk Service)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Products</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../lisk-sdk/v5/index.html">Lisk SDK</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../lisk-service/v0.6/index.html">Lisk Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../lisk-core/v3/index.html">Lisk Core</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../bug-bounty-program.html">Lisk Bug Bounty Program</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../glossary.html">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Lisk Documentation</span>
    <span class="version">lisk-v3</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../lisk-core/index.html">Lisk Core</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lisk-core/index.html">4.0 (latest)</a>
        </li>
        <li class="version">
          <a href="../../lisk-core/v3/index.html">3.1.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../lisk-docs-manual/index.html">Lisk docs manual</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lisk-docs-manual/index.html">0.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../index.html">Lisk Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../index.html">default</a>
        </li>
        <li class="version is-current">
          <a href="../index.html">lisk-v3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../lisk-sdk/index.html">Lisk SDK</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lisk-sdk/index.html">6.0 (latest)</a>
        </li>
        <li class="version">
          <a href="../../lisk-sdk/v5/index.html">5.3.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../lisk-service/index.html">Lisk Service</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lisk-service/index.html">0.7 (latest)</a>
        </li>
        <li class="version">
          <a href="../../lisk-service/v0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
      <h1 class="page">Social Recovery System (SRS) Tutorial</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>How to create a blockchain application which offers users a feature to recover the balance of their accounts for the scenario whereby their passphrase has been lost or forgotten.</p>
</div>
<div class="paragraph">
<p>The goal is to build an account recovery tool where a user asks friends to provide access to the funds of a lost account.
The user defines a recovery configuration initially by setting a list of friends and other specific parameters for the recovery.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For the <strong>full code example</strong> please see the <a href="https://github.com/LiskHQ/lisk-sdk-examples/tree/development/tutorials/social-recovery" target="_blank" rel="noopener">SRS app on GitHub</a>.
</td>
</tr>
</table>
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#srs-application-overview">SRS application overview</a></li>
<li><a href="#project-setup">1. Project setup</a></li>
<li><a href="#transaction-assets">2. Transaction assets</a>
<ul class="sectlevel2">
<li><a href="#constants">2.1. Constants</a></li>
<li><a href="#setting-up-module-and-transaction-folders">2.2. Setting up module and transaction folders</a></li>
<li><a href="#createrecovery-asset">2.3. createRecovery asset</a></li>
<li><a href="#initiaterecovery-asset">2.4. initiateRecovery asset</a></li>
<li><a href="#vouchrecovery-asset">2.5. vouchRecovery asset</a></li>
<li><a href="#claimrecovery-asset">2.6. claimRecovery asset</a></li>
<li><a href="#closerecovery-asset">2.7. closeRecovery asset</a></li>
<li><a href="#removerecovery-asset">2.8. removeRecovery asset</a></li>
</ul>
</li>
<li><a href="#the-srs-module">3. The SRS module</a>
<ul class="sectlevel2">
<li><a href="#module-id-and-name">3.1. Module ID and name</a></li>
<li><a href="#the-account-schema">3.2. The account schema</a></li>
<li><a href="#importing-the-transaction-assets-into-the-module">3.3. Importing the transaction assets into the module</a></li>
<li><a href="#events">3.4. Events</a></li>
<li><a href="#lifecycle-hooks">3.5. Lifecycle hooks</a></li>
</ul>
</li>
<li><a href="#the-srs-data-plugin">4. The SRS data plugin</a>
<ul class="sectlevel2">
<li><a href="#the-load-function">4.1. The <code>load()</code> function</a></li>
<li><a href="#create-an-action-to-get-all-accounts-with-recovery-configs">4.2. Create an action to get all accounts with recovery configs</a></li>
</ul>
</li>
<li><a href="#the-srs-api-plugin">5. The SRS API plugin</a>
<ul class="sectlevel2">
<li><a href="#controllers">5.1. Controllers</a></li>
<li><a href="#the-load-and-unload-functions">5.2. The <code>load()</code> and <code>unload()</code> functions</a></li>
</ul>
</li>
<li><a href="#registering-module-plugins">6. Registering module &amp; plugins</a></li>
<li><a href="#frontend-application">7. Frontend application</a>
<ul class="sectlevel2">
<li><a href="#frontend-walkabout">7.1. Frontend walkabout</a></li>
<li><a href="#api-related-functions">7.2. API related functions</a></li>
<li><a href="#components">7.3. Components</a></li>
</ul>
</li>
<li><a href="#summary">8. Summary</a></li>
<li><a href="#optional-exercises">9. Optional exercises</a>
<ul class="sectlevel2">
<li><a href="#implement-http-api-endpoint-as-plugin-actions">9.1. Implement HTTP API endpoint as plugin actions</a></li>
<li><a href="#notify-an-account-owner-if-an-account-recovery-for-their-account-has-been-initialized">9.2. Notify an account owner, if an account recovery for their account has been initialized</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="srs-application-overview"><a class="anchor" href="#srs-application-overview"></a>SRS application overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="../_images/tutorials/srs/srs-overview.png" alt="srs overview"></span></p>
</div>
<div class="paragraph">
<p>As explained in the illustration above, it is necessary to create the following components:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The SRS module (on-chain)</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>6 new transaction assets for the SRS module</p>
</li>
<li>
<p>3 SRS-specific events</p>
</li>
</ol>
</div>
</li>
<li>
<p>Plugins (off-chain)</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The SRS data plugin</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>1 action</p>
</li>
</ol>
</div>
</li>
<li>
<p>The SRS API plugin</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>In addition to the blockchain application, a <strong>frontend application</strong> will also be implemented which will allow the user to interact with the blockchain application through a UI (User Interface), in the browser.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="project-setup"><a class="anchor" href="#project-setup"></a>1. Project setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create a new folder which will contain all the files for the SRS app.
The Social Recovery System consists of two applications: The blockchain application and the frontend application.
First, create the folder for the blockchain application, initialize a new Node.js project and install the <a href="../glossary.html#lisk-sdk" class="xref page">Lisk SDK</a> as a dependency.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir srs
mkdir srs/blockchain_app
cd srs/blockchain_app
npm init --yes
npm i lisk-sdk</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, create a new file <code>index.js</code> and paste the following:</p>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/index.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { Application, genesisBlockDevnet, configDevnet } = require('lisk-sdk');

const app = Application.defaultApplication(genesisBlockDevnet, configDevnet);

app
	.run()
	.then(() =&gt; app.logger.info('App started...'))
	.catch(error =&gt; {
		console.error('Faced error in application', error);
		process.exit(1);
	});</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code snippet creates a default blockchain application, which is configured for development purposes.
Use this app as the basis for the SRS app and extend it with a module and a plugin in the next steps to suit the desired use case.</p>
</div>
<div class="paragraph">
<p>At this point, it is already possible to start the blockchain application by running <code>node index.js</code> in the terminal.
To verify the successful start of the application, observe the logs in the terminal for possible errors.
If everything is correct, the application will start to add new blocks to the chain every 10 seconds after the initial start.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transaction-assets"><a class="anchor" href="#transaction-assets"></a>2. Transaction assets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Users shall have the ability to perform the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="0">
<li>
<p>Create recovery configs for their account.</p>
</li>
<li>
<p>Initiate a recovery for an account which has a recovery config.</p>
</li>
<li>
<p>Vouch for a rescuer account, if certain conditions are met.</p>
</li>
<li>
<p>Claim a recovery, if certain conditions are met.</p>
</li>
<li>
<p>Cancel a recovery, for example, if a lost passphrase from the old account was found again.</p>
</li>
<li>
<p>Remove a recovery config from the account.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="constants"><a class="anchor" href="#constants"></a>2.1. Constants</h3>
<div class="paragraph">
<p>Inside of the transaction assets, the following constants will be utilized:</p>
</div>
<table class="tableblock frame-all grid-all stripes-hover stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 20%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BASE_RECOVERY_DEPOSIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'1000000000'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The base recovery deposit, used to calculate the deposit for an account recovery.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FRIEND_FACTOR_FEE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The friend factor fee, used to calculate the deposit for an account recovery.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CREATE_RECOVERY_ASSET_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asset ID for the <code>CreateRecoveryAsset</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INITIATE_RECOVERY_ASSET_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asset ID for the <code>InitiateRecoveryAsset</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VOUCH_RECOVERY_ASSET_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asset ID for the <code>VouchRecoveryAsset</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CLAIM_RECOVERY_ASSET_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asset ID for the <code>ClaimRecoveryAsset</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CLOSE_RECOVERY_ASSET_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asset ID for the <code>CloseRecoveryAsset</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REMOVE_RECOVERY_ASSET_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asset ID for the <code>RemoveRecoveryAsset</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Create a new file <code>constants.js</code> and paste the following contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const BASE_RECOVERY_DEPOSIT = '1000000000';
const FRIEND_FACTOR_FEE = 2;
const CREATE_RECOVERY_ASSET_ID = 0;
const INITIATE_RECOVERY_ASSET_ID = 1;
const VOUCH_RECOVERY_ASSET_ID = 2;
const CLAIM_RECOVERY_ASSET_ID = 3;
const CLOSE_RECOVERY_ASSET_ID = 4;
const REMOVE_RECOVERY_ASSET_ID = 5;

module.exports = {
  BASE_RECOVERY_DEPOSIT,
  FRIEND_FACTOR_FEE,
  CREATE_RECOVERY_ASSET_ID,
  VOUCH_RECOVERY_ASSET_ID,
  CLAIM_RECOVERY_ASSET_ID,
  CLOSE_RECOVERY_ASSET_ID,
  INITIATE_RECOVERY_ASSET_ID,
  REMOVE_RECOVERY_ASSET_ID,
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="setting-up-module-and-transaction-folders"><a class="anchor" href="#setting-up-module-and-transaction-folders"></a>2.2. Setting up module and transaction folders</h3>
<div class="paragraph">
<p>Now, create the corresponding transaction assets for the SRS module.
These transaction assets each define both, the asset schema for the transaction data, and the logic how this data is applied and stored in the database.</p>
</div>
<div class="paragraph">
<p>Create a new folder <code>srs_module/</code> and inside another new folder <code>transactions</code>:</p>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir srs_module
mkdir srs_module/transactions <i class="conum" data-value="1"></i><b>(1)</b>
cd srs_module/transactions/</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a new folder <code>transactions/</code> which will contain the files for the transaction assets.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="createrecovery-asset"><a class="anchor" href="#createrecovery-asset"></a>2.3. createRecovery asset</h3>
<div class="paragraph">
<p>Create a new file <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/blockchain_app/srs_module/assets/create_recovery.js" target="_blank" rel="noopener">create_recovery.js</a> inside the newly created <code>transactions/</code> folder.</p>
</div>
<div class="paragraph">
<p>Now open the file and paste the code below:</p>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/srs_module/transactions/create_recovery.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { BaseAsset } = require("lisk-sdk");

// extend base asset to implement the custom asset
class CreateRecoveryAsset extends BaseAsset { <i class="conum" data-value="1"></i><b>(1)</b>

}

module.exports = CreateRecoveryAsset; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Extend from the base asset to implement a custom asset.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Export the asset, so it can be imported later into the custom module.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now all required properties for the transaction asset are defined in sequential order.</p>
</div>
<div class="sect3">
<h4 id="asset-id-and-name"><a class="anchor" href="#asset-id-and-name"></a>2.3.1. Asset ID and name</h4>
<div class="listingblock">
<div class="title">srs/blockchain_app/srs_module/transactions/create_recovery.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { BaseAsset } = require("lisk-sdk");
const { CREATE_RECOVERY_ASSET_ID } = require('../constants');

// extend base asset to implement your custom asset
class CreateRecoveryAsset extends BaseAsset {
  // define unique asset name and id
  name = "createRecovery"; <i class="conum" data-value="1"></i><b>(1)</b>
  id = CREATE_RECOVERY_ASSET_ID; <i class="conum" data-value="2"></i><b>(2)</b>
}

module.exports = CreateRecoveryAsset;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set the asset name to <code>"createRecovery"</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the asset ID to <code>CREATE_RECOVERY_ASSET_ID</code>(=0) from the <code>constants.js</code> file.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="asset-schema"><a class="anchor" href="#asset-schema"></a>2.3.2. Asset schema</h4>
<div class="paragraph">
<p>The asset schema describes the required datatypes and the structure of the data in the respective transaction asset.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For more information how schemas are used in the application, check out the <a href="../understand-blockchain/codec-schema.html" class="xref page">Codec &amp; schema</a> reference.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For creating a recovery configuration, the following information is required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>friends</code>: A list of trusted addresses.</p>
</li>
<li>
<p><code>recoveryThreshold</code>: Minimum amount of friends that need to vouch for a rescuer, before the rescuer can claim the recovery.</p>
</li>
<li>
<p><code>delayPeriod</code>: The minimum number of blocks required from the height at which the account recovery was initiated to successfully recover the account.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Create a new file <code>schemas.js</code>.
The schemas which are reused later in different places of the module and assets are stored here.</p>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/srs_module/schemas.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const createRecoverySchema = {
  $id: 'srs/recovery/create',
  type: 'object',
  required: ['friends', 'recoveryThreshold', 'delayPeriod'],
  properties: {
    friends: {
      type: 'array',
      fieldNumber: 1,
      items: {
        dataType: 'bytes',
      },
    },
    recoveryThreshold: {
      dataType: 'uint32',
      fieldNumber: 2,
    },
    delayPeriod: {
      dataType: 'uint32',
      fieldNumber: 3,
    },
  },
};

module.exports = { createRecoverySchema };</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now import the asset schema into <code>create_recovery.js</code>.</p>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/srs_module/transactions/create_recovery.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { BaseAsset } = require('lisk-sdk');
const { CREATE_RECOVERY_ASSET_ID } = require('../constants');
const { createRecoverySchema } = require('../schemas');

class CreateRecoveryAsset extends BaseAsset {
	name = 'createRecovery';
	id = CREATE_RECOVERY_ASSET_ID;
	schema = createRecoverySchema;
}

module.exports = CreateRecoveryAsset;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-apply-function"><a class="anchor" href="#the-apply-function"></a>2.3.3. The apply function</h4>
<div class="paragraph">
<p>The <code>apply()</code> function has access to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>asset</code>: the posted transaction asset.</p>
</li>
<li>
<p><code>stateStore</code>: The <a href="../../lisk-sdk/v5/references/lisk-elements/chain.html#state-store" class="xref page">state store</a> is a data structure that maintains a temporary state while processing a block.
It is used here to get and set certain data from and to the database.</p>
</li>
<li>
<p><code>reducerHandler</code>: This allows the usage of reducer functions of other modules inside the <code>apply()</code> function.</p>
</li>
<li>
<p><code>transaction</code>: the complete transaction object.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/srs_module/transactions/create_recovery.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { BaseAsset, transactions } = require('lisk-sdk');
const { createRecoverySchema } = require('../schemas');
const { BASE_RECOVERY_DEPOSIT, FRIEND_FACTOR_FEE, CREATE_RECOVERY_ASSET_ID } = require('../constants');

class CreateRecoveryAsset extends BaseAsset {
	name = 'createRecovery';
	id = CREATE_RECOVERY_ASSET_ID;
	schema = createRecoverySchema;

    async apply({
		asset,
		transaction,
		stateStore,
	}) {
        const sender = await stateStore.account.get(transaction.senderAddress);
        if (sender.srs.config &amp;&amp; sender.srs.config.friends.length !== 0) {
            throw Error('Account already has a recovery configuration.')
        }
        const sameAccount = asset.friends.find(f =&gt; f === sender.address);
        if (sameAccount) {
            throw new Error('You cannot add yourself to your own friend list.');
        }
        // Add friends to the list
        sender.srs.config.friends = [...asset.friends.sort()];
        // Minimum number of friends required to vouch
        sender.srs.config.recoveryThreshold = asset.recoveryThreshold;
        // Minimum number of blocks after recovery process when account will be recoverable
        sender.srs.config.delayPeriod = asset.delayPeriod;
        // Set the deposit based on number of friends, 10 + friends.length * 2
        const deposit = BigInt(BASE_RECOVERY_DEPOSIT) + BigInt(transactions.convertLSKToBeddows((sender.srs.config.friends.length * FRIEND_FACTOR_FEE).toString()));
        sender.srs.config.deposit = deposit;
        // Save the value in stateStore
        await stateStore.account.set(sender.address, sender);
    }
}

module.exports = CreateRecoveryAsset;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The other transaction assets are created analog to the <code>CreateRecoveryAsset</code>.
Examples and descriptions for every asset are displayed below.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="initiaterecovery-asset"><a class="anchor" href="#initiaterecovery-asset"></a>2.4. initiateRecovery asset</h3>
<div class="paragraph">
<p>Create a new file <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/blockchain_app/srs_module/assets/initiate_recovery.js" target="_blank" rel="noopener">initiate_recovery.js</a> inside the <code>transactions/</code> folder.
This will contain the logic for the transaction asset which initiates a recovery for a given account address.</p>
</div>
<div class="paragraph">
<p>The following logic is implemented:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The asset contains the property <code>lostAccount</code>, which is the address of the account that is intended to be recovered.</p>
</li>
<li>
<p>You cannot initiate a recovery for your own account.</p>
</li>
<li>
<p>The account in <code>lostAccount</code> needs to have a recovery configuration for a successful initialization.
If no recovery configuration is found, it should throw an error.</p>
</li>
<li>
<p>The rescuer needs to pay the deposit defined in the recovery configuration of the lost account.
If the rescuer doesn&#8217;t have an adequate balance, it should throw an error.</p>
</li>
<li>
<p>If no error is thrown, the recovery status of the lost account is updated in the following manner:</p>
<div class="ulist">
<ul>
<li>
<p>The recovery status is set to <code>true</code>.</p>
</li>
<li>
<p>The rescuer is set to the address of the sender of the <code>initiateRecovery</code> transaction.</p>
</li>
<li>
<p>The current blockchain height is saved to log when the recovery was initiated.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/srs_module/transactions/initiate_recovery.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { BaseAsset } = require('lisk-sdk');
const { initiateRecoverySchema } = require('../schemas');
const { INITIATE_RECOVERY_ASSET_ID } = require('../constants');


class InitiateRecoveryAsset extends BaseAsset {
	name = 'initiateRecovery';
	id = INITIATE_RECOVERY_ASSET_ID;
	schema = initiateRecoverySchema;

    async apply({
		asset,
		transaction,
		stateStore,
        reducerHandler,
	}) {
        const rescuer = await stateStore.account.get(transaction.senderAddress);
        const lostAccount = await stateStore.account.get(asset.lostAccount);

        const sameAccount = lostAccount.srs.config.friends.find(f =&gt; f === rescuer.address);
        if (sameAccount) {
            throw new Error('You cannot recover your own account.');
        }

        // Check if recovery configuration is present for the lost account or not
        if (lostAccount.srs.config &amp;&amp; lostAccount.srs.config.friends.length === 0) {
            throw Error('Lost account has no recovery configuration.')
        }

        const currentHeight = stateStore.chain.lastBlockHeaders[0].height;
        const deposit = lostAccount.srs.config.deposit;

        // Check if rescuer account has enough balance
        const rescuerBalance = await reducerHandler.invoke('token:getBalance', {
            address: rescuer.address,
        });

        if (deposit &gt; rescuerBalance) {
            throw new Error('Rescuer doesnt have enough balance to deposit for recovery process.');
        }
        // Deduct the balance from rescuer and update rescuer account
        await reducerHandler.invoke('token:debit', {
            address: rescuer.address,
            amount: deposit,
          });

        // Update lost account address to active recovery
        lostAccount.srs.status.active = true;
        lostAccount.srs.status.rescuer = rescuer.address;
        lostAccount.srs.status.created = currentHeight;
        lostAccount.srs.status.deposit = deposit;
        lostAccount.srs.status.vouchList = [];

        // Save lost account values to stateStore
        await stateStore.account.set(lostAccount.address, lostAccount);
    }
}

module.exports = InitiateRecoveryAsset;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="vouchrecovery-asset"><a class="anchor" href="#vouchrecovery-asset"></a>2.5. vouchRecovery asset</h3>
<div class="paragraph">
<p>Create a new file <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/blockchain_app/srs_module/assets/vouch_recovery.js" target="_blank" rel="noopener">vouch_recovery.js</a> inside the <code>transactions/</code> folder.
This will contain the logic for the transaction asset which allows friends to vouch for an account that initiated a recovery.</p>
</div>
<div class="paragraph">
<p>The following logic is implemented:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The asset contains:</p>
<div class="ulist">
<ul>
<li>
<p>the property <code>lostAccount</code>, which is the address of the account that is intended to be recovered.</p>
</li>
<li>
<p>the property <code>rescuer</code>, which is the address of the account that wants to recover the <code>lostAccount</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If the <code>rescuer</code> is not the account that has initiated a recovery for the <code>lostAccount</code> then an error will be thrown.</p>
</li>
<li>
<p>If the account that vouches for the rescuer is not listed under <code>friends</code> in the recovery config of the <code>lostAccount</code>, then an error will be thrown.</p>
</li>
<li>
<p>If the friend has vouched for the rescuer before, then an error will be thrown.</p>
</li>
<li>
<p>If all conditions are met, add the friend&#8217;s address to the <code>vouchList</code> in the <code>lostAccount</code> details.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/srs_module/transactions/vouch_recovery.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { BaseAsset } = require('lisk-sdk');
const { vouchRecoverySchema } = require('../schemas');
const { VOUCH_RECOVERY_ASSET_ID } = require('../constants');

class VouchRecoveryAsset extends BaseAsset {
	name = 'vouchRecovery';
	id = VOUCH_RECOVERY_ASSET_ID;
	schema = vouchRecoverySchema;

    async apply({
		asset,
		transaction,
		stateStore,
	}) {
        const sender = await stateStore.account.get(transaction.senderAddress);
        const lostAccount = await stateStore.account.get(asset.lostAccount);
        const rescuer = await stateStore.account.get(asset.rescuer);

        // Make sure rescuer and lost account match according to config settings
        if (!lostAccount.srs.status.rescuer.equals(rescuer.address)) {
            throw new Error(`Rescuer address is incorrect for the recovery of ${lostAccount.address.toString('hex')}`)
        }

        const found = lostAccount.srs.config.friends.find(f =&gt; f.equals(sender.address));
        // Make sure friend is present in the configuration
        if (!found) {
            throw new Error('The sender is not part of friends who can vouch for rescuer for recovery process.')
        }

        const foundSignature = lostAccount.srs.status.vouchList.find(f =&gt; f.equals(sender.address));
        // Make sure the friend has not already voted
        if (foundSignature) {
            throw new Error('The sender has already vouched for the rescuer for recovery process.')
        }

        // Push signature to vouch list
        lostAccount.srs.status.vouchList.push(sender.address);
        await stateStore.account.set(lostAccount.address, lostAccount);
    }
}

module.exports = VouchRecoveryAsset;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="claimrecovery-asset"><a class="anchor" href="#claimrecovery-asset"></a>2.6. claimRecovery asset</h3>
<div class="paragraph">
<p>Create a new file <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/blockchain_app/srs_module/assets/claim_recovery.js" target="_blank" rel="noopener">claim_recovery.js</a> inside the <code>transactions/</code> folder.
This will contain the logic for the transaction asset which allows the rescuer account to claim the tokens of the lost account after all conditions are met.</p>
</div>
<div class="paragraph">
<p>The following logic is implemented:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The asset contains the property <code>lostAccount</code>, which is the address of the account that is intended to be recovered.</p>
</li>
<li>
<p>If not enough blocks have passed since initialization of the recovery, then an error will be thrown.
The amount of blocks that need to have passed since initialization is defined in the <code>delayPeriod</code> property of the recovery configuration.</p>
</li>
<li>
<p>If not enough friends have vouched for the rescuer account, then an error will be thrown.
The amount of friends in the <code>vouchList</code> needs to be equal or greater than the <code>recoveryThreshold</code> property of the recovery configuration.</p>
</li>
<li>
<p>If all conditions are met then perform the following:</p>
<div class="ulist">
<ul>
<li>
<p>Transfer the balance from the <code>lostAccount</code> to the rescuer account.</p>
</li>
<li>
<p>Reset the recovery configuration and status of the <code>lostAccount</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is always required to leave a minimum account balance inside of the <code>lostAccount</code>, so it is not possible to empty it completely.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/srs_module/transactions/claim_recovery.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { BaseAsset } = require('lisk-sdk');
const { claimRecoverySchema } = require('../schemas');
const { CLAIM_RECOVERY_ASSET_ID } = require('../constants');

class ClaimRecoveryAsset extends BaseAsset {
	name = 'claimRecovery';
	id = CLAIM_RECOVERY_ASSET_ID;
	schema = claimRecoverySchema;

    async apply({
		asset,
		transaction,
		stateStore,
        reducerHandler,
	}) {
        const rescuer = await stateStore.account.get(transaction.senderAddress);
        const lostAccount = await stateStore.account.get(asset.lostAccount);

        const currentHeight = stateStore.chain.lastBlockHeaders[0].height;
        const delayPeriod = lostAccount.srs.config.delayPeriod;
        const recoveryThreshold = lostAccount.srs.config.recoveryThreshold;
        const deposit = lostAccount.srs.config.deposit;

        // Check if the delay period is passed to claim the recovery
        if ((currentHeight - rescuer.srs.status.created) &lt; delayPeriod) {
            throw new Error(`Cannot claim account before delay period of ${delayPeriod}.`);
        }

        // Check if the recovery has received minimum number of vouch from friends
        if (lostAccount.srs.status.vouchList.length &lt; recoveryThreshold) {
            throw new Error(`Cannot claim account until minimum threshold of ${lostAccount.srs.config.friends.length} friends have vouched.`);
        }

        const minBalance = await reducerHandler.invoke('token:getMinRemainingBalance');
        // Get the account balance of lost account
        const lostAccountBalance = await reducerHandler.invoke('token:getBalance', {
            address: lostAccount.address,
        });

        await reducerHandler.invoke('token:debit', {
            address: lostAccount.address,
            // Get the deposit back from the lost account as well as your own deposit that was locked
            amount: lostAccountBalance - minBalance,
        });

        await reducerHandler.invoke('token:credit', {
            address: rescuer.address,
            // Get the deposit back from the lost account as well as your own deposit that was locked
            amount: BigInt(2) * deposit + lostAccountBalance - minBalance,
        });

        // Reset recovery status
        await stateStore.account.set(rescuer.address, rescuer);
        // Reset all recovery values in the lost account
        lostAccount.srs.config.friends = [];
        lostAccount.srs.config.delayPeriod = 0;
        lostAccount.srs.config.recoveryThreshold = 0;
        lostAccount.srs.config.deposit = BigInt('0');
        lostAccount.srs.status.active = false;
        lostAccount.srs.status.rescuer = Buffer.from('');
        lostAccount.srs.status.created = 0;
        lostAccount.srs.status.deposit = BigInt('0');
        lostAccount.srs.status.vouchList = [];
        await stateStore.account.set(lostAccount.address, lostAccount);
	}
}

module.exports = ClaimRecoveryAsset;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="closerecovery-asset"><a class="anchor" href="#closerecovery-asset"></a>2.7. closeRecovery asset</h3>
<div class="paragraph">
<p>Create a new file <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/blockchain_app/srs_module/assets/close_recovery.js" target="_blank" rel="noopener">close_recovery.js</a> inside the <code>transactions/</code> folder.
This will contain the logic for the transaction asset which allows closing an active recovery, for example, in the case whereby the lost credentials were found.</p>
</div>
<div class="paragraph">
<p>The following logic is implemented:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The asset contains the property <code>rescuer</code>, which is the address of the account that initialized the account recovery.</p>
</li>
<li>
<p>An account recovery needs to be initialized for the account to be able to close it.</p>
</li>
<li>
<p>An active recovery can only be closed by the original account.</p>
</li>
<li>
<p>The deposit which was debited from the rescuer account during the recovery initialization is credited to the original account.</p>
</li>
<li>
<p>The recovery status in the original account is reset.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/srs_module/transactions/close_recovery.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { BaseAsset } = require('lisk-sdk');
const { closeRecoverySchema } = require('../schemas');
const { CLOSE_RECOVERY_ASSET_ID } = require('../constants');

class CloseRecoveryAsset extends BaseAsset {
	name = 'closeRecovery';
	id = CLOSE_RECOVERY_ASSET_ID;
	schema = closeRecoverySchema;

    async apply({
		asset,
		transaction,
		stateStore,
        reducerHandler,
	}) {
        const lostAccount = await stateStore.account.get(transaction.senderAddress);
        if (!lostAccount.srs.status.active) {
            throw new Error(`No active recovery found for address ${lostAccount.address.toString('hex')}.`);
        }
        if (!lostAccount.srs.status.rescuer.equals(asset.rescuer)) {
            throw new Error(`Incorrect rescuer address`);
        }

        await reducerHandler.invoke('token:credit', {
            address: lostAccount.address,
            amount: lostAccount.srs.config.deposit,
          });

        // Reset recovery status
        lostAccount.srs.status.active = false;
        lostAccount.srs.status.rescuer = Buffer.from('');
        lostAccount.srs.status.created = 0;
        lostAccount.srs.status.deposit = BigInt('0');
        lostAccount.srs.status.vouchList = [];
        await stateStore.account.set(lostAccount.address, lostAccount);
    }
}

module.exports = CloseRecoveryAsset;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="removerecovery-asset"><a class="anchor" href="#removerecovery-asset"></a>2.8. removeRecovery asset</h3>
<div class="paragraph">
<p>Create a new file <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/blockchain_app/srs_module/assets/remove_recovery.js" target="_blank" rel="noopener">remove_recovery.js</a> inside the <code>transactions/</code> folder.
This will contain the logic for the transaction asset which allows the owner of an account to remove a previously created recovery configuration from their account.</p>
</div>
<div class="paragraph">
<p>The following logic is implemented:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The asset contains the property <code>lostAccount</code>.</p>
</li>
<li>
<p>Only accounts with created recovery configurations can remove the configurations again (obviously).</p>
</li>
<li>
<p>The recovery status has to be inactive to be able to remove a recovery configuration.</p>
</li>
<li>
<p>If the conditions are met, the recovery config and status inside the original account are reset completely.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/srs_module/transactions/remove_recovery.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const {
	BaseAsset
} = require('lisk-sdk');
const { removeRecoverySchema } = require('../schemas');
const { REMOVE_RECOVERY_ASSET_ID } = require('../constants');

class RemoveRecoveryAsset extends BaseAsset {
	name = 'removeRecovery';
	id = REMOVE_RECOVERY_ASSET_ID;
	schema = removeRecoverySchema;

	async apply({
		transaction,
		stateStore,
		reducerHandler,
	}) {
		const lostAccount = await stateStore.account.get(transaction.senderAddress);

		if (lostAccount.srs.config.friends.length === 0) {
			throw Error('Account does not have a recovery configuration.')
		}

		if (lostAccount.srs.status.active) {
			throw Error('There is active recovery in process. Please close the recovery to remove recovery configuration.')
		}

		// Reset all the default values
		lostAccount.srs.config.friends = [];
		lostAccount.srs.config.recoveryThreshold = 0;
		lostAccount.srs.config.delayPeriod = 0;
		lostAccount.srs.config.deposit = BigInt('0');
		lostAccount.srs.status.rescuer = Buffer.from('');
		lostAccount.srs.status.deposit = BigInt('0');
		lostAccount.srs.status.vouchList = [];
		lostAccount.srs.status.created = 0;
		lostAccount.srs.status.active = false;
		await stateStore.account.set(lostAccount.address, lostAccount);
	}
}

module.exports = RemoveRecoveryAsset;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Don&#8217;t forget to update  <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/blockchain_app/srs_module/schemas.js" target="_blank" rel="noopener">schemas.js</a> to include the schemas of the new transaction assets.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now that all the transaction assets are implemented, the SRS module can be created which will contain the newly created assets and some additional logic.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-srs-module"><a class="anchor" href="#the-srs-module"></a>3. The SRS module</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Inside the srs_module/ folder, create a new file <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/blockchain_app/srs_module/index.js" target="_blank" rel="noopener">index.js</a>.</p>
</div>
<div class="paragraph">
<p>Open <code>index.js</code> and create the skeleton which will contain all parts of the SRS module:</p>
</div>
<div class="sect2">
<h3 id="module-id-and-name"><a class="anchor" href="#module-id-and-name"></a>3.1. Module ID and name</h3>
<div class="paragraph">
<p>Set the unique identifier for the SRS module to <code>srs</code>, and the module ID to <code>1026</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Module ID until 1000 is reserved by Lisk SDK for future default modules.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { BaseModule } = require('lisk-sdk');

// Extend from the base module to implement a custom module
class SRSModule extends BaseModule {
  name = 'srs';
  id = 1026;
}

module.exports = { SRSModule };</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-account-schema"><a class="anchor" href="#the-account-schema"></a>3.2. The account schema</h3>
<div class="paragraph">
<p>Open the <code>schemas.js</code> file again which was created in section <a href="#asset-schema">Asset schema</a>, and add the account schema for the SRS module:</p>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/srs_module/schemas.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">//...

const SRSAccountSchema = {
    type: 'object',
    required: ['config'],
    properties: {
      config: {
        fieldNumber: 1,
        type: 'object',
        required: ['friends'],
        properties: {
          friends: {
              type: 'array',
              fieldNumber: 1,
              items: {
                  dataType: 'bytes',
              },
          },
          recoveryThreshold: {
              dataType: 'uint32',
              fieldNumber: 2,
          },
          delayPeriod: {
              dataType: 'uint32',
              fieldNumber: 3,
          },
          deposit: {
            dataType: 'uint64',
            fieldNumber: 4,
          }
        },
        default: {
          friends: [],
          recoveryThreshold: 0,
		  delayPeriod: 0,
        },
      },
      status: {
        fieldNumber: 2,
        type: 'object',
        properties: {
          rescuer: {
            dataType: 'bytes',
            fieldNumber: 1,
          },
          created: {
            dataType: 'uint32',
            fieldNumber: 2,
          },
          deposit: {
            dataType: 'uint64',
            fieldNumber: 3,
          },
          vouchList: {
            type: 'array',
            fieldNumber: 4,
            items: {
                dataType: 'bytes',
            },
          },
          active: {
            dataType: 'boolean',
            fieldNumber: 5,
          },
        },
      }
    },
    default: {
    config: {
      friends: [],
      recoveryThreshold: 0,
      delayPeriod: 0,
    },
    status: {
      active: false,
      vouchList: [],
      created: 0,
      deposit: BigInt(0),
      rescuer: Buffer.from(''),
    },
  },
};

module.exports = { SRSAccountSchema, createRecoverySchema, initiateRecoverySchema, removeRecoverySchema };</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now use the <code>SRSAccountSchema</code> inside of the module:</p>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/srs_module/index.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { BaseModule } = require('lisk-sdk');
const { SRSAccountSchema } = require('./schemas');

// Extend from the base module to implement a custom module
class SRSModule extends BaseModule {
  name = 'srs';
  id = 1026;
  accountSchema = SRSAccountSchema;

}

module.exports = { SRSModule };</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="importing-the-transaction-assets-into-the-module"><a class="anchor" href="#importing-the-transaction-assets-into-the-module"></a>3.3. Importing the transaction assets into the module</h3>
<div class="paragraph">
<p>Now let&#8217;s import the transactions which were created in section 2: <a href="#transaction-assets">Transaction assets</a> into the module.</p>
</div>
<div class="paragraph">
<p>Add them to the <code>tansactionAssets</code> property as shown in the snippet below:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Best practice</div>
<div class="paragraph">
<p>It is good practice to name the imported transaction assets after their corresponding classname.</p>
</div>
<div class="paragraph">
<p>In this example: <code>CreateRecoveryAsset</code>, <code>InitiateRecoveryAsset</code>, <code>VouchRecoveryAsset</code>, <code>ClaimRecoveryAsset</code>, <code>CloseRecoveryAsset</code>, and <code>RemoveRecoveryAsset</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/srs_module/index.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { BaseModule } = require('lisk-sdk');
const CreateRecoveryAsset = require('./assets/create_recovery');
const ClaimRecoveryAsset = require('./assets/claim_recovery');
const InitiateRecoveryAsset = require('./assets/initiate_recovery');
const VouchRecoveryAsset = require('./assets/vouch_recovery');
const CloseRecoveryAsset = require('./assets/close_recovery');
const RemoveRecoveryAsset = require('./assets/remove_recovery');
const { SRSAccountSchema } = require('./schemas');

// Extend from the base module to implement a custom module
class SRSModule extends BaseModule {
  name = 'srs';
  id = 1026;
  accountSchema = SRSAccountSchema;

  transactionAssets = [
    new CreateRecoveryAsset(),
    new InitiateRecoveryAsset(),
    new VouchRecoveryAsset(),
    new ClaimRecoveryAsset(),
    new CloseRecoveryAsset(),
    new RemoveRecoveryAsset(),
  ];
}

module.exports = { SRSModule };</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="events"><a class="anchor" href="#events"></a>3.4. Events</h3>
<div class="paragraph">
<p>As described in section <a href="#srs-application-overview">SRS application overview</a>, define three different events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>configCreated</code></p>
</li>
<li>
<p><code>configRemoved</code></p>
</li>
<li>
<p><code>recoveryInitiated</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/srs_module/index.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { BaseModule } = require('lisk-sdk');
const CreateRecoveryAsset = require('./assets/create_recovery');
const ClaimRecoveryAsset = require('./assets/claim_recovery');
const InitiateRecoveryAsset = require('./assets/initiate_recovery');
const VouchRecoveryAsset = require('./assets/vouch_recovery');
const CloseRecoveryAsset = require('./assets/close_recovery');
const RemoveRecoveryAsset = require('./assets/remove_recovery');
const { SRSAccountSchema } = require('./schemas');

// Extend from the base module to implement a custom module
class SRSModule extends BaseModule {
  name = 'srs';
  id = 1026;
  accountSchema = SRSAccountSchema;

  transactionAssets = [
    new CreateRecoveryAsset(),
    new InitiateRecoveryAsset(),
    new VouchRecoveryAsset(),
    new ClaimRecoveryAsset(),
    new CloseRecoveryAsset(),
    new RemoveRecoveryAsset(),
  ];

  events = ['configCreated','configRemoved','recoveryInitiated'];
}

module.exports = { SRSModule };</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lifecycle-hooks"><a class="anchor" href="#lifecycle-hooks"></a>3.5. Lifecycle hooks</h3>
<div class="paragraph">
<p>Use the life cycle hooks of the module to publish the events that were just created in the <a href="#events">Events</a> section.</p>
</div>
<div class="paragraph">
<p>The hook <code>afterTransactionApply()</code> is used here.
It is executed each time after a transaction is applied on the blockchain.</p>
</div>
<div class="paragraph">
<p>The following events are fired:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>srs:configCreated</code> when a <strong>create recovery</strong> transaction is applied.</p>
</li>
<li>
<p><code>srs:configRemoved</code> when a <strong>claim recovery</strong> or a <strong>remove recovery</strong> transaction is applied.</p>
</li>
<li>
<p><code>srs:recoveryInitiated</code> when a <strong>initiateRecovery</strong> transaction is applied.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/srs_module/index.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { BaseModule, codec } = require('lisk-sdk');
const CreateRecoveryAsset = require('./assets/create_recovery');
const ClaimRecoveryAsset = require('./assets/claim_recovery');
const InitiateRecoveryAsset = require('./assets/initiate_recovery');
const VouchRecoveryAsset = require('./assets/vouch_recovery');
const CloseRecoveryAsset = require('./assets/close_recovery');
const RemoveRecoveryAsset = require('./assets/remove_recovery');
const {
  SRSAccountSchema,
  createRecoverySchema,
  initiateRecoverySchema,
  claimRecoverySchema
} = require('./schemas');
const {
  CREATE_RECOVERY_ASSET_ID,
  CLAIM_RECOVERY_ASSET_ID,
  INITIATE_RECOVERY_ASSET_ID,
  REMOVE_RECOVERY_ASSET_ID
} = require('./constants');

class SRSModule extends BaseModule {
  name = 'srs';
  id = 1026;
  accountSchema = SRSAccountSchema;

  transactionAssets = [
    new CreateRecoveryAsset(),
    new InitiateRecoveryAsset(),
    new VouchRecoveryAsset(),
    new ClaimRecoveryAsset(),
    new CloseRecoveryAsset(),
    new RemoveRecoveryAsset(),
  ];

  events = ['configCreated','configRemoved','recoveryInitiated'];

  async afterTransactionApply({transaction, stateStore, reducerHandler}) {
    if (transaction.moduleID === this.id &amp;&amp; transaction.assetID === CREATE_RECOVERY_ASSET_ID) {
      let createRecoveryAsset = codec.decode(
        createRecoverySchema,
        transaction.asset
      );
      const friends = createRecoveryAsset.friends.map(bufferFriend =&gt; bufferFriend.toString('hex'));
      this._channel.publish('srs:configCreated', {
         address: transaction._senderAddress.toString('hex'),
         friends: friends,
         recoveryThreshold: createRecoveryAsset.recoveryThreshold,
         delayPeriod: createRecoveryAsset.delayPeriod
      });
    } else if (transaction.moduleID === this.id &amp;&amp; transaction.assetID === REMOVE_RECOVERY_ASSET_ID) {
      this._channel.publish('srs:configRemoved', {
        address: transaction._senderAddress.toString('hex')
      });
    } else if (transaction.moduleID === this.id &amp;&amp; transaction.assetID === CLAIM_RECOVERY_ASSET_ID) {
      let claimRecoveryAsset = codec.decode(
        claimRecoverySchema,
        transaction.asset
      );
      this._channel.publish('srs:configRemoved', {
        address: claimRecoveryAsset.lostAccount.toString('hex')
      });
    } else if (transaction.moduleID === this.id &amp;&amp; transaction.assetID === INITIATE_RECOVERY_ASSET_ID) {
      const initiateRecoveryAsset = codec.decode(
        initiateRecoverySchema,
        transaction.asset
      );
      this._channel.publish('srs:recoveryInitiated', {
        address: transaction._senderAddress.toString('hex'),
        asset: initiateRecoveryAsset
      });
    }
  };

}

module.exports = { SRSModule };</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation of the SRS module is now complete.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-srs-data-plugin"><a class="anchor" href="#the-srs-data-plugin"></a>4. The SRS data plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To be able to conveniently acquire a list of all accounts which created a recovery configuration, create a custom plugin.</p>
</div>
<div class="paragraph">
<p>First, navigate out of the <code>srs_module</code> folder, and create a new folder <code>plugins</code> for the two plugins we will create for the SRS application.
Inside the <code>plugins</code> folder, create a new folder <code>srs_data_plugin</code>, which will be used to store the files for the new plugin.</p>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir plugins
mkdir plugins/srs_data_plugin
cd plugins/srs_data_plugin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now create a new file <code>index.js</code> inside the newly created <code>srs_data_plugin/</code> folder.</p>
</div>
<div class="paragraph">
<p>Open <code>index.js</code> and create the skeleton, which will contain all parts of the SRS data plugin:</p>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/plugins/srs_data_plugin/index.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { BasePlugin } = require('lisk-sdk');
const pJSON = require('../../package.json');

class SRSDataPlugin extends BasePlugin { <i class="conum" data-value="1"></i><b>(1)</b>

  static get alias() { <i class="conum" data-value="2"></i><b>(2)</b>
    return 'SRSData';
  }

  static get info() { <i class="conum" data-value="3"></i><b>(3)</b>
    return {
      author: pJSON.author,
      version: pJSON.version,
      name: pJSON.name,
    };
  }

  get defaults() {
    return {};
  }

  get events() {
    return [];
  }
}

module.exports = { SRSDataPlugin }; <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Extend from the base plugin to implement a custom plugin.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the alias for the plugin to <code>SRSData</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Set the meta information for the plugin.
Here, the data is reused from the <code>package.json</code> file.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Export the plugin, so it can be imported later into the application.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="the-load-function"><a class="anchor" href="#the-load-function"></a>4.1. The <code>load()</code> function</h3>
<div class="paragraph">
<p>The following helper functions and constants are defined:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getDBInstance()</code></dt>
<dd>
<p>Returns a key-value store for the plugin data, which is stored under the path <code>~/.lisk/srs-app/plugins/data/srs_data_plugin.db</code>.</p>
</dd>
<dt class="hdlist1"><code>encodedConfigAccountsSchema</code></dt>
<dd>
<p>The schema describes how the accounts and their recovery configurations are saved in the database.
We define the following schema for the plugin data:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "accounts": [
    {
      "address": bytes,
      "friends": array[bytes],
      "recoveryThreshold": number,
      "delayPeriod": number
    }
  ]
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getConfigAccounts(database)</code></dt>
<dd>
<p>A helper function that returns the list of all accounts with recovery configurations from the database.
Inside the <code>getConfigAccounts()</code> function, use the database key <code>srs:configAccounts</code> to get the accounts from the database.
If there are no accounts saved in the database yet, then an empty list is returned.</p>
</dd>
<dt class="hdlist1"><code>saveConfigAccounts(database,accounts)</code></dt>
<dd>
<p>A helper function that saves the list of all accounts with recovery configurations to the database.
Inside the <code>saveConfigAccounts()</code> function, encode the accounts list for the database.
Use the above defined <code>encodedConfigAccountsSchema</code> for this purpose.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/plugins/srs_data_plugin/index.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { BasePlugin, db, codec } = require('lisk-sdk');
const pJSON = require('../../package.json');
const fs_extra = require("fs-extra");
const os = require("os");
const path = require("path");

const DB_KEY_CONFIGACCOUNTS = "srs:configAccounts";

const getDBInstance = async (dataPath = '~/.lisk/srs-app/', dbName = 'srs_data_plugin.db') =&gt; {
  const dirPath = path.join(dataPath.replace('~', os.homedir()), 'plugins/data', dbName);
  await fs_extra.ensureDir(dirPath);
  return new db.KVStore(dirPath);
};

const encodedConfigAccountsSchema = {
  $id: 'srs:configAccounts',
  type: 'object',
  required: ['accounts'],
  properties: {
    accounts: {
      type: 'array',
      fieldNumber: 1,
      items: {
        type: 'object',
        properties: {
          address: {
            dataType: 'bytes',
            fieldNumber: 1,
          },
          friends: {
            type: 'array',
            fieldNumber: 2,
            items: {
              dataType: 'bytes',
            }
          },
          recoveryThreshold: {
            dataType: 'uint32',
            fieldNumber: 3
          },
          delayPeriod: {
            dataType: 'uint32',
            fieldNumber: 4
          }
        }
      },
    },
  },
};

const getConfigAccounts = async (database) =&gt; {
  try {
    const encodedConfigAccounts = await database.get(DB_KEY_CONFIGACCOUNTS);
    const { accounts } = codec.decode(encodedConfigAccountsSchema, encodedConfigAccounts);
    return accounts;
  }
  catch (error) {
    return [];
  }
};

const saveConfigAccounts = async (database, accounts) =&gt; {
  const encodedConfigs = codec.encode(encodedConfigAccountsSchema, { accounts });

  await database.put(DB_KEY_CONFIGACCOUNTS, encodedConfigs);
};

class SRSDataPlugin extends BasePlugin {
  _accountsWithConfig = undefined;
  _db = undefined;

  static get alias() {
    return 'SRSData';
  }

  static get info() {
    return {
      author: pJSON.author,
      version: pJSON.version,
      name: pJSON.name,
    };
  }

  get defaults() {
    return {};
  }

  get events() {
    return [];
  }

  async load(channel) {
    this._db = await getDBInstance(); <i class="conum" data-value="1"></i><b>(1)</b>
    this._accountsWithConfig =  await getConfigAccounts(this._db); <i class="conum" data-value="2"></i><b>(2)</b>
    channel.subscribe('srs:createdConfig', async (info) =&gt; { <i class="conum" data-value="3"></i><b>(3)</b>

      let duplicate = false;
      for (let i = 0; i &lt; this._accountsWithConfig.length; i++) {
        if (this._accountsWithConfig[i].address.toString('hex') === info.address) { <i class="conum" data-value="4"></i><b>(4)</b>
          duplicate = true;
          return;
        }
      }
      if (!duplicate){
        info.address = Buffer.from(info.address, 'hex'); <i class="conum" data-value="5"></i><b>(5)</b>
        info.friends = info.friends.map(friend =&gt; Buffer.from(friend, 'hex'));
        this._accountsWithConfig.push(info);
      }
      await saveConfigAccounts(this._db, this._accountsWithConfig); <i class="conum" data-value="6"></i><b>(6)</b>
    });
    channel.subscribe('srs:removedConfig', async (info) =&gt; { <i class="conum" data-value="7"></i><b>(7)</b>
      for (let i = 0; i &lt; this._accountsWithConfig.length; i++) {
        if (this._accountsWithConfig[i].address.toString('hex') === info.address) { <i class="conum" data-value="8"></i><b>(8)</b>
          this._accountsWithConfig.splice(i, 1);
          return;
        }
      }
      await saveConfigAccounts(this._db, this._accountsWithConfig); <i class="conum" data-value="9"></i><b>(9)</b>
    });
  }

  async unload() {
  }
}

module.exports = { SRSDataPlugin };</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The database instance for the SRS data plugin is stored in the variable <code>this._db</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The accounts with recovery config are retrieved from the database by calling the above defined function <code>getConfigAccounts()</code> and then stored in the variable <code>this._accountsWithConfig</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Next subscribe to the event <code>srs:createdConfig</code>, which was previously implemented in the section <a href="#the-srs-module">The SRS module</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If a new config was created, check if <code>this._accountsWithConfig</code> already contains this account.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If it doesn&#8217;t contain the account yet, prepare the account addresses for the database by converting them into Buffers.
Then push the data into the array <code>this._accountsWithConfig</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The above defined function <code>saveConfigAccounts()</code> is called to save the updated accounts list in the database.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Now listen to a second event <code>srs:removedConfig</code>, which was previously implemented in the section <a href="#the-srs-module">The SRS module</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>If the event <code>srs:removedConfig</code> is received, check if the respective account is part of the list <code>this._accountsWithConfig</code>.
If it is found, the account will be removed from the list.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>The above defined function <code>saveConfigAccounts()</code> is called to save the updated accounts list in the database.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="create-an-action-to-get-all-accounts-with-recovery-configs"><a class="anchor" href="#create-an-action-to-get-all-accounts-with-recovery-configs"></a>4.2. Create an action to get all accounts with recovery configs</h3>
<div class="paragraph">
<p>To make the plugin data available to the public, create a new action that returns a list of all accounts with recovery configuration.</p>
</div>
<div class="paragraph">
<p>Add the following code snippet to the existing properties in the <code>SRSDataPlugin</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">get actions() {
  return {
    getAllRecoveryConfigs: () =&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
      let stringAccounts = this._accountsWithConfig.map((account) =&gt; { <i class="conum" data-value="2"></i><b>(2)</b>
        account.address = account.address.toString('hex');
        account.friends = account.friends.map(friend =&gt; friend.toString('hex'));
        return account;
      });
      return stringAccounts; <i class="conum" data-value="3"></i><b>(3)</b>
    },
  };
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We give the action the name <code>getAllRecoveryConfigs</code>.
The action can be invoked by external services by referring to it as shown here: <code>SRSDataPlugin:getAllRecoveryConfigs</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The account addresses are converted from Buffer to String format for all accounts in <code>this._accountsWithConfig</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The list of all accounts with recovery configs with addresses in hex string format is returned.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The SRS data plugin is now complete.
This will allow the frontend application to receive the list of all accounts with a recovery configuration by connecting to the blockchain application via WebSockets, and invoking the respective action.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-srs-api-plugin"><a class="anchor" href="#the-srs-api-plugin"></a>5. The SRS API plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The SRS API plugin provides HTTP API endpoints to create and post the different transactions of the SRS module, and also for the token transfer transaction.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This could be realized alternatively without an HTTP API, by using a WebSocket connection to the blockchain application, as realized in the SRS data plugin.
Instead of providing new HTTP API endpoints, the same could be achieved by adding multiple new actions to the plugin, that can be invoked later by the frontend application.</p>
</div>
<div class="paragraph">
<p>As an exercise, you could optionally try to implement all the HTTP endpoints of the SRS API plugin as plugin actions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>First, navigate out of the <code>srs_data_plugin</code> folder, and create a new folder which will be used to store the files for the SRS API plugin.</p>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/plugins/</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir srs_api_plugin
cd srs_api_plugin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then create a new file <code>index.js</code> inside the newly created <code>srs_api_plugin/</code> folder.</p>
</div>
<div class="paragraph">
<p>Open <code>index.js</code> and paste the following snippet:</p>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/plugins/srs_api_plugin/index.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { BasePlugin } = require('lisk-sdk');
const pJSON = require('../../package.json');

// 1.plugin can be a daemon/HTTP/Websocket service for off-chain processing
class SRSAPIPlugin extends BasePlugin {
  _server = undefined;
  _app = undefined;
  _channel = undefined;
  _db = undefined;
  _nodeInfo = undefined;

  static get alias() {
    return 'SRSHttpApi';
  }

  static get info() {
    return {
      author: pJSON.author,
      version: pJSON.version,
      name: pJSON.name,
    };
  }

  get defaults() {
    return {};
  }

  get events() {
    return [];
  }

  get actions() {
    return {};
  }
}

module.exports = { SRSAPIPlugin };</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="controllers"><a class="anchor" href="#controllers"></a>5.1. Controllers</h3>
<div class="paragraph">
<p>Next we will define multiple controllers for creating and posting the different transaction objects.</p>
</div>
<div class="paragraph">
<p>Create a new folder to store the different controllers for the API endpoints.</p>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/plugins/srs_api_plugin/</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir controllers
cd controllers</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside the folder, it is necessary to define the following controllers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/blockchain_app/srs_api_plugin/controllers/transfer_token_api.js" target="_blank" rel="noopener">transferToken</a>: Creates a transfer transaction and sends it to the blockchain application.</p>
</li>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/blockchain_app/srs_api_plugin/controllers/create_recovery_api.js" target="_blank" rel="noopener">createRecoveryConfigTrs</a>: Creates a createRecovery transaction and sends it to the blockchain application.</p>
</li>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/blockchain_app/srs_api_plugin/controllers/initiate_recovery_api.js" target="_blank" rel="noopener">initiateRecovery</a>: Creates a initiateRecovery transaction and sends it to the blockchain application.</p>
</li>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/blockchain_app/srs_api_plugin/controllers/vouch_recovery_api.js" target="_blank" rel="noopener">vouchRecovery</a>: Creates a vouchRecovery transaction and sends it to the blockchain application.</p>
</li>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/blockchain_app/srs_api_plugin/controllers/claim_recovery_api.js" target="_blank" rel="noopener">claimRecovery</a>: Creates a claimRecovery transaction and sends it to the blockchain application.</p>
</li>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/blockchain_app/srs_api_plugin/controllers/close_recovery_api.js" target="_blank" rel="noopener">closeRecovery</a>: Creates a closeRecovery transaction and sends it to the blockchain application.</p>
</li>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/blockchain_app/srs_api_plugin/controllers/remove_recovery_api.js" target="_blank" rel="noopener">removeRecovery</a>: Creates a removeRecovery transaction and sends it to the blockchain application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only the <code>createRecoveryConfigTrs</code> controller is explained here in detail, as the implementation of the different controllers is very similar.</p>
</div>
<div class="paragraph">
<p>Feel free to copy and paste the files above from GitHub into your own project.</p>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/plugins/srs_api_plugin/controllers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { transactions, cryptography } = require('@liskhq/lisk-client');
const { createRecoverySchema } = require('../schemas');
const { SRS_CREATE_ASSET_ID, SRS_MODULE_ID, DEFAULT_FEE } = require('../constants');

const createRecoveryConfigTrs = (
    codec,
    channel,
    nodeInfo,
) =&gt; async (req, res) =&gt; {
    try {
        const { passphrase, friends, delayPeriod, recoveryThreshold, fee } = req.body;
        const asset = { <i class="conum" data-value="1"></i><b>(1)</b>
            friends: friends.map(f =&gt; Buffer.from(f, 'hex')),
            delayPeriod: +delayPeriod,
            recoveryThreshold: +recoveryThreshold,
        };

        const { publicKey } = cryptography.getPrivateAndPublicKeyFromPassphrase(
            passphrase
        );
        const address = cryptography.getAddressFromPassphrase(passphrase);
        const account = await channel.invoke('app:getAccount', {
            address,
        });
        const { sequence: { nonce } } = codec.decodeAccount(account);

        const { id, ...tx } = transactions.signTransaction( <i class="conum" data-value="2"></i><b>(2)</b>
            createRecoverySchema,
            {
                moduleID: SRS_MODULE_ID,
                assetID: SRS_CREATE_ASSET_ID,
                nonce: BigInt(nonce),
                fee: fee || DEFAULT_FEE,
                senderPublicKey: publicKey,
                asset,
            },
            Buffer.from(nodeInfo.networkIdentifier, 'hex'),
            passphrase,
        );

        const encodedTransaction = codec.encodeTransaction(tx); <i class="conum" data-value="3"></i><b>(3)</b>
        const result = await channel.invoke('app:postTransaction', { <i class="conum" data-value="4"></i><b>(4)</b>
          transaction: encodedTransaction,
        });

        res.status(200).json({ data: result, meta: {} }); <i class="conum" data-value="4"></i><b>(4)</b>
      } catch (err) {
        res.status(409).json({
          errors: [{ message: err.message }],
        });
      }
};

module.exports = {
    createRecoveryConfigTrs,
};</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create the transaction asset for the <code>createRecovery</code> transaction, based on the request data.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create and sign the transaction object by utilizing the <code>signTransaction()</code> method of the <code>transactions</code> library.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Prepare the transaction by encoding it with the <code>encodeTransaction()</code> method of the <code>codec</code> library.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Sets the HTTP status for the API response.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="the-load-and-unload-functions"><a class="anchor" href="#the-load-and-unload-functions"></a>5.2. The <code>load()</code> and <code>unload()</code> functions</h3>
<div class="paragraph">
<p>Go back to the <code>index.js</code> file and define what logic shall be executed by the plugin.
Now that all of the controllers are prepared, they can be reused in the <code>SRSAPIPlugin</code> to provide the corresponding API endpoints for each controller.</p>
</div>
<div class="paragraph">
<p>Add the new function <code>load()</code> into the <code>SRSAPIPlugin</code> with the following contents:</p>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/plugins/srs_api_plugin/index.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const express = require('express');
const cors = require('cors');
const { BasePlugin } = require('lisk-sdk');
const pJSON = require('../../package.json');
const controllers = require('./controllers');

// 1.plugin can be a daemon/HTTP/Websocket service for off-chain processing
class SRSAPIPlugin extends BasePlugin {
  _server = undefined;
  _app = undefined;
  _channel = undefined;
  _db = undefined;
  _nodeInfo = undefined;

  static get alias() {
    return 'SRSHttpApi';
  }

  static get info() {
    return {
      author: pJSON.author,
      version: pJSON.version,
      name: pJSON.name,
    };
  }

  get defaults() {
    return {};
  }

  get events() {
    return [];
  }

  get actions() {
    return {};
  }

  async load(channel) {
    this._app = express(); <i class="conum" data-value="1"></i><b>(1)</b>
    this._channel = channel;
    this._nodeInfo = await this._channel.invoke('app:getNodeInfo');

    this._app.use(cors({ origin: '*', methods: ['GET', 'POST', 'PUT'] })); <i class="conum" data-value="2"></i><b>(2)</b>
    this._app.use(express.json()); <i class="conum" data-value="3"></i><b>(3)</b>

    this._app.post('/api/token/transfer', controllers.transferToken(this.codec, this._channel, this._nodeInfo)); <i class="conum" data-value="4"></i><b>(4)</b>
    this._app.post('/api/recovery/create', controllers.createRecoveryConfigTrs(this.codec, this._channel, this._nodeInfo));
    this._app.post('/api/recovery/initiate', controllers.initiateRecovery(this.codec, this._channel, this._nodeInfo));
    this._app.post('/api/recovery/vouch', controllers.vouchRecovery(this.codec, this._channel, this._nodeInfo));
    this._app.post('/api/recovery/claim', controllers.claimRecovery(this.codec, this._channel, this._nodeInfo));
    this._app.post('/api/recovery/close', controllers.closeRecovery(this.codec, this._channel, this._nodeInfo));
    this._app.post('/api/recovery/remove', controllers.removeRecovery(this.codec, this._channel, this._nodeInfo));

    this._server = this._app.listen(8080, '0.0.0.0'); <i class="conum" data-value="5"></i><b>(5)</b>
  }

  async unload() { <i class="conum" data-value="6"></i><b>(6)</b>
    // close http server
    await new Promise((resolve, reject) =&gt; {
      this._server.close((err) =&gt; {
        if (err) {
          reject(err);
          return;
        }
        resolve();
      });
    });
  }
}

module.exports = { SRSAPIPlugin };</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start the Express server and save it under the variable <code>this._app</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Enable cross-origin resource sharing.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Recognize the incoming request object as a JSON Object.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Define 7 different endpoints:
<div class="ulist">
<ul>
<li>
<p>POST <code>/api/token/transfer</code></p>
</li>
<li>
<p>POST <code>/api/recovery/create</code></p>
</li>
<li>
<p>POST <code>/api/recovery/initiate</code></p>
</li>
<li>
<p>POST <code>/api/recovery/vouch</code></p>
</li>
<li>
<p>POST <code>/api/recovery/claim</code></p>
</li>
<li>
<p>POST <code>/api/recovery/close</code></p>
</li>
<li>
<p>POST <code>/api/recovery/remove</code></p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The API listens on port <code>8080</code> at localhost.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>This will close the Express server when the plugin is unloaded again, for example on application shutdown.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The SRS data plugin is now complete.
It will allow the frontend application to conveniently create and post the different transaction types to the blockchain application via dedicated HTTP API endpoints.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registering-module-plugins"><a class="anchor" href="#registering-module-plugins"></a>6. Registering module &amp; plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that the SRS module and the two plugins have been implemented, it is necessary to inform the blockchain application about them.</p>
</div>
<div class="paragraph">
<p>This is performed by registering them with the blockchain application as shown below.</p>
</div>
<div class="paragraph">
<p>Open the <code>srs/blockchain_app/index.js</code> file again and paste the following code:</p>
</div>
<div class="listingblock">
<div class="title">srs/blockchain_app/index.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">// 1.Import lisk sdk to create the blockchain application
const {
	Application,
	configDevnet,
	genesisBlockDevnet,
	HTTPAPIPlugin,
	utils,
} = require('lisk-sdk');
// 2.Import SRS module &amp; plugins
const { SRSModule } = require('./srs_module');
const { SRSAPIPlugin } = require('./srs_api_plugin/');
const { SRSDataPlugin } = require('./srs_data_plugin/');

// 3.Update the genesis block accounts to include SRS module attributes
genesisBlockDevnet.header.timestamp = 1605699440;
genesisBlockDevnet.header.asset.accounts = genesisBlockDevnet.header.asset.accounts.map(
	(account) =&gt;
		utils.objects.mergeDeep({}, account, {
			srs: {
				config: {
					friends: [],
					recoveryThreshold: 0,
					delayPeriod: 0,
				},
				status: {
					active: false,
					vouchList: [],
					created: 0,
					deposit: BigInt(0),
					rescuer: Buffer.from(''),
				},
			},
		}),
);

// 4.Update application config to include unique label
// and communityIdentifier to mitigate transaction replay
const appConfig = utils.objects.mergeDeep({}, configDevnet, {
	label: 'srs-app',
	genesisConfig: { communityIdentifier: 'SRS' }, //In order to have a unique networkIdentifier
	logger: {
		consoleLogLevel: 'info',
	},
    rpc: {
        enable: true,
        mode: 'ws',
        port: 8888,
    },
});

// 5.Initialize the application with genesis block and application config
const app = Application.defaultApplication(genesisBlockDevnet, appConfig);

// 6.Register custom SRS Module and Plugins
app.registerModule(SRSModule);
app.registerPlugin(HTTPAPIPlugin);
app.registerPlugin(SRSAPIPlugin);
app.registerPlugin(SRSDataPlugin);

// 7.Run the application
app
	.run()
	.then(() =&gt; console.info('SRS Blockchain running....'))
	.catch(console.error);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save and close <code>index.js</code>.</p>
</div>
<div class="paragraph">
<p>Now when the application is started again by running <code>node index.js</code>, the blockchain application will load the newly created SRS module and the plugins, and the new features will become available to the blockchain application.</p>
</div>
<div class="paragraph">
<p>In the next step, we will build a simple React frontend, which allows us to interact with the blockchain application through the browser.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="frontend-application"><a class="anchor" href="#frontend-application"></a>7. Frontend application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The final part of the social recovery system is the frontend application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The development of the frontend application is completely flexible, and you can use any technology stack that you feel comfortable with.</p>
</div>
<div class="paragraph">
<p>In this example, we use React to build the client application.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This tutorial predominantly covers and explains how to build with the Lisk SDK, therefore other parts of the frontend app are not explained in great detail.
More information about how to build a React application can be found in the <a href="https://reactjs.org/docs/getting-started.html" target="_blank" rel="noopener">official React documentation</a>.</p>
</div>
<div class="paragraph">
<p>For convenience, clone the development branch from the <code>lisk-sdk-examples</code> GitHub repository and use the prepared SRS <code>frontend_app</code> from the Lisk SDK examples.</p>
</div>
<div class="listingblock">
<div class="title">srs/</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git clone https://github.com/LiskHQ/lisk-sdk-examples.git
mv lisk-sdk-examples/tutorials/social-recovery/frontend_app frontend_app
rm -r ./lisk-sdk-examples
cd frontend_app
npm i</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point it is now possible to try out the frontend and verify that the SRS blockchain application works as expected:</p>
</div>
<div class="paragraph">
<p>First open a second terminal window, navigate to <code>srs/blockchain_app</code> and start the blockchain application with <code>node index.js</code>, if it is not already running.</p>
</div>
<div class="paragraph">
<p>In the first terminal window, start the frontend application as shown below:</p>
</div>
<div class="listingblock">
<div class="title">srs/frontend_app</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm start</code></pre>
</div>
</div>
<div class="paragraph">
<p>This should open the React app in the browser under <a href="http://localhost:3000/" class="bare">http://localhost:3000/</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To reset the database of the application, remove the <code>./lisk/</code> folder, which can normally be found in the home directory of the user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rm -r ~/.lisk/srs-app</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="frontend-walkabout"><a class="anchor" href="#frontend-walkabout"></a>7.1. Frontend walkabout</h3>
<div class="paragraph">
<p>Before we explore the code of the frontend app, lets first take a tour through the frontend in the browser, to see how it all works together.</p>
</div>
<div class="paragraph">
<p>The following scenario is performed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Five different accounts are created and prepared with an initial amount of tokens in their balance.
The accounts have the following roles:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Original account</p>
</li>
<li>
<p>Rescuer</p>
</li>
<li>
<p>Friend 1</p>
</li>
<li>
<p>Friend 2</p>
</li>
<li>
<p>Friend 3</p>
</li>
</ol>
</div>
</li>
<li>
<p>The original account creates a recovery configuration.</p>
</li>
<li>
<p>We assume the original account loses their credentials.
The owner of the original account uses a new account to rescue the funds in the original account.</p>
</li>
<li>
<p>The rescuer account initiates a recovery process.</p>
</li>
<li>
<p>We assume the owner of the original account informs their friends about the lost credentials and then informs them about the new account address of the rescuer account.</p>
</li>
<li>
<p>The friends which are listed in the recovery configuration of the original account vouch for the rescuer account.</p>
</li>
<li>
<p>The rescuer account waits until the number of friends vouching reaches a minimum threshold and the delay period is over. The rescuer can then claim the recovery.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="prepare-example-accounts"><a class="anchor" href="#prepare-example-accounts"></a>7.1.1. Prepare example accounts</h4>
<div class="paragraph">
<p>In the application example we use the following account credentials:</p>
</div>
<div class="listingblock">
<div class="title">Example account credentials</div>
<div class="content">
<pre>=======================
Original Account
-----------------------
passphrase:
peanut hundred pen hawk invite exclude brain chunk gadget wait wrong ready
address:
lskdxc4ta5j43jp9ro3f8zqbxta9fn6jwzjucw7yt
address (hex string):
d04699e57c4a3846c988f3c15306796f8eae5c1c
=======================
Rescuer
-----------------------
passphrase:
endless focus guilt bronze hold economy bulk parent soon tower cement venue
address:
lsktrqfj84n34tn97vraaq2ztmrgwgwakmqyskqw4
address (hex string):
9cabee3d27426676b852ce6b804cb2fdff7cd0b5
=======================
Friend 1
-----------------------
passphrase:
mushroom edit regular pencil ten casino wine north vague bachelor swim piece
address:
lsk32gnhxjs887bqmgoz6y6ozh6c4c6ztpz7wjfa9
address (hex string):
463e7e879b7bdc6a97ec02a2a603aa1a46a04c80
=======================
Friend 2
-----------------------
passphrase:
thought talk cherry write armed valve salute fabric auction maid join rebuild
address:
lskb6bufqcbrwvgkzuu5wqu6wnruz7awvhxwfkonb
address (hex string):
328d0f546695c5fa02105deb055cf2801d9b8ba1
=======================
Friend 3
-----------------------
passphrase:
exist night more net diesel exact will purse orbit vacuum birth wide
address:
lskomdmvwhb9r3sgj3ryp4fsqnzfn8c8twzkecugt
address (hex string):
6174515fa66c91bff1128913edd4e0f1de37cee0</pre>
</div>
</div>
<div class="paragraph">
<p>To be able to execute all desired tasks with the different accounts, send some tokens to them from the Devnet genesis account.</p>
</div>
<div class="paragraph">
<p>In this example, we use the genesis account as the original account, so it is only necessary to send tokens to the rescuer account and to the accounts belonging to the 3 friends.</p>
</div>
<div class="listingblock">
<div class="title">Send tokens to the example accounts.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Send tokens to the rescuer account
curl -X POST -H "Content-Type: application/json" \
-d '{"amount":"108489300000000","recipientAddress":"9cabee3d27426676b852ce6b804cb2fdff7cd0b5","data":"transfer to a friend","passphrase":"peanut hundred pen hawk invite exclude brain chunk gadget wait wrong ready"}' \
http://localhost:8080/api/token/transfer

# Send tokens to the friend 1 account
curl -X POST -H "Content-Type: application/json" \
-d '{"amount":"10000000000","recipientAddress":"463e7e879b7bdc6a97ec02a2a603aa1a46a04c80","data":"transfer to a friend","passphrase":"peanut hundred pen hawk invite exclude brain chunk gadget wait wrong ready"}' \
http://localhost:8080/api/token/transfer

# Send tokens to the friend 2 account
curl -X POST -H "Content-Type: application/json" \
-d '{"amount":"10000000000","recipientAddress":"328d0f546695c5fa02105deb055cf2801d9b8ba1","data":"transfer to a friend","passphrase":"peanut hundred pen hawk invite exclude brain chunk gadget wait wrong ready"}' \
http://localhost:8080/api/token/transfer

# Send tokens to the friend 3 account
curl -X POST -H "Content-Type: application/json" \
-d '{"amount":"10000000000","recipientAddress":"6174515fa66c91bff1128913edd4e0f1de37cee0","data":"transfer to a friend","passphrase":"peanut hundred pen hawk invite exclude brain chunk gadget wait wrong ready"}' \
http://localhost:8080/api/token/transfer</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-home-page"><a class="anchor" href="#the-home-page"></a>7.1.2. The home page</h4>
<div class="paragraph">
<p>The home page is the landing page that is seen when opening the frontend app under <a href="http://localhost:3000/" class="bare">http://localhost:3000/</a> in the browser.
<span class="image"><img src="../_images/tutorials/srs/01-home.png" alt="01 home"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-recovery-config"><a class="anchor" href="#creating-a-recovery-config"></a>7.1.3. Creating a recovery config</h4>
<div class="paragraph">
<p>Click on <kbd>Setup Recovery</kbd> to create a recovery configuration.
For convenience, the fields in the form are already pre-filled with the correct data, so you can simply press the button <kbd>CREAT RECOVERY CONFIG</kbd>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/tutorials/srs/02-setup2.png" alt="02 setup2"></span></p>
</div>
<div class="paragraph">
<div class="title">Logs of the blockchain app when a valid transaction is posted to the node</div>
<p><span class="image"><img src="../_images/tutorials/srs/03-logs.png" alt="03 logs"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="initiating-an-account-recovery"><a class="anchor" href="#initiating-an-account-recovery"></a>7.1.4. Initiating an account recovery</h4>
<div class="paragraph">
<p>We assume that the original account owner lost their credentials and that they will use a new account to rescue the funds of the old account.
Click on <kbd>Initiate Recovery</kbd> to initiate the recovery process for the original account.
We use the passphrase of the rescuer account to sign the transaction.
The data is pre-filled again with the correct values, so you can simply press the button <kbd>INITIATE RECOVERY</kbd> to initiate the recovery process.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/tutorials/srs/05-initiate2.png" alt="05 initiate2"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="vouching-for-a-friend"><a class="anchor" href="#vouching-for-a-friend"></a>7.1.5. Vouching for a friend</h4>
<div class="paragraph">
<p>We assume the owner of the rescuer account (who is also the owner of the original account), asks their 3 friends who are listed in the recovery configuration to vouch for their new account.</p>
</div>
<div class="paragraph">
<p>The first friend would then click on <kbd>Vouch For Friend</kbd> and has to vouch that the owner of the original account is the same as for the rescuer account.
The data is pre-filled again with the correct values, so you can simply press the button <kbd>VOUCH RECOVERY</kbd> to vouch for the rescuer account.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/tutorials/srs/04-vouch2.png" alt="04 vouch2"></span></p>
</div>
<div class="paragraph">
<p>As we set the recovery threshold to 2 in the recovery config, we need one more friend that vouches for the rescuer, before the recovery can be claimed.
Copy and paste the passphrase of <code>Friend 2</code> (or <code>Friend 3</code>, whichever you prefer), into the passphrase field and vouch again by pressing the button <kbd>VOUCH RECOVERY</kbd>.
<span class="image"><img src="../_images/tutorials/srs/04-vouch3.png" alt="04 vouch3"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="checking-the-recovery-status"><a class="anchor" href="#checking-the-recovery-status"></a>7.1.6. Checking the recovery status</h4>
<div class="paragraph">
<p>After a few seconds, the transaction should be included in the blockchain.
You can check the updated recovery status on the <kbd>Get Account</kbd> page.
The vouch list should display the addresses of the two friend accounts that vouched for the rescuer account.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/tutorials/srs/06-account-details.png" alt="06 account details"></span></p>
</div>
<div id="node-info" class="paragraph">
<p>Check the current block height of the network on the <kbd>Get Node Info</kbd> page.
The delay period is defined as 10 blocks in the recovery config of the account.
This means that after initiating a recovery, the rescuer needs to wait for at least 10 blocks until they can claim the recovery.
The block height at which the recovery was initiated, can be seen in the recovery status of the original account.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/tutorials/srs/07-node-info.png" alt="07 node info"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="claiming-the-recovery"><a class="anchor" href="#claiming-the-recovery"></a>7.1.7. Claiming the recovery</h4>
<div class="paragraph">
<p>The rescuer account can then claim the recovery.
Click on <kbd>Claim Recovery</kbd> to claim the tokens in the original account.
The address of the original account is pre-filled in the <code>Lost Account Address</code> field.
The <code>Passphrase</code> field is pre-filled with the pasphrase of the rescuer account.
Press the button <kbd>CLAIM RECOVERY</kbd> to finish the recovery process.
As a result, all tokens in the balance of the original account will be transferred to the rescuer account.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/tutorials/srs/08-claim2.png" alt="08 claim2"></span></p>
</div>
<div class="paragraph">
<div class="title">Empty balance of the original account</div>
<p><span class="image"><img src="../_images/tutorials/srs/09-account-original.png" alt="09 account original"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The 0.05 tokens remaining in the original account balance are the minimum required account balance.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Tokens of the original account have been transferred to the rescuer account.</div>
<p><span class="image"><img src="../_images/tutorials/srs/09-account-rescuer.png" alt="09 account rescuer"></span></p>
</div>
<div class="paragraph">
<p>Thats it, the frontend walkabout in the browser is now complete.</p>
</div>
<div class="paragraph">
<p>Next lets take a dive into the most important parts of the frontend app, regarding the blockchain related logic.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="api-related-functions"><a class="anchor" href="#api-related-functions"></a>7.2. API related functions</h3>
<div class="paragraph">
<p>Multiple API-related functions are defined that fetch and post data from and to the blockchain application.</p>
</div>
<div class="paragraph">
<p>We will make use of the following APIs that are provided by the blockchain application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><a href="http://localhost:4000/api/" class="bare">http://localhost:4000/api/</a></code> : The HTTP API of the HTTPAPIPlugin.
Used to retrieve general blockchain information from the database.</p>
</li>
<li>
<p><code><a href="http://localhost:8080/api/" class="bare">http://localhost:8080/api/</a></code> : The HTTP API of the SRSAPIPlugin.
Used to post transactions to the blockchain application.</p>
</li>
<li>
<p><code>ws://localhost:8888/ws</code> : The WebSocket API of the blockchain application.
Used to invoke actions in the blockchain application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following functions are defined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fetching blockchain data</p>
<div class="ulist">
<ul>
<li>
<p><code>fetchAccountInfo(address)</code>: Returns all account details for a given account address from the database.</p>
</li>
<li>
<p><code>fetchNodeInfo()</code>: Returns various information about the node of the blockchain application, for example, the current block height.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Posting transactions</p>
<div class="ulist">
<ul>
<li>
<p><code>sendTransactions(tx, action)</code>: Sends a transaction to the blockchain application.
Accepts two arguments:</p>
<div class="ulist">
<ul>
<li>
<p><code>tx</code>(object): the transaction data</p>
</li>
<li>
<p><code>action</code>(string): the endpoint of the SRSAPIplugin, that is used in combination with the transaction data.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Invoking actions</p>
<div class="ulist">
<ul>
<li>
<p><code>fetchRecoveryConfigs()</code>: Returns a list of all accounts with recovery configurations.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div id="api" class="listingblock">
<div class="title">srs/frontent_app/src/api/index.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">import { apiClient } from '@liskhq/lisk-client';

const RPC_ENDPOINT = 'ws://localhost:8888/ws';

let clientCache;

export const getClient = async () =&gt; {
  if (!clientCache) {
    clientCache = await apiClient.createWSClient(RPC_ENDPOINT);
  }
  return clientCache;
};

export const fetchRecoveryConfigs = async () =&gt; {
  const client = await getClient();
  return client.invoke('SRSData:getAllRecoveryConfigs');
};

export const sendTransactions = async (tx, action) =&gt; {
    return fetch(`http://localhost:8080/api/recovery/${action}`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(tx),
    })
      .then((res) =&gt; res.json())
      .then((res) =&gt; res);
  };

export const fetchAccountInfo = async (address) =&gt; {
    return fetch(`http://localhost:4000/api/accounts/${address}`)
      .then((res) =&gt; res.json())
      .catch((res) =&gt; res.data);
};

export const fetchNodeInfo = async () =&gt; {
  return fetch("http://localhost:4000/api/node/info")
    .then((res) =&gt; res.json())
    .catch((res) =&gt; res.data);
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="components"><a class="anchor" href="#components"></a>7.3. Components</h3>
<div class="paragraph">
<p>For the frontend the following components are defined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/frontend_app/src/components/home.js" target="_blank" rel="noopener">Home()</a>: Renders the general landing page of the frontend application.</p>
</li>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/frontend_app/src/components/createRecovery.js" target="_blank" rel="noopener">CreateRecovery()</a>: Renders the page for <a href="#creating-a-recovery-config">Creating a recovery config</a>.</p>
</li>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/frontend_app/src/components/initiateRecovery.js" target="_blank" rel="noopener">InitiateRecovery()</a>: Renders the page for <a href="#initiating-an-account-recovery">Initiating an account recovery</a>.</p>
</li>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/frontend_app/src/components/vouchRecovery.js" target="_blank" rel="noopener">VouchRecovery()</a>: Renders the page for <a href="#vouching-for-a-friend">Vouching for a friend</a>.</p>
</li>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/frontend_app/src/components/claimRecovery.js" target="_blank" rel="noopener">ClaimRecovery()</a>: Renders the page for <a href="#claiming-the-recovery">Claiming the recovery</a>.</p>
</li>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/frontend_app/src/components/closeRecovery.js" target="_blank" rel="noopener">CloseRecovery()</a>: Renders the page for closing a recovery.</p>
</li>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/frontend_app/src/components/removeRecovery.js" target="_blank" rel="noopener">RemoveRecovery()</a>: Renders the page for removing a previously created recovery configuration.</p>
</li>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/frontend_app/src/components/getAccount.js" target="_blank" rel="noopener">GetAccount()</a>: Renders the page for the <a href="#checking-the-recovery-status">account details</a>.</p>
</li>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/frontend_app/src/components/getNodeInfo.js" target="_blank" rel="noopener">GetNodeInfo()</a>: Displays the current <a href="#node-info">node information</a>.</p>
</li>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/frontend_app/src/components/getRecoveryAccounts.js" target="_blank" rel="noopener">GetRecoveryConfigs()</a>: Displays a list of all accounts with recovery configurations.</p>
</li>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/frontend_app/src/components/sideMenu.js" target="_blank" rel="noopener">SideMenu()</a>: Renders the side navigation which allows the user to switch between the different pages of the frontend application.</p>
</li>
<li>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/tutorials/social-recovery/frontend_app/src/components/recoveryManager.js" target="_blank" rel="noopener">RecoveryManager()</a>: Manages the routing of the different components of the frontend application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code examples for the <code>CreateRecovery</code> and <code>GetRecoveryConfigs</code> are explained in detail below.
If you are curious how the other components of the frontend app are implemented, please directly view the example code.
Most logic of the other components is implemented analog to the presented examples below:</p>
</div>
<div class="sect3">
<h4 id="createrecovery-component"><a class="anchor" href="#createrecovery-component"></a>7.3.1. CreateRecovery component</h4>
<div class="paragraph">
<p>The <code>CreateRecovery</code> component shall allow the user to create a recovery configuration for their account.</p>
</div>
<div class="paragraph">
<p>To achieve this, the following information is required:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>a list of trusted friends</p>
</li>
<li>
<p>the desired delay period</p>
</li>
<li>
<p>the desired recovery threshold</p>
</li>
<li>
<p>the passphrase of the account, to sign the transaction</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>CreateRecovery</code> renders a form to receive this information from the user.
When the user presses the button <kbd>CREATE RECOVERY CONFIG</kbd>, it sends the relevant data to the blockchain application.</p>
</div>
<div class="listingblock">
<div class="title">srs/frontent_app/src/components/createRecovery.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-jsx hljs" data-lang="jsx">import React, { Fragment, useContext, useState } from 'react';
import Avatar from '@material-ui/core/Avatar';
import Button from '@material-ui/core/Button';
import CssBaseline from '@material-ui/core/CssBaseline';
import TextField from '@material-ui/core/TextField';
import Link from '@material-ui/core/Link';
import Grid from '@material-ui/core/Grid';
import Box from '@material-ui/core/Box';
import Typography from '@material-ui/core/Typography';
import { makeStyles } from '@material-ui/core/styles';
import Container from '@material-ui/core/Container';
import { grey, green } from '@material-ui/core/colors';
import EnhancedEncryptionIcon from '@material-ui/icons/EnhancedEncryption';
import { sendTransactions } from '../api';
import { createRecoveryDefaults } from "../utils/defaults";
import Snackbar from '@material-ui/core/Snackbar';
import MuiAlert from '@material-ui/lab/Alert';
import { cryptography } from '@liskhq/lisk-client';

function Alert(props) {
  return &lt;MuiAlert elevation={6} variant="filled" {...props} /&gt;;
}

function Footer() {
  return (
    &lt;Typography variant="body2" color="textSecondary" align="center"&gt;
      &lt;Link style={{ color: grey[500] }} href="/"&gt;
        About Social Recovery System
      &lt;/Link&gt;
    &lt;/Typography&gt;
  );
}

const useStyles = makeStyles((theme) =&gt; ({
  paper: {
    marginTop: theme.spacing(8),
    display: 'flex',
    flexDirection: 'column',
    alignItems: 'center',
  },
  avatar: {
    margin: theme.spacing(1),
    backgroundColor: 'rgb(37 35 35 / 87%)',
  },
  form: {
    width: '100%',
    marginTop: theme.spacing(3),
  },
  submit: {
    margin: theme.spacing(3, 0, 2),
  },
}));

export default function CreateRecovery() {
  const classes = useStyles();
  const [open, setOpen ] = useState(false);

  const [data, setData] = useState({
    friends: createRecoveryDefaults.friends,
    delayPeriod: createRecoveryDefaults.delayPeriod,
    recoveryThreshold: createRecoveryDefaults.recoveryThreshold,
    passphrase: createRecoveryDefaults.passphrase,
    msg: '',
    severity: 'success',
  });

  const handleClose = (event, reason) =&gt; {
    if (reason === 'clickaway') {
      return;
    }

    setOpen(false);
  };

  const handleChange = (event) =&gt; {
    event.persist();
    setData({ ...data, [event.target.name]: event.target.value });
  };

  const handleSend = async (event) =&gt; {
    event.preventDefault();
    const { friends } = data;

    const friendList = friends ? friends.split(',').map(str =&gt; str.replace(/\s/g, '')): [];
    const binaryFriends = friendList.map(friend =&gt; cryptography.getAddressFromBase32Address(friend).toString('hex'));
    try {
        const result = await sendTransactions({ delayPeriod: data.delayPeriod, recoveryThreshold: data.recoveryThreshold, friends: binaryFriends, passphrase: data.passphrase }, window.location.pathname.slice(1));
        if (result.errors) {
            setData({ msg: result.errors[0].message, severity: 'error' });
        } else {
            setData({ msg: `Transaction ID ${result.data.transactionId} is added`, severity: 'success' });
        }
        setOpen(true);

    } catch (error) {}
  };

  return (
    &lt;Container component="main" maxWidth="xs"&gt;
      &lt;CssBaseline /&gt;
      &lt;div className={classes.paper}&gt;
        &lt;Avatar className={classes.avatar}&gt;
        &lt;EnhancedEncryptionIcon style={{ color: green[500] }}/&gt;
        &lt;/Avatar&gt;
        &lt;Typography component="h1" variant="h5"&gt;
          Setup Social Recovery
        &lt;/Typography&gt;
        &lt;Typography component="h4" style={{color: 'grey'}}&gt;
          Create recovery configuration for your account
        &lt;/Typography&gt;
        &lt;form className={classes.form} noValidate autoComplete="off"&gt;
          &lt;Grid container spacing={2}&gt;
            &lt;Grid item xs={12}&gt;
              &lt;TextField
                variant="outlined"
                required
                fullWidth
                id="friends"
                label="Comme separated addresses of friends"
                name="friends"
                multiline
                rows={5}
                onChange={handleChange}
                defaultValue={createRecoveryDefaults.friends}
              /&gt;
            &lt;/Grid&gt;
            &lt;Grid item xs={12}&gt;
              &lt;TextField
                variant="outlined"
                required
                fullWidth
                name="delayPeriod"
                label="Delay Period"
                id="delayPeriod"
                onChange={handleChange}
                defaultValue={createRecoveryDefaults.delayPeriod}
              /&gt;
            &lt;/Grid&gt;
            &lt;Grid item xs={12}&gt;
              &lt;TextField
                variant="outlined"
                required
                fullWidth
                name="recoveryThreshold"
                label="Recovery Threshold"
                id="threshold"
                onChange={handleChange}
                defaultValue={createRecoveryDefaults.recoveryThreshold}
              /&gt;
            &lt;/Grid&gt;
            &lt;Grid item xs={12}&gt;
              &lt;TextField
                variant="outlined"
                required
                fullWidth
                name="passphrase"
                label="Passphrase"
                id="passphrase"
                type="password"
                onChange={handleChange}
                defaultValue={createRecoveryDefaults.passphrase}
              /&gt;
            &lt;/Grid&gt;
          &lt;Button
            onClick={handleSend}
            fullWidth
            variant="contained"
            color="primary"
          &gt;
            Create Recovery Config
          &lt;/Button&gt;
          &lt;/Grid&gt;
        &lt;/form&gt;
        &lt;Snackbar open={open} autoHideDuration={10000} onClose={handleClose}&gt;
            &lt;Alert onClose={handleClose} severity={data.severity}&gt;
                &lt;label id='msg'&gt;{data.msg}&lt;/label&gt;
            &lt;/Alert&gt;
        &lt;/Snackbar&gt;
      &lt;/div&gt;
      &lt;Box mt={5}&gt;
        &lt;Footer /&gt;
      &lt;/Box&gt;
    &lt;/Container&gt;
  );
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="getrecoveryconfigs-component"><a class="anchor" href="#getrecoveryconfigs-component"></a>7.3.2. GetRecoveryConfigs component</h4>
<div class="paragraph">
<p>The <code>GetRecoveryConfigs</code> component shall display a complete list of all accounts that created a recovery configuration.</p>
</div>
<div class="paragraph">
<p>To achieve this, the function <code>fetchRecoveryConfigs()</code> from the <a href="#api-related-functions">API related functions</a> is used to fetch all accounts with a recovery configuration from the blockchain application.</p>
</div>
<div class="listingblock">
<div class="title">srs/frontent_app/src/components/getRecoveryAccounts.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-jsx hljs" data-lang="jsx">import React, {
  useEffect,
  useState
} from 'react';
import {
  Grid,
  CssBaseline,
  Container,
} from '@material-ui/core';
import {
  makeStyles
} from '@material-ui/core/styles';
import { fetchRecoveryConfigs } from '../api';
import RecoveryConfig from "./recoveryConfig";

const useStyles = makeStyles((theme) =&gt; ({
  root: {
    flexGrow: 1,
  },
  paper: {
    padding: theme.spacing(2),
    textAlign: 'center',
    color: theme.palette.text.primary,
  },
}));

export default function GetRecoveryConfigs () {
  const classes = useStyles();
  const [data, setData] = useState({
    result: []
  });

  useEffect(() =&gt; {
    async function getRecoveryConfigs() {
      const result = await fetchRecoveryConfigs();
      if ( result.length &gt; 0 ) {
        setData({ result });
      }
    }
    getRecoveryConfigs()
  }, [])

  return (
    &lt;Container component="main" className={classes.paper}&gt;
      &lt;CssBaseline /&gt;
      &lt;div className={classes.root}&gt;
        { data.result.length &gt; 0
          ?
        &lt;Grid container spacing={3}&gt;
          {  data.result.map((config) =&gt; (
            &lt;Grid item xs={12}&gt;
              &lt;RecoveryConfig item={config} key={config.address} /&gt;
            &lt;/Grid&gt;
          )) }
        &lt;/Grid&gt;
          : &lt;p&gt;No recoverable accounts found&lt;/p&gt; }
      &lt;/div&gt;
    &lt;/Container&gt;
  );
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary"><a class="anchor" href="#summary"></a>8. Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>That&#8217;s it!
You should now have a complete blockchain application running which allows users to recover their accounts in the case whereby they have lost their credentials.</p>
</div>
<div class="paragraph">
<p>It consists of the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a blockchain application with:</p>
<div class="ulist">
<ul>
<li>
<p>a custom module for a social account recovery system.</p>
</li>
<li>
<p>a custom plugin which provides a list of all accounts with created recovery configuration.</p>
</li>
<li>
<p>a custom plugin which provides additional HTTP API endpoints to conveniently create and post different transaction types.</p>
</li>
</ul>
</div>
</li>
<li>
<p>a frontend application which allows you to use and test the applications in the browser.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="optional-exercises"><a class="anchor" href="#optional-exercises"></a>9. Optional exercises</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Feel free to play around with the code example by changing/adjusting certain options, or by extending the application in your own way.</p>
</div>
<div class="paragraph">
<p>The following exercises might be interesting to get more familiar with the Lisk SDK.</p>
</div>
<div class="sect2">
<h3 id="implement-http-api-endpoint-as-plugin-actions"><a class="anchor" href="#implement-http-api-endpoint-as-plugin-actions"></a>9.1. Implement HTTP API endpoint as plugin actions</h3>
<div class="paragraph">
<p>The <code>SRSAPIplugin</code> provides a lot of useful functions for creating and posting the different transaction objects to the blockchain application.
These functions could alternatively be created as actions inside of the plugin.
The frontend can then invoke the different actions analog to the function <code>fetchRecoveryConfigs()</code> which we defined in the <a href="#api-related-functions">API related functions</a>.
<code>fetchRecoveryConfigs()</code> invokes the action <code>SRSData:getAllRecoveryConfigs</code> to receive a list of all account with recovery configurations.</p>
</div>
<div class="paragraph">
<p>Try to re-implement the different HTTP API endpoints as actions in <a href="#the-srs-api-plugin">The SRS API plugin</a>, and invoke those actions in the frontend to create and send the different transaction types.</p>
</div>
</div>
<div class="sect2">
<h3 id="notify-an-account-owner-if-an-account-recovery-for-their-account-has-been-initialized"><a class="anchor" href="#notify-an-account-owner-if-an-account-recovery-for-their-account-has-been-initialized"></a>9.2. Notify an account owner, if an account recovery for their account has been initialized</h3>
<div class="paragraph">
<p>In the section <a href="#lifecycle-hooks">Lifecycle hooks</a>, we defined that the event <code>srs:recoveryInitiated</code> is published for every incoming "initiate recovery" transaction.</p>
</div>
<div class="paragraph">
<p>Try to use this event to warn an account owner that a recovery has been initiated for their account.
The original account holder will be warned in case someone malicious starts a recovery on their account to steal their funds, and if it was a malicious actor who initiated the recovery, then the user can quickly close the recovery process before the delay period is passed and the set threshold number of friends that had already vouched for it.</p>
</div>
</div>
</div>
</div>
  <nav class="pagination">
  <span class="prev"><a href="nft.html">Non-fungible token (NFT) Tutorial</a></span>
  <span class="next"><a href="lns/index.html">Lisk Name Service (LNS) Tutorial</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="footerdiv">
    <p> 2023 Lisk Foundation</p>
    <!-- <div class="community-section">
      <p class="community-section__text">Follow Lisk on: </p>
      <div class="community-section__icons"> -->
    <div class="community_icons">
      <a href="https://lisk.chat" title="Discord" target="_blank" class="footer_icon icon-discord"><p>Discord</p></a>
      <a href="https://dev.lisk.com" title="Discourse" target="_blank" class="footer_icon icon-discourse"><p>Discourse</p></a>
      <a href="https://github.com/LiskHQ" title="GitHub" target="_blank" class="footer_icon icon-github"><p>GitHub</p></a>
      <!--    </div> -->
    </div>
  </div>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/glossary.js"></script>
<script async src="../../_/js/vendor/tabs-block-behaviour.js"></script>
<script async src="../../_/js/vendor/swagger-ui.js"></script>
<script async src="../../_/js/vendor/component-versions.js"></script>
<script src="../../_/js/vendor/custom.js"></script>

  </body>
</html>
