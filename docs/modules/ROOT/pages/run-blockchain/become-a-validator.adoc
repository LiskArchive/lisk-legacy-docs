= How to become a validator
Mona Bärenfänger <mona@lightcurve.io>
:toc: preamble
:idprefix:
:idseparator: -
:sectnums:
:sectnumlevels: 2
:docs_sdk: v6@lisk-sdk::
//Footnotes
:fn_lip44: footnote:lip44[For more details about the validator registration process and the related cryptography, check out https://github.com/LiskHQ/lips/blob/main/proposals/lip-0044.md[LIP 0044 - Introduce Validators module^].]
// URLs
:url_lisk_wallet: https://lisk.com/wallet
// Project URLs
:url_sdk_elements: {docs_sdk}references/lisk-elements/index.adoc
:url_guides_config: build-blockchain/configuration.adoc
:url_guides_setup_bootstrap: build-blockchain/create-sidechain-app.adoc#bootstrapping-a-new-blockchain-application-with-lisk-commander
:url_references_cli_forgingconfig: {docs_sdk}application-cli.adoc#forgingconfig
:url_references_cli_forgingenable: {docs_sdk}application-cli.adoc#forgingenable
:url_sdk_cli_keyscreate: {docs_sdk}application-cli.adoc#keyscreate
:url_sdk_cli_generatorenable: {docs_sdk}application-cli.adoc#generatorenable
:url_references_cli_txcreate: {docs_sdk}application-cli.adoc#transactioncreate
:url_sdk_cli_txsend: {docs_sdk}application-cli.adoc#transactionsend

====
On this page, you'll learn how to become a validator for a PoS or PoA blockchain network, like the Lisk Mainnet.

This includes how to:

* [x] Register as a validator
* [x] Enable block generation for the first time
====

== How to register as a validator

To generate new blocks on a node, it is required to register as a validator.
This is achieved by choosing a unique *validator name*, and posting a corresponding "Register Validator" transaction to the network.

There are many possibilities to create the transaction, for example: {url_lisk_wallet}[Lisk Desktop^], xref:{url_sdk_elements}[Lisk Elements], the node CLI or the Dashboard plugin.
// TODO: Add link to dashboard plugin how-to guide, once it is updated for v6
// There are many possibilities to create the transaction, for example: {url_lisk_wallet}[Lisk Desktop^], xref:{url_elements}[Lisk Elements], or the xref:{url_framework_dashbobardplugin}[].

In the following examples, the node CLI is used to perform the required actions.

=== Get the validator keys

It is possible to generate all relevant validator keys to enable block generation from the account passphrase.

To do so, use the command xref:{url_sdk_cli_keyscreate}[keys create].

The command will ask for the validator *passphrase*, and it will also ask for a *password*, in order to symmetrically encrypt the passphrase for the config.

[tabs]
=====
Lisk Core::
+
--
//TODO: Update Lisk Core
--
Sidechain node::
+
--
[source,bash]
----
./bin/run keys create --output config/keys.json
----

. The passphrase of the validator account.
. Define a new password to encrypt the passphrase of the delegate account.
Store the password somewhere safe.

----
? Please enter passphrase:  [hidden]
? Please re-enter passphrase:  [hidden]
? Please enter password:  [hidden]
? Please re-enter password:  [hidden]
----
--
=====

//TODO: Verify that why the password is needed is still valid
IMPORTANT: Store the password you used for the encryption somewhere safe.
It will be required everytime to enable block generation, in order to decrypt the generator key in the config.

This will generate the following file, which includes all important keys for the validator account:


.config/keys.json
[source,json]
----
{
  "keys": [
    {
      "address": "lskqaxxmj78frvgpjgwvf4yqjjkcrr9yhn2sxxwm3",
      "keyPath": "m/44'/134'/0'",
      "publicKey": "6290c8b58de8b71fedb7e3cb9a6ee9426aa3e7ac0141f278526375d46705b546",
      "privateKey": "759305903f7bbb449cf2fd22e6da476792b63e24558e266a4859f9ed3c91fd7e6290c8b58de8b71fedb7e3cb9a6ee9426aa3e7ac0141f278526375d46705b546",
      "plain": {
        "generatorKeyPath": "m/25519'/134'/0'/0'",
        "generatorKey": "aaecd278a3fadc40a4a824d6f4aa24547d8fb9d075ec4d6967a7084f9a3f2541",
        "generatorPrivateKey": "81316f0582fd2cc0a651318aa0041ce36e7b786033b98ec545ec04078fad67caaaecd278a3fadc40a4a824d6f4aa24547d8fb9d075ec4d6967a7084f9a3f2541",
        "blsKeyPath": "m/12381/134/0/0",
        "blsKey": "815a9e7643cf2bace98d1337f1dca8e39949592cd3fcb79bf3ab5784981468b9987b3340527bc9ca263a2fd061812024",
        "blsProofOfPosession": "add8669bb57f3dceec04dc0f875906cb52a677f1df911536c01f447c8830bf27cd43713af18d84de5a64ec504aeaf9a30521c09438bb5a4d5fd634946c65e0fc4ea3681fdb4f6949cb6c1bc1ac1ddec3df058a13466af5a13d50737938fd7d5f",
        "blsPrivateKey": "36506a53431665265ee03d7e19a5d44db3ff159d9aeee05727a8b24abc67651a"
      },
      "encrypted": {
        "ciphertext": "c3009d4a505ac32a652ffce6aa718073c7ca75b00578420ba20c2533a83f38e2b3e20cf1d6f0c9905efe28b5276142b93fdbdd33134d37bcd2db23654da92bb2becd00971c49ecc749100748c93344477ea52f6073c3fefec7234962d0eccdaa6862d9d0da46dbfe85cef98ad6cab0f2c1cb1b54326617132bb950d1c14a774a1e6403e8fa1bf3a2c7c0d6856266cf738f41ac01b2217d93070c4079e1b82044d3a692ea225290c2b6bcb902e0ffb8132f4c0f29325e6a3a",
        "mac": "2b3c65d0385a870ab499dfcddf411347506671015f412b35600153b132a455ea",
        "kdf": "argon2id",
        "kdfparams": {
          "parallelism": 4,
          "iterations": 1,
          "memorySize": 2024,
          "salt": "a5598628001346f608b3f57dd38b8611"
        },
        "cipher": "aes-256-gcm",
        "cipherparams": {
          "iv": "683600a199d154e51c0f97e6",
          "tag": "32807058f7f89921b4839fc39256cd24"
        },
        "version": "1"
      }
    }
  ]
}
----

=== Start the blockchain application

To conveniently create and send a transaction, first start the node, so it can handle the incoming CLI commands accordingly.

[tabs]
=====
Lisk Core::
+
--
[source,bash]
----
lisk-core start
----
--
Sidechain node::
+
--
[source,bash]
----
./bin/run start
----
--
=====

=== Create the Register Validator transaction

Create a transaction to register a normal account as a validator.

The following parameters are required:

. `name`: The unique name for the new validator.
. `generatorKey`:  The public key whose corresponding private key is used to sign blocks generated by the validator.
To increase security, this key is different to the key used to sign transactions in the network{fn_lip44}.
. `blsKey`: The public BLS key whose corresponding private key is used to sign certificates.
. `proofOfPossession`: The cryptographic proof that the validator owns the corresponding private key to the BLS key.

The parameters 2, 3, 4 are all generated in step <<get-the-validator-keys>>.

[tabs]
=====
Lisk Core::
+
--
//TODO: Update Lisk Core
--
Sidechain node::
+
--
Use the xref:{url_references_cli_txcreate}[transaction create] command to create the `registerValidator` transaction:

[source,bash]
----
./bin/run transaction create pos registerValidator 1100000000 \
--params='{"name":"myuniqueame","generatorKey":"aaecd278a3fadc40a4a824d6f4aa24547d8fb9d075ec4d6967a7084f9a3f2541","blsKey":"815a9e7643cf2bace98d1337f1dca8e39949592cd3fcb79bf3ab5784981468b9987b3340527bc9ca263a2fd061812024","proofOfPossession":"add8669bb57f3dceec04dc0f875906cb52a677f1df911536c01f447c8830bf27cd43713af18d84de5a64ec504aeaf9a30521c09438bb5a4d5fd634946c65e0fc4ea3681fdb4f6949cb6c1bc1ac1ddec3df058a13466af5a13d50737938fd7d5f"}'
----
--
=====

Next, enter the passphrase of your account.

----
? Please enter passphrase:  [hidden]
? Please re-enter passphrase:  [hidden]
----

The CLI will return the transaction already in binary format, ready to be posted to a node.

[source,json]
----
{"transaction":"0a0464706f731210726567697374657244656c656761746518002080d6c28c042a206290c8b58de8b71fedb7e3cb9a6ee9426aa3e7ac0141f278526375d46705b54632be010a066d796e616d651220aaecd278a3fadc40a4a824d6f4aa24547d8fb9d075ec4d6967a7084f9a3f25411a30815a9e7643cf2bace98d1337f1dca8e39949592cd3fcb79bf3ab5784981468b9987b3340527bc9ca263a2fd0618120242260add8669bb57f3dceec04dc0f875906cb52a677f1df911536c01f447c8830bf27cd43713af18d84de5a64ec504aeaf9a30521c09438bb5a4d5fd634946c65e0fc4ea3681fdb4f6949cb6c1bc1ac1ddec3df058a13466af5a13d50737938fd7d5f3a40d841c3ea463e2c2fd598bd56c77998241bc86e8143e59baf5f06b11491f3c8557e2d82c1139f927adcb0055256f5a5419a4853950856c2e9ae3588a7885a3f05"}
----

TIP: To return the transaction in JSON format as well, simply add the flag `--pretty` to the command.

=== Send the transaction

[tabs]
=====
Lisk Core::
+
--
[source,bash]
----
lisk-core transaction:send 0805100018032080d6c28c042a20bad983c72bed43fd274f852658c298b74c71ab6fc50508879fef309e3836384b32080a066d796e616d653a4045afdd04d0c0bc6e548c0915d5fabef1311b1b75b1eb919a43b88dab539e7b6a99b9075f5d6382ec3bbebfca3301651a15d8af3f999d5b6fa7873b3969cd3d0c
----
--
Sidechain node::
+
--
Use the xref:{url_sdk_cli_txsend}[transaction send] command to send the transaction to your node.

[source,bash]
----
./bin/run transaction send 0a0464706f731210726567697374657244656c656761746518002080d6c28c042a206290c8b58de8b71fedb7e3cb9a6ee9426aa3e7ac0141f278526375d46705b54632be010a066d796e616d651220aaecd278a3fadc40a4a824d6f4aa24547d8fb9d075ec4d6967a7084f9a3f25411a30815a9e7643cf2bace98d1337f1dca8e39949592cd3fcb79bf3ab5784981468b9987b3340527bc9ca263a2fd0618120242260add8669bb57f3dceec04dc0f875906cb52a677f1df911536c01f447c8830bf27cd43713af18d84de5a64ec504aeaf9a30521c09438bb5a4d5fd634946c65e0fc4ea3681fdb4f6949cb6c1bc1ac1ddec3df058a13466af5a13d50737938fd7d5f3a40d841c3ea463e2c2fd598bd56c77998241bc86e8143e59baf5f06b11491f3c8557e2d82c1139f927adcb0055256f5a5419a4853950856c2e9ae3588a7885a3f05
----
--
=====

If the sending process was successful, it will return the following message, including the respective transaction ID.

----
Transaction with id: '1809da284fe26dba90d34dc3aab837a32d3c291a4ca78a9bfa263f927c69598a' received by node.
----

=== Check account details

Invoke the `pos_getValidator` endpoint, to verify the account has now registered a validator name:

[tabs]
=====
Lisk Core::
+
--
//TODO: Update Lisk Core
--
Sidechain node::
+
--
[source,bash]
----
./bin/run endpoint:invoke pos_getValidator '{ "address":"lskqaxxmj78frvgpjgwvf4yqjjkcrr9yhn2sxxwm3"}' --pretty
----
--
=====

The new validator name should be displayed in the response, along with the corresponding address and other public information about this particular validator.

[source,json]
----
{
  "name": "myuniquename",
  "totalStakeReceived": "0",
  "selfStake": "0",
  "lastGeneratedHeight": 14,
  "isBanned": false,
  "pomHeights": [],
  "consecutiveMissedBlocks": 0,
  "commission": 10000,
  "lastCommissionIncreaseHeight": 14,
  "sharingCoefficients": [],
  "address": "lskqaxxmj78frvgpjgwvf4yqjjkcrr9yhn2sxxwm3",
  "punishmentPeriods": []
}
----

== Stake to increase the validator weight



== Import the validator keys

Import the validator keys which were generated in step <<get-the-validator-keys>> into the node.

[tabs]
=====
Lisk Core::
+
--
//TODO: Update Lisk Core
--
Sidechain node::
+
--
[source,bash]
----
./bin/run keys import --file-path config/keys.json
----
--
=====

=== Checking the validator status

After the <<import-the-validator-keys, keys are imported>> to the node, you can check the validator status on the node, to verify that the import worked as expected.

Execute the following command:

[tabs]
=====
Lisk Core::
+
--
//TODO: Update Lisk Core
--
Sidechain node::
+
--
[source,bash]
----
./bin/run generator status --pretty
----
--
=====

The command returns a list of validators who imported their key like described in step <<import-the-validator-keys>> to the particular node.
Generally, assuming the validator runs a private node (like recommended), the only validator info that will be returned, is the validator account of the node operator.

The following information is displayed for a validator:

* `address`: The Lisk32 address of the validator.
* `enabled`: `true`, if the validator has block generation enabled, `false` if not.
* The <<validator-data>>.

//TODO: Update example in SDK docs: CLI, it should only return one validator, not all 103
//TODO: Update on SDK docs CLI page: remove outdated account topic
.Example output
[source,json]
----
{
  "info": {
    "status":
    [{
        "address": "lskqaxxmj78frvgpjgwvf4yqjjkcrr9yhn2sxxwm3",
        "height": 0,
        "maxHeightPrevoted": 0,
        "maxHeightGenerated": 0,
        "enabled": false
      }
  ]}
}
----

The block generation for a validator is disabled right after the keys have been imported.
How to <<how-to-enable-block-generation-for-the-first-time>> is explained in the following step.

== Validator data

The validator data is required for enabling block generation for the corresponding delegate.

It contains the following three properties:

* `height`: Last forged block height.
* `maxHeightGenerated`: Validators largest previously generated height.
* `maxHeightPrevoted`: Validators largest prevoted height for a block.

== How to enable block generation for the first time

.Check this before enabling block generation on a node.
[CAUTION]
====
. Ensure the node is running.
. Ensure the node is **fully synchronized** with the network.
. To avoid breaking the BFT rules and being punished by the network, adhere to the following points:
.. Never use outdated <<validator-data>> to enable block generation.
.. Never activate block generation for the same validator on two or more nodes at the same time.
====

IMPORTANT: The blockchain application needs to be running to successfully enable block generation on the node.

[tabs]
=====
Lisk Core::
+
--
//TODO: Update Lisk Core
--
Sidechain node::
+
--
Use the xref:{url_sdk_cli_generatorenable}[generator enable] command to enable block generation on your node.

.Enable block generation
[source,bash]
----
./bin/run generator enable lskqaxxmj78frvgpjgwvf4yqjjkcrr9yhn2sxxwm3 --height=0 --max-height-generated=0 --max-height-prevoted=0
----
--
=====

Replace `lskqaxxmj78frvgpjgwvf4yqjjkcrr9yhn2sxxwm3` with your validator address.

Verify the correctness of the values `height`, `maxHeightPrevoted`, and `maxHeightPreviouslyForged` by answering `yes`, and use your password created in step <<get-the-validator-keys>> to decrypt the passphrase for block generation.

You can use your data automatically by setting the flag `--use-status-values`.

//TODO: Update example snippet
[source,bash]
----
 Current block generation status for validator account lskqaxxmj78frvgpjgwvf4yqjjkcrr9yhn2sxxwm3 is:
{"height":14814092,"maxHeightPrevoted":14814017,"maxHeightPreviouslyForged":14814025}
? Do you want to use the above values to enable block generation? yes
? Enter password to decrypt the encrypted passphrase:  **********
Updated block generation status:
{"address":"lskqaxxmj78frvgpjgwvf4yqjjkcrr9yhn2sxxwm3","enabled":true}
----





