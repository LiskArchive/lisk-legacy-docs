= Send and retrieve hello
Muhammad Talha <muhammad.talha@lightcurve.io>
:toc: preamble
:toclevels: 5
:sectnums:
:page-toclevels: 4
:idprefix:
:idseparator: -
:imagesdir: ../../assets/images
:sdk_docs: lisk-sdk::

// External URLs
// :url_start_frontend: https://github.com/LiskHQ/lisk-sdk-examples/blob/1582-UI-boiler-plate/guides/07-ui-boilerplate/hello_frontend/README.md#start-hello_frontend
:url_sendHello: https://github.com/LiskHQ/lisk-sdk-examples/blob/1582-user-interface/tutorials/hello/hello_frontend/src/components/sendHello.js
:url_getHello: https://github.com/LiskHQ/lisk-sdk-examples/blob/1582-user-interface/tutorials/hello/hello_frontend/src/components/getHello.js
:url_checkBalance: integrate-blockchain/integrate-UI/create-get-account.adoc#check-balance


// Project URLs
:url_helloClient_overview: build-blockchain/index.adoc#the-hello-world-client
:url_guides_setup: build-blockchain/create-sidechain-app.adoc
:url_guides_module: build-blockchain/module/index.adoc
:url_guides_plugin: build-blockchain/plugin/index.adoc
:url_start_client: build-blockchain/module/command.adoc#start-client
:url_module_config: build-blockchain/module/configuration.adoc#define-a-module-configuration-file

In the xref:{url_helloClient_overview}[Hello Client's] implementation, we created `HelloModule` to send hello messages on the sidechain. 
Later, we created the `HelloInfoPlugin` to store those hello messages to a database.
The plugin also allowed us to see all the hello messages sent on the sidechain.

====
So, on this page, you'll learn:

* [x] How to send a hello message through UI.
* [x] How to display all the hello messages sent on the sidechain.
====

TIP: The relevant files discussed in this guide are {url_sendHello}[sendHello.js] and {url_getHello}[getHello.js]

== Sending hello
The send hello page will take the hello message from the user and send it to the sidechain.
The sidechain will verify the validity of the request as per the xref:{url_module_config}[module's configuration] and various other parameters.

If the request is valid, the hello message will be sent on the sidechain. To do the aforementioned process, let's update the `sendHello.js` file in the *hello_frontend/src/components/* directory.

First up, define the necessary variables and `handleChange` event.

.hello_frontend/src/components/sendHello.js
[source,javascript]
----
// [...]
// UI libraries import
import React, { useState } from "react";
// lisk libraries import
import React, { useState } from "react";
import { cryptography, transactions } from '@liskhq/lisk-client/browser';
import * as api from '../api';

function SendHello() {
    const [state, updateState] = useState({
        hello: '',
        fee: '',
        error: '',
        passphrase: '',
        keyPath: '0',
        transaction: {},
        response: {}
    });

    const handleChange = (event) => {
        const { name, value } = event.target;
        updateState({
            ...state,
            [name]: value,
        });
    };
    // [...]

}
export default SendHello;
----

Similar to previous guides, we want the form submission to be handled by the `handleSubmit` function.
It will take in the information entered by the user on the UI like, passphrase, hello message, fee etc. and will create a transaction using apiClient.


We want an action to be taken when a user enter's an address into the input and clicks on the Submit button.
This will be handled in the `handleSubmit` function, where we are first creating a token transfer transaction, and then posting it to the node.

.hello_frontend/src/components/sendHello.js
[source,javascript]
----
// [...]

function SendHello() {

    // [...]

       const handleSubmit = async (event) => {
        event.preventDefault();

        // 1. Get apiClient via api.js
        const client = await api.getClient();

        // 2. This is the passphrase of the sender of hello message, based on the passphrase and the keyDerivation path, the identity of the sender will be computed.
        const passphrase = state.passphrase;
        // 3. A private key will be used to sign a transaction. A private key is generated using the keyDerivationPath and the passphrase.
        const privateKey = await cryptography.ed.getPrivateKeyFromPhraseAndPath(passphrase, "m/44'/134'/" + state.keyPath + "'");
        let responseError = '';
        // 4. Here we are creating a transaction by passing the module name, command, fee, and the hello message.
        const signedTx = await client.transaction.create({
            module: 'hello',
            command: 'createHello',
            fee: BigInt(transactions.convertLSKToBeddows(state.fee)),
            params: {
                "message": state.hello,
            },
        }, privateKey).catch(err => {
            responseError = err.message;
        })
        let txResponse = '';

        // 5. Once a transaction is created, it will be sent to the node and after block execution a hello message will be sent on the chain.
        if (typeof signedTx !== "undefined") {
            txResponse = await client.transaction.send(signedTx).catch(result => {
                console.log(result)
                responseError = result.message;
            });
        }
        // 6. On the basis of the response, the 'state' object will be updated.
        updateState({
            transaction: signedTx,
            response: txResponse,
            error: responseError,
            hello: '',
            fee: '',
            passphrase: '',
            keyPath: '',
        });
    };
    // [...]
}
export default SendHello;
----

The UI is now able to send hello messages on the sidechain, however, we want the UI to display the successful or erroneous response to the user.
For that, let's add the `displayData` function:

.hello_frontend/src/components/sendHello.js
[source,javascript]
----
// [...]

function SendHello() {
    // [...]
    const displayData = () => {
        if (state.error !== '') {
            return (
                <>
                    <div className="ui red segment" style={{ overflow: 'auto' }}>
                        <h3>Something went wrong! :(</h3>
                        <pre><strong>Error:</strong> {JSON.stringify(state.error, null, 2)}</pre>
                    </div>
                </>
            )
        }
        else if (typeof state.transaction !== 'undefined' && state.transaction.fee > 0) {
            return (
                <>
                    <h3>Your transaction's details are:</h3>
                    <div className="ui green segment" style={{ overflow: 'auto' }}>
                        <pre>Transaction: {JSON.stringify(state.transaction, null, 2)}</pre>
                        <pre>Response: {
                            JSON.stringify(state.response, null, 2)}</pre>
                    </div>
                </>
            )
        }
    }
    // [...]
}

export default SendHello;
----

Finally, let's update the `return` function, so that form submission, data display, and on change event can be functional.

.hello_frontend/src/components/newAccount.js
[source,javascript]
----
// [...]

function SendHello() {
    // [...]
    return (
        <>
            <FixedMenuLayout />
            <Container>
                <div>
                    <h2>Send Hello Message</h2>
                    <p>Please fill the following form to send a "Hello" message.</p>
                    <Divider></Divider>
                    <div className="ui two column doubling stackable grid container">
                        <div className="column">
                            <Form onSubmit={handleSubmit} className="ui form">
                                <Form.Field className="field">
                                    <label>Your message:</label>
                                    <input placeholder="Hello Message" id="hello" name="hello" onChange={handleChange} value={state.hello} />
                                </Form.Field >
                                <Form.Field className="field">
                                    <label>Fee:</label>
                                    <input placeholder='Fee (1 = 10^8 tokens)' type="text" id="fee" name="fee" onChange={handleChange} value={state.fee} />
                                </Form.Field>
                                <Form.Field className="field">
                                    <label>Sender's Passphrase:</label>
                                    <input placeholder='Passphrase of the hello_client' id="passphrase" name="passphrase" onChange={handleChange} value={state.passphrase} type="password" />
                                </Form.Field>
                                <Form.Field className="field">
                                    <div className="ui yellow segment">
                                        <i className="lightbulb outline icon"></i>The <strong>Sender's keyPath</strong> value can be from <strong>0-102</strong>. A default value has been pre-filled, which can be changed accordingly.
                                    </div>
                                    <label>Sender's keyPath:</label>
                                    <div className="ui labeled input">
                                        <div className="ui label">
                                            m/44'/134'/
                                        </div>
                                        <input placeholder='Enter any number from 0-102' id="keyPath" name="keyPath" onChange={handleChange} value={state.keyPath} type="text" />
                                        <div className="ui label">
                                            '
                                        </div>
                                    </div>
                                </Form.Field>
                                <Button type='submit' fluid size='large' style={{ backgroundColor: '#2BD67B', color: 'white' }}>Submit</Button>
                            </Form>
                        </div>
                        <div className='column'>
                            <>
                                {displayData()}
                            </>
                        </div>
                    </div>
                </div>
            </Container>
        </>
    );
}

export default SendHello;
----

Open the *Send Hello* page and fill out the form in it. 
Click on the Submit button, if the sender's account has sufficient balance and the hello message is acceptable as per the module's config, the transaction will be successful.

.Faucet to seed 10 LSKs to any account
image::integrate-blockchain/integrate-ui/sendHello.jpg["sendHello page", 800]

== Getting hello

Since faucet allows to seed an account, we want our Hello sApp to also allow transferring of LSKs from/to our desired accounts.

Similar to the faucet, we will start importing necessary libraries, and defining state variables and handleChange event.

.hello_frontend/src/components/transfer.js
[source,javascript]
----
// [...]
// UI libraries import
import FixedMenuLayout from '../layout/header';
import { Divider, Container } from 'semantic-ui-react';
import React, { useState, useEffect } from "react";
import MessageTimeline from './messageTimeline';
import * as api from '../api';


export default function GetHello() {
    const [messages, getHelloMessages] = useState('');

    useEffect(() => {
        getMessages()
    }, [])

    async function getMessages() {
        const client = await api.getClient();
        return client.invoke("helloInfo_getMessageList", {
        }).then(res => {
            const responseMessages = res
            getHelloMessages(responseMessages);
        });
    }

// [...]
----

Next, create the `handleSubmit` function, it will take all the inputs entered by the user and based on that will create a *token transfer* transaction.

.hello_frontend/src/components/transfer.js
[source,javascript]
----
function Transfer() {
    // [...]
    const handleSubmit = async (event) => {
        event.preventDefault();
        // 1. Get apiClient via api.js
        const client = await api.getClient();

        // 2. This is the passphrase of the sender's account.
        const passphrase = state.passphrase;

        // 3. A private key will be used to sign a transaction. A private key is generated using the keyDerivationPath and the passphrase.
        const privateKey = await cryptography.ed.getPrivateKeyFromPhraseAndPath(passphrase, "m/44'/134'/" + state.keyPath + "'");
        let responseError = '';

        // 4. Here we are creating a transaction by passing the module name, command, fee, and all the other required params.
        const signedTx = await client.transaction.create({
            module: 'token',
            command: 'transfer',
            fee: BigInt(transactions.convertLSKToBeddows(state.fee)),
            params: {
                tokenID: Buffer.from('0000000000000000', 'hex'),
                amount: BigInt(transactions.convertLSKToBeddows(state.amount)),
                recipientAddress: state.address,
                data: 'Hey! I am sending you LSKs. Enjoy!'
            }
        }, privateKey).catch(err => {
            responseError = err.message;
        });

        // 5. Once a transaction is created, it will be sent to the node and after block execution, the account's balance will increment with amount of LSKs sent to an account.
        let txResponse = '';
        if (typeof signedTx !== "undefined") {
            txResponse = await client.transaction.send(signedTx).catch(result => {
                console.log(result)
                responseError = result.message;
            });
        }

        // 6. On the basis of the response, the 'state' object will be updated.
        updateState({
            transaction: signedTx,
            response: txResponse,
            error: responseError,
            address: '',
            amount: '',
            fee: '',
            passphrase: '',
            keyPath: '',
        });
    };
    // [...]
}
// [...]
----

Our code for creating and sending a transaction is complete, let's add the code to display the response received from the node.

.hello_frontend/src/components/transfer.js
[source,javascript]
----
// [...]
function Transfer() {
    // [...]
    const displayData = () => {

        if (state.error !== '') {
            return (
                <>
                    <div class="ui red segment" style={{ overflow: 'auto' }}>
                        <h3>Something went wrong! :(</h3>
                        <pre><strong>Error:</strong> {JSON.stringify(state.error, null, 2)}</pre>
                    </div>
                </>
            )
        }

        else if (typeof state.transaction !== 'undefined' && state.transaction.fee > 0) {
            return (
                <>
                    <h3>Your transaction's details are:</h3>
                    <div class="ui green segment" style={{ overflow: 'auto' }}>
                        <pre>Transaction: {JSON.stringify(state.transaction, null, 2)}</pre>
                        <pre>Response: {
                            JSON.stringify(state.response, null, 2)}</pre>
                    </div>
                </>
            )
        }
        else {
            return (<p></p>)
        }
    }
    // [...]
}
// [...]
----

Finally, the return function needs an update, so that form submission, data display, and on change event can be functional.

.hello_frontend/src/components/transfer.js
[source,javascript]
----
// [...]
function Transfer() {
    // [...]
return (
        <>
            <div>
                <FixedMenuLayout />
                <Container>
                    <h2>Send LSK tokens</h2>
                    <p>On this page you can send LSK tokens to any address within the Hello sidechain.</p>
                    <Divider></Divider>
                    <div class="ui two column doubling stackable grid container">
                        <div class="column">

                            <Form onSubmit={handleSubmit} class="ui form">
                                <Form.Field class="field">
                                    <label>Recipient's Lisk32 Address:</label>
                                    <input placeholder="Recipient's Lisk32 Address" id="address" name="address" onChange={handleChange} value={state.address} />
                                </Form.Field>
                                <Form.Field class="field">
                                    <label>Amount:</label>
                                    <input placeholder='Amount (1 = 10^8 tokens)' id="amount" name="amount" onChange={handleChange} value={state.amount} />
                                </Form.Field>
                                <Form.Field class="field">
                                    <label>Fee:</label>
                                    <input placeholder='Fee (1 = 10^8 tokens)' id="fee" name="fee" onChange={handleChange} value={state.fee} />
                                </Form.Field>
                                <Form.Field class="field">
                                    <label>Sender's Passphrase:</label>
                                    <input placeholder='Passphrase of the hello_client' id="passphrase" name="passphrase" onChange={handleChange} value={state.passphrase} type="password" />
                                </Form.Field>
                                <Form.Field class="field">
                                    <div class="ui yellow segment">
                                        <i class="lightbulb outline icon"></i>The <strong>Sender's keyPath</strong> value can be from <strong>0-102</strong>. A default value has been pre-filled, which can be changed accordingly.
                                    </div>
                                    <label>Sender's keyPath:</label>
                                    <div class="ui labeled input">
                                        <div class="ui label">
                                            m/44'/134'/
                                        </div>
                                        <input placeholder='Enter any number from 0-102' id="keyPath" name="keyPath" onChange={handleChange} value={state.keyPath} type="text" />
                                        <div class="ui label">
                                            '
                                        </div>
                                    </div>
                                </Form.Field>
                                <Button type='submit' fluid size='large' style={{ backgroundColor: '#2BD67B', color: 'white' }}>Submit</Button>
                            </Form>
                        </div>

                        <div className='column'>
                            <>
                                {displayData()}
                            </>
                        </div>
                    </div>
                </Container>
            </div >
        </>
    );
    // [...]
}
// [...]
----

Every thing is in place now, let's test our transfer page. 

Create a new account and put it as the recipient on the transfer page. 
Use the previously seeded account as the sender by entering the passphrase.

.Transfer tokens page
image::integrate-blockchain/integrate-ui/transfer.jpg["transfer page", 800]

To check if the account balance has increased, use the xref:{url_checkBalance}[account's detail page] to fetch account balance.
