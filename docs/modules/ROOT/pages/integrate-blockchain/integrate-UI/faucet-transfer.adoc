= Using faucet and transferring tokens
Muhammad Talha <muhammad.talha@lightcurve.io>
:toc: preamble
:toclevels: 5
:sectnums:
:page-toclevels: 4
:idprefix:
:idseparator: -
:imagesdir: ../../assets/images
:sdk_docs: lisk-sdk::

// External URLs
:url_start_frontend: https://github.com/LiskHQ/lisk-sdk-examples/blob/1582-UI-boiler-plate/guides/07-ui-boilerplate/hello_frontend/README.md#start-hello_frontend
:url_faucet: https://github.com/LiskHQ/lisk-sdk-examples/blob/1582-user-interface/tutorials/hello/hello_frontend/src/components/faucet.js

:url_transfer: https://github.com/LiskHQ/lisk-sdk-examples/blob/1582-user-interface/tutorials/hello/hello_frontend/src/components/transfer.js
:url_checkBalance: integrate-blockchain/integrate-UI/create-get-account.adoc#check-balance


// Project URLs
:url_helloapp_overview: integrate-blockchain/index.adoc#integrating-a-user-interface
:url_guides_setup: build-blockchain/create-sidechain-app.adoc
:url_guides_module: build-blockchain/module/index.adoc
:url_guides_plugin: build-blockchain/plugin/index.adoc
:url_start_client: build-blockchain/module/command.adoc#start-client

With account creation and getting details of an account working, on this page, you'll learn how to seed a new account with a faucet and how to transfer LSKs to a given account.

====
On this page, you'll learn:

* [x] How to create a faucet.
* [x] How to send LSKs to a given account.
====

TIP: The relevant files discussed in this guide are {url_faucet}[faucet.js] and {url_transfer}[transfer.js]

== Creating a faucet
The idea of a faucet is to allow account holder to seed their account with 10 LSKs using a dedicated faucet account. 

First up, define the necessary variables and `handleChange` event.

.hello_frontend/src/components/faucet.js
[source,javascript]
----
// [...]
// UI libraries import
import React, { useState, useEffect } from "react";
// lisk libraries import
import { cryptography, transactions } from '@liskhq/lisk-client/browser';
import * as api from '../api';
import { Buffer } from 'buffer';

function Faucet() {

    const [state, updateState] = useState({
        address: '',
        privateKey: '',
        error: '',
        transaction: {},
        response: {}
    });

    const handleChange = (event) => {
        const { name, value } = event.target;
        updateState({
            ...state,
            [name]: value,
        });
    };
    // [...]

}

// [...]
----

We want an action to be taken when a user enter's an address into the input and clicks on the Submit button.
This will be handled in the `handleSubmit` function, where we are first creating a token transfer transaction, and then posting it to the node.

.hello_frontend/src/components/faucet.js
[source,javascript]
----
// [...]

function Faucet() {

    // [...]

    const handleSubmit = async (event) => {
        event.preventDefault();

        // 1. Get apiClient via api.js
        const client = await api.getClient();
        
        // 2. This is the passphrase of the hello_client since, we are using the first account of the hello_client.
        const passphrase = "pet simple hour myth sing tattoo demand whale pride craft already actress purse awake advance frequent enroll oxygen enhance resemble arrow accident wave tuna";
        
        // 3. A private key will be used to sign a transaction. A private key is generated using the keyDerivationPath and the passphrase.
        const privateKey = await cryptography.ed.getPrivateKeyFromPhraseAndPath(passphrase, "m/44'/134'/0'");
        let responseError = '';
        
        // 4. Here we are creating a transaction by passing the module name, command, fee, and all the other required params.
        const signedTx = await client.transaction.create({
            module: 'token',
            command: 'transfer',
            fee: BigInt(transactions.convertLSKToBeddows('0.1')),
            params: {
                tokenID: Buffer.from('0000000000000000', 'hex'),
                amount: BigInt(transactions.convertLSKToBeddows('10')),
                recipientAddress: state.address,
                data: 'Please accept this grant from Lisk faucet.'
            }
        }, privateKey).catch(err => {
            responseError = err.message;
        });
        
        // 5. Once a transaction is created, it will be sent to the node and after block execution, the account's balance will increment with 10 LSKs.
        let txResponse = '';
        if (typeof signedTx !== "undefined") {
            txResponse = await client.transaction.send(signedTx).catch(result => {
                console.log(result)
                responseError = result.message;
            });
        }

        // 6. On the basis of the response, the 'state' object will be updated.
        updateState({
            transaction: signedTx,
            response: txResponse,
            error: responseError,
            address: '',
            amount: '',
            fee: '',
            passphrase: '',
        });
    };
    // [...]
}
----

Our code for creating and sending a transaction is complete, let's add the code to display the response received from the node.

.hello_frontend/src/components/faucet.js
[source,javascript]
----
// [...]

function Faucet() {
    // [...]
    const displayData = () => {

        if (state.error !== '') {
            return (
                <>
                    <div className="ui red segment" style={{ overflow: 'auto' }}>
                        <h3>Something went wrong! :(</h3>
                        <pre><strong>Error:</strong> {JSON.stringify(state.error, null, 2)}</pre>
                    </div>
                </>
            )
        }

        else if (typeof state.transaction !== 'undefined' && state.transaction.fee > 0) {
            return (
                <>
                    <h3>Your transaction's details are:</h3>
                    <div className="ui green segment" style={{ overflow: 'auto' }}>
                        <pre>Transaction: {JSON.stringify(state.transaction, null, 2)}</pre>
                        <pre>Response: {
                            JSON.stringify(state.response, null, 2)}</pre>
                    </div>
                </>
            )
        }
        else {
            return (<p></p>)
        }
    }
    // [...]
}

// [...]
----

Finally, the return function needs an update, so that form submission, data display, and on change event can be functional.

.hello_frontend/src/components/newAccount.js
[source,javascript]
----
// [...]

function Faucet() {
    // [...]
    return (
        <>
            <FixedMenuLayout />
            <Container>
                <h2>Faucet</h2>
                <p>The faucet transfers tokens from the genesis account to another.</p>
                <Divider></Divider>
                <div>
                    <div className="ui two column doubling stackable grid container">
                        <div className="column">
                            <Form onSubmit={handleSubmit}>
                                <Form.Field>
                                    <label>Recipient's Lisk32 Address:</label>
                                    <input placeholder="Recipient's Lisk32 Address" id="address" name="address" onChange={handleChange} value={state.address} />
                                </Form.Field>
                                <Button type='submit' fluid size='large' style={{ backgroundColor: '#2BD67B', color: 'white' }}>Submit</Button>
                            </Form>
                        </div>

                        <div className='column'>
                            <>
                                {displayData()}
                            </>
                        </div>
                    </div>
                </div>
            </Container>

        </>
    );

    // [...]
}
// [...]
----

Open the *Faucet* page and enter an account address in it. 
Click on the Submit button, if the address is correct and the faucet account has enough balance, your transaction will be successful and will be shown on screen.

.Faucet to seed 10 LSKs to any account
image::integrate-blockchain/integrate-ui/faucet.jpg["new account page", 800]

To check if the account balance has increased, use the xref:{url_checkBalance}[account's detail page] to fetch account balance.


// .Create new account page
// image::integrate-blockchain/integrate-ui/newAccount.jpg["new account page", 800]

== Getting account details
With a working account creation feature, let update the `getAccountDetails.js` in the *hello_frontend/src/components/* directory to support the fetching account details feature.


.hello_frontend/src/components/newAccount.js
[source,javascript]
----
// [...]
// UI libraries import
import React, { useState } from "react";
//import api.js 
import * as api from '../api';


// [...]
----
The `handleSubmit` function will use the apiClient to invoke the `token_getBalance` and `auth_getAuthAccount` endpoints. 

The response of these requests will be shown to the user with the `displayData` function described in the following snippet:
[#error-display]
.hello_frontend/src/components/newAccount.js
[source,javascript]
----
// [...]

// [...]
----

Finally in the `return` function we will call the `displayData` function to display the appropriate response.

.hello_frontend/src/components/newAccount.js
[source,javascript]
----
// [...]


// [...]
----



// .Get account details
// image::integrate-blockchain/integrate-ui/getAccountDetails.jpg["new account page", 800]

// Alternatively, if something goes wrong, the UI will also display the appropriate error as in the `displayData` function we have implemented the UI for <<error-display, error handling:>>

// .Error in fetching details on an account
// image::integrate-blockchain/integrate-ui/getAccountDetails-error.jpg["new account page", 800]