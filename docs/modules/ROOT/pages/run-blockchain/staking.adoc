= How to stake and unstake tokens
:toc:

====
On this page, you'll learn how to (un-)stake tokens for a validator.

This includes how to:

* [x] Stake via the node CLI
* [x] Un-stake via the node CLI
* [x] Unlock tokens after un-stake
====

== Start the blockchain application

To conveniently create and send a transaction, first start the node, so it can handle the incoming CLI commands accordingly.

[tabs]
=====
Lisk Core::
+
--
[source,bash]
----
lisk-core start
----
--
Sidechain node::
+
--
[source,bash]
----
./bin/run start
----
--
=====

== Create the Stake transaction

Create a transaction to register a normal account as a validator.

The following parameter is required:

* `stakes`: Array
** `amount`:
** `validatorAddress`:


== Staking

[tabs]
=====
Lisk Core::
+
--
//TODO: Update Lisk Core
--
Lisk app::
+
--
[source,bash]
----
$ ./bin/run transaction:create pos stake 100000000 --params='{"stakes":[{"validatorAddress":"86555265f0110b4ed5a8cb95dbc732e77732c474","amount":1000000000}]}'
? Please enter passphrase:  [hidden]
? Please re-enter passphrase:  [hidden]
----
--
=====

Next, enter the passphrase of your account.

----
? Please enter passphrase:  [hidden]
? Please re-enter passphrase:  [hidden]
----

The CLI will return the transaction already in binary format, ready to be posted to a node.

[source,json]
----
{"transaction":"0a0464706f731210726567697374657244656c656761746518002080d6c28c042a206290c8b58de8b71fedb7e3cb9a6ee9426aa3e7ac0141f278526375d46705b54632be010a066d796e616d651220aaecd278a3fadc40a4a824d6f4aa24547d8fb9d075ec4d6967a7084f9a3f25411a30815a9e7643cf2bace98d1337f1dca8e39949592cd3fcb79bf3ab5784981468b9987b3340527bc9ca263a2fd0618120242260add8669bb57f3dceec04dc0f875906cb52a677f1df911536c01f447c8830bf27cd43713af18d84de5a64ec504aeaf9a30521c09438bb5a4d5fd634946c65e0fc4ea3681fdb4f6949cb6c1bc1ac1ddec3df058a13466af5a13d50737938fd7d5f3a40d841c3ea463e2c2fd598bd56c77998241bc86e8143e59baf5f06b11491f3c8557e2d82c1139f927adcb0055256f5a5419a4853950856c2e9ae3588a7885a3f05"}
----

TIP: To return the transaction in JSON format as well, simply add the flag `--pretty` to the command.

== Unstaking

== Send the transaction

[tabs]
=====
Lisk Core::
+
--
[source,bash]
----
lisk-core transaction:send 0805100018032080d6c28c042a20bad983c72bed43fd274f852658c298b74c71ab6fc50508879fef309e3836384b32080a066d796e616d653a4045afdd04d0c0bc6e548c0915d5fabef1311b1b75b1eb919a43b88dab539e7b6a99b9075f5d6382ec3bbebfca3301651a15d8af3f999d5b6fa7873b3969cd3d0c
----
--
Sidechain node::
+
--
Use the xref:{url_references_cli_txsend}[transaction send] command to send the transaction to your node.

[source,bash]
----
./bin/run transaction send 0a0464706f731210726567697374657244656c656761746518002080d6c28c042a206290c8b58de8b71fedb7e3cb9a6ee9426aa3e7ac0141f278526375d46705b54632be010a066d796e616d651220aaecd278a3fadc40a4a824d6f4aa24547d8fb9d075ec4d6967a7084f9a3f25411a30815a9e7643cf2bace98d1337f1dca8e39949592cd3fcb79bf3ab5784981468b9987b3340527bc9ca263a2fd0618120242260add8669bb57f3dceec04dc0f875906cb52a677f1df911536c01f447c8830bf27cd43713af18d84de5a64ec504aeaf9a30521c09438bb5a4d5fd634946c65e0fc4ea3681fdb4f6949cb6c1bc1ac1ddec3df058a13466af5a13d50737938fd7d5f3a40d841c3ea463e2c2fd598bd56c77998241bc86e8143e59baf5f06b11491f3c8557e2d82c1139f927adcb0055256f5a5419a4853950856c2e9ae3588a7885a3f05
----
--
=====

If the sending process was successful, it will return the following message, including the respective transaction ID.

----
Transaction with id: '1809da284fe26dba90d34dc3aab837a32d3c291a4ca78a9bfa263f927c69598a' received by node.
----

== Check account details

Invoke the `pos_getValidator` endpoint, to verify the account has now registered a validator name:

[tabs]
=====
Lisk Core::
+
--
//TODO: Update Lisk Core
--
Sidechain node::
+
--
[source,bash]
----
./bin/run endpoint:invoke pos_getValidator '{ "address":"lskqaxxmj78frvgpjgwvf4yqjjkcrr9yhn2sxxwm3"}' --pretty
----
--
=====

The new validator name should be displayed in the response, along with the corresponding address and other public information about this particular validator.

[source,json]
----
{
  "name": "myuniquename",
  "totalStakeReceived": "0",
  "selfStake": "0",
  "lastGeneratedHeight": 14,
  "isBanned": false,
  "pomHeights": [],
  "consecutiveMissedBlocks": 0,
  "commission": 10000,
  "lastCommissionIncreaseHeight": 14,
  "sharingCoefficients": [],
  "address": "lskqaxxmj78frvgpjgwvf4yqjjkcrr9yhn2sxxwm3",
  "punishmentPeriods": []
}
----

== Unlocking tokens after un-stake

////
A positive `amount` votes with the tokens for the respective delegate.

A negative `amount` unvotes the specified amount of tokens for a delegate.

[NOTE]
====
Up to 20 votes and unvotes can be included in a single vote transaction.
====

[tabs]
=====
Lisk Core::
+
--
[source,bash]
----
$ lisk-core transaction:create 5 1 100000000 --asset='{"votes":[{"delegateAddress":"86555265f0110b4ed5a8cb95dbc732e77732c474","amount":1000000000}]}'
? Please enter passphrase:  [hidden]
? Please re-enter passphrase:  [hidden]
----
--
Lisk app::
+
--
[source,bash]
----
$ ./bin/run transaction:create 5 1 100000000 --asset='{"votes":[{"delegateAddress":"86555265f0110b4ed5a8cb95dbc732e77732c474","amount":1000000000}]}'
? Please enter passphrase:  [hidden]
? Please re-enter passphrase:  [hidden]
----
--
=====

.Example output
[source,json]
----
{"transaction":"0805100118022080c2d72f2a200fe9a3f1a21b5530f27f87a414b549e79a940bf24fdf2b2f05e7f22aeeecc86a321e0a1c0a1486555265f0110b4ed5a8cb95dbc732e77732c4741080a8d6b9073a40d8c0cec4ce780af8bb5a883236e6826dbc0b5748f0bde07607a8de508e15b8bda3e15f942b10e034fbdacebd2b4fb035462bd0845f8616a965962c1184729a0e"}
----
////