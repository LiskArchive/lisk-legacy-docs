<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Part 2: A simple supply chain management system :: Docs</title>
    <link rel="canonical" href="https://lisk.io/documentation/lisk-sdk/tutorials/transport2.html">
    <meta name="description" content="Part 2 of the Lisk supply chain tutorial describes how to implement a simple supply chain tracking system. In addition, it also teaches the user how to implement a simple trust system and how to lock funds in an account.">
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/site-extra.css">
      <link rel="stylesheet" href="../../_/css/vendor/docsearch.min.css">
      <!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css -->
    <link rel="icon" href="../../favicon.ico" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
    <!--
    <link href="https://unpkg.com/primer/build/build.css" rel="stylesheet">
-->
<link rel="icon" href="/sites/default/files/favicons/favicon-32x32.png" type="image/png">
  </head>
  <body class="article">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NKNKGHL');</script>
<!-- End Google Tag Manager -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NKNKGHL"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<header class="header">
  <nav class="navbar">
      <div class="navbar-content">
        <div class="navbar-brand">
          <a href="https://lisk.io" class="lisk-logo"></a>
            <span  class="nav-brand__name-area">
              <strong class="nav-brand__name-area__title">SDK Docs</strong>
                          </span>
          <button class="navbar-burger" data-target="topbar-nav">
            <span></span>
            <span></span>
            <span></span>
          </button>
        </div>
        <div id="topbar-nav" class="navbar-menu">
          <div class="navbar-end">
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="">Docs</a>
              <div class="navbar-dropdown">
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/">Lisk SDK</a>
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-core/">Lisk Core</a>
              </div>
            </div>
              <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-link" href="https://lisk.io/documentation/lisk-sdk/tutorials/index.html">Tutorials</a>
                <div class="navbar-dropdown">
                  <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/tutorials/hello-world.html">Hello World</a>
                  <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/tutorials/transport.html">Supply chain</a>
                </div>
              </div>
              <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-link" href="https://lisk.io/documentation/lisk-sdk/guides/index.html">Guides</a>
                <div class="navbar-dropdown">
                  <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/guides/configuration.html">Configure the blockchain application</a>
                  <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/guides/customize.html">Create custom transaction types</a>
                  <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/guides/test.html">Test transaction types</a>
                  <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/guides/interact.html">Interact with the network</a>
                  <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/guides/broadcast.html">Broadcast transactions</a>
                  <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/guides/frontend.html">Connect a frontend</a>
                  <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/guides/forging.html">Enable forging</a>
                  <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/guides/launch.html">Launch the app</a>
                </div>
              </div>
              <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-link" href="https://lisk.io/documentation/lisk-sdk/reference/index.html">Reference</a>
                <div class="navbar-dropdown">
                  <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/reference/api.html">API specification</a>
                  <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/reference/config.html">Config</a>
                  <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/reference/lisk-elements">Lisk Elements</a>
                  <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/reference/lisk-commander">Lisk Commander</a>
                  <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/reference/lisk-framework">Lisk Framework</a>
                </div>
              </div>
                        <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="">Resources</a>
              <div class="navbar-dropdown">
                <a class="navbar-item" href="https://lisk.io/roadmap"><i class="icofont-map-pins"></i>Roadmap</a>
                <a class="navbar-item" href="https://lisk.io/research"><i class="icofont-laboratory"></i>Research</a>
                <a class="navbar-item" href="https://lisk.io/blog"><i class="icofont-paper"></i>Blog</a>
                <a class="navbar-item" href="https://lisk.io/apps"><i class="icofont-dashboard-web"></i>Blockchain Apps List</a>
                <a class="navbar-item" href="https://lisk.io/builders-program"><i class="icofont-worker"></i>Lisk Builders Program</a>
                <a class="navbar-item" href="https://dev.lisk.io/"><i class="icofont-penguin-linux"></i>Dev Forum</a>
                <a class="navbar-item" href="https://lisk.io/community"><i class="icofont-people"></i>Community</a>
              </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="">Explore</a>
              <div class="navbar-dropdown">
                <a class="navbar-item" target="_blank" href=""><strong>GitHub</strong></a>
                <a class="navbar-item" target="_blank" href="https://github.com/LiskHQ/lisk-sdk">Lisk SDK GitHub<i class="icofont-external-link"></i></a>
                <a class="navbar-item" target="_blank" href="https://github.com/LiskHQ/lisk-core">Lisk Core GitHub<i class="icofont-external-link"></i></a>
                <a class="navbar-item" target="_blank" href="https://github.com/LiskHQ/lisk-sdk-examples">Example Applications GitHub<i class="icofont-external-link"></i></a>
                <hr class="navbar-divider">
                <a class="navbar-item" target="_blank" href=""><strong>Blockchain Explorer</strong></a>
                <a class="navbar-item" target="_blank" href="https://testnet-explorer.lisk.io/">Testnet Explorer<i class="icofont-external-link"></i></a>
                <a class="navbar-item" target="_blank" href="https://explorer.lisk.io/">Mainnet Explorer<i class="icofont-external-link"></i></a>
                <a class="navbar-item" target="_blank" href="https://betanet-explorer.lisk.io/">Betanet Explorer<i class="icofont-external-link"></i></a>
              </div>
            </div>
          </div>
            <div class="navbar-menu">
              <div class="navbar-item hide-for-print">
                <input id="search-input" type="text" placeholder="Search docs">
              </div>
            </div>
        </div>
      </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="lisk-sdk" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Lisk SDK</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../setup.html">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../guides/index.html">Guides</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../guides/configuration.html">Configure the blockchain application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../guides/customize.html">Create custom transaction types</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../guides/test.html">Test transaction types</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../guides/interact.html">Interact with the network</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../guides/broadcast.html">Broadcast transactions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../guides/frontend.html">Connect a frontend</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../guides/forging.html">Enable forging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../guides/launch.html">Launch the app</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../best-practices.html">Best practices</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Tutorials</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="hello-world.html">Hello world</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="transport.html">Supply chain</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="transport0.html">Part 0: Installation &amp; setup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="transport1.html">Part 1: Track a packet on the blockchain</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="transport2.html">Part 2: A simple supply chain management system</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="transport3.html">Part 3: How to publish the application</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../reference/index.html">Reference</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/api.html">API specification</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/config.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/changelog.html">Developer changelog</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../reference/lisk-commander/index.html">Lisk Commander</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#reference/lisk-commander/user-guide/commands.adoc">Commands</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#reference/lisk-commander/user-guide/lisk-core.adoc">Lisk Core commands</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#reference/lisk-commander/user-guide/sensitive-inputs.adoc">Sensitive inputs</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../reference/lisk-elements/index.html">Lisk Elements</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#reference/lisk-elements/packages/api-client.adoc">API client</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="#reference/lisk-elements/packages/api-client/accounts.adoc">Accounts</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="#reference/lisk-elements/packages/api-client/blocks.adoc">Blocks</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="#reference/lisk-elements/packages/api-client/dapps.adoc">DApps</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="#reference/lisk-elements/packages/api-client/delegates.adoc">Delegates</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="#reference/lisk-elements/packages/api-client/node.adoc">Node</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="#reference/lisk-elements/packages/api-client/peers.adoc">Peers</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="#reference/lisk-elements/packages/api-client/signatures.adoc">Signatures</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="#reference/lisk-elements/packages/api-client/transactions.adoc">Transactions</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="#reference/lisk-elements/packages/api-client/voters.adoc">Voters</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="#reference/lisk-elements/packages/api-client/votes.adoc">Votes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#reference/lisk-elements/packages/client.adoc">Client</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#reference/lisk-elements/packages/constants.adoc">Constants</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#reference/lisk-elements/packages/cryptography.adoc">Cryptography</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#reference/lisk-elements/packages/p2p.adoc">P2P</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#reference/lisk-elements/packages/passphrase.adoc">Passphrase</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#reference/lisk-elements/packages/transaction-pool.adoc">Transaction pool</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#reference/lisk-elements/packages/transactions.adoc">Transactions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#reference/lisk-elements/packages/validator.adoc">Validator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/lisk-framework/index.html">Lisk Framework</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Lisk SDK</span>
    <span class="version">3.0.2 (latest)</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Lisk Core</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lisk-core/index.html">2.1.5 (latest)</a>
        </li>
        <li class="version">
          <a href="../../lisk-core/3.0.0/index.html">3.0.0-beta.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Lisk SDK</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">3.0.2 (latest)</a>
        </li>
        <li class="version">
          <a href="../2.3.7/index.html">2.3.7</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Lisk SDK</a></li>
    <li><a href="index.html">Tutorials</a></li>
    <li><a href="transport.html">Supply chain</a></li>
    <li><a href="transport2.html">Part 2: A simple supply chain management system</a></li>
  </ul>
</nav>
<button class="toc-toggle"></button>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">3.0.2 (latest)</button>
  <div class="version-menu">
    <a class="version is-current" href="transport2.html">3.0.2 (latest)</a>
    <a class="version" href="../2.3.7/tutorials/transport2.html">2.3.7</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/LiskHQ/lisk-docs/edit/484-restructure-elements-commander/modules/ROOT/pages/tutorials/transport2.adoc">Edit this Page</a></div>
  </div>
<article class="doc">
<h1 class="page">Part 2: A simple supply chain management system</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The goal of Part 2 covers how to implement a complete workflow of a simple version of a supply chain tracking system.</p>
</div>
<div class="paragraph">
<p>The following points below are covered in this section:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How to implement the missing transactions types <code>RegisterPacket</code>, <code>StartTransport</code> and <code>FinishTransport</code>.</p>
</li>
<li>
<p>How to cache multiple accounts in the <code>prepare</code> step.</p>
</li>
<li>
<p>How to implement a simple trust system.</p>
</li>
<li>
<p>How to lock funds in an account.</p>
</li>
<li>
<p>How to execute a first complete test-run of the supply chain tracking system.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is recommended to view the <a href="transport.html#procedure" class="page">diagram on the Introduction page</a>, which will help the user to have an overiew of the workshop.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">"Are there more of those&#8230;&#8203; solutions?"</dt>
<dd>
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/tree/development/transport/transactions/solutions">Yes, there are more!</a>, check out the fully working implementation of the other transactions in the <code>transactions/solutions/</code> folder.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>After completing a task, compare with the solutions in order to verify if the task has been successfully completed.
However, be aware that there is not only just one valid solution to write the code.
In step 2.3 later in this section, the actual code will be run to verify it functions correctly.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="register_packet"><a class="anchor" href="#register_packet"></a>2.0 Implement RegisterPacket</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To move on to the next step in the prototype it is necessary to implement the <code>RegisterPacket</code> transaction.
This transaction will register a packet on the blockchain that is ready to be picked up by a delivery person.
The transaction allows the package owner to define the following properties listed below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>packetId</code>: The ID of the packet account (registered on Raspberry Pi).</p>
</li>
<li>
<p><code>postage</code>: The postage refers to a number of LSK tokens the carrier receives upon successful delivery of the packet.
The postage is stored in the packet account&#8217;s asset field.</p>
</li>
<li>
<p><code>security</code>: The security refers to a number of LSK tokens that the carrier should lock as a "security" before the packet can be accepted for delivery.
Upon successful delivery, the security will be unlocked again to the carriers balance.</p>
</li>
<li>
<p><code>minTrust</code>: This minimum trust property has been introduced to keep track of well-behaving/performing carriers.
Whenever a carrier successfully delivers a packet, his trust will be increased by a factor of one.
The package owner can set a minimal trust level for a carrier before he can accept the package for delivery.
If a carrier has a lower trust than the minimal required trust level, it is not possible to accept the package for delivery.</p>
</li>
<li>
<p><code>recipientId</code>: Please note that this is a highly important field, as it sets the actual recipient who will receive the package.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the <code>RegisterPacketTransaction</code> the following guide runs through the <code>undoAsset()</code> function, and explains how this can be achieved; and in turn allows the user to implement a small snippet of code which is described below:</p>
</div>
<div class="listingblock">
<div class="title">Contents of <code>register-packet.js</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const {
    BaseTransaction,
    TransactionError,
    utils
} = require('@liskhq/lisk-transactions');

/**
 * Register new package for sender and update package account.
 */
class RegisterPacketTransaction extends BaseTransaction {

    static get TYPE () {
        return 20;
    }

    static get FEE () {
        return '0';
    };

    /* Prepare function stores both sender and packet account in the cache so it is possible to
       modify the accounts during the `applyAsset` and `undoAsset` steps. */
    async prepare(store) {
        await store.account.cache([
            {
                address: this.asset.packetId,
            },
            {
                senderPublicKey: this.senderPublicKey,
            }
        ]);
    }

    /* Static checks for presence and correct datatypes of transaction parameters in
       asset field like `minTrust`, `security`, `postage`, etc. */
    validateAsset() {
        const errors = [];
        if (!this.asset.packetId || typeof this.asset.packetId !== 'string') {
            errors.push(
                new TransactionError(
                    'Invalid "asset.packetId" defined on transaction',
                    this.id,
                    '.asset.packetId',
                    this.asset.packetId
                )
            );
        }
        if (!this.asset.postage || typeof this.asset.postage !== 'string') {
			errors.push(
				new TransactionError(
					'Invalid "asset.postage" defined on transaction',
					this.id,
					'.asset.postage',
					this.asset.postage,
					'A string value',
				)
			);
        }
        if (!this.asset.security || typeof this.asset.security !== 'string') {
			errors.push(
				new TransactionError(
					'Invalid "asset.security" defined on transaction',
					this.id,
					'.asset.security',
					this.asset.security,
					'A string value',
				)
			);
        }
        if (typeof this.asset.minTrust !== 'number' || isNaN(parseFloat(this.asset.minTrust)) || !isFinite(this.asset.minTrust)) {
			errors.push(
				new TransactionError(
					'Invalid "asset.minTrust" defined on transaction',
					this.id,
					'.asset.minTrust',
					this.asset.minTrust,
					'A number value',
				)
			);
		}
        return errors;
    }

    applyAsset(store) {
        const errors = [];
        /* Retrieve packet account from key-value store. */
        const packet = store.account.get(this.asset.packetId);
        /* Check if packet account already has a status assigned.
           If yes, then this means the package is already registered so an error is thrown. */
        if (!packet.asset.status) {
            /* --- Modify sender account --- */
            /**
             * Update the sender account:
             * - Deduct the postage from senders' account balance
             */
            const sender = store.account.get(this.senderId);
            /* Deduct the defined postage from the sender's account balance. */
            const senderBalancePostageDeducted = new utils.BigNum(sender.balance).sub(
                new utils.BigNum(this.asset.postage)
            );
            /* Save the updated sender account with the new balance into the key-value store. */
            const updatedSender = {
                ...sender,
                balance: senderBalancePostageDeducted.toString(),
            };
            store.account.set(sender.address, updatedSender);

             /* --- Modify packet account --- */
            /**
             * Update the packet account:
             * - Add the postage to the packet account balance
             * - Add all important data about the packet inside the asset field:
             *   - recipient: ID of the packet recipient
             *   - sender: ID of the packet sender
             *   - carrier: ID of the packet carrier
             *   - security: Number of tokens the carrier needs to lock during the transport of the packet
             *   - postage: Number of tokens the sender needs to pay for transportation of the packet
             *   - minTrust: Minimal trust that is needed to be carrier for the packet
             *   - status: Status of the transport (pending|ongoing|success|fail)
             */
            /* Add the postage now to the packet's account balance. */
            const packetBalanceWithPostage = new utils.BigNum(packet.balance).add(
                new utils.BigNum(this.asset.postage)
            );

            const updatedPacketAccount = {
                ...packet,
                ...{
                    balance: packetBalanceWithPostage.toString(),
                    asset: {
                        recipient: this.asset.recipientId,
                        sender: this.senderId,
                        security: this.asset.security,
                        postage: this.asset.postage,
                        minTrust: this.asset.minTrust,
                        status: 'pending',
                        carrier: null
                    }
                }
            };
            store.account.set(packet.address, updatedPacketAccount);
        } else {
            errors.push(
                new TransactionError(
                    'packet has already been registered',
                    packet.asset.status
                )
            );
        }
        return errors;
    }

    undoAsset(store) {
        const errors = [];

        /* UndoAsset function tells the blockchain how to rollback changes made in the applyAsset function.
           The original balance for both the sender and package account is restored.
           In addtion, the `asset` field for the package account to `null` is reset, as it did not hold any previous data.*/
        /* --- Revert sender account --- */                                         <i class="conum" data-value="8"></i><b>(8)</b>
        const sender = store.account.get(this.senderId);
        const senderBalanceWithPostage = new utils.BigNum(sender.balance).add(
            new utils.BigNum(this.asset.postage)
        );
        const updatedSender = {
            ...sender,
            balance: senderBalanceWithPostage.toString()
        };
        store.account.set(sender.address, updatedSender);

        /* --- Revert packet account --- */
        const packet = store.account.get(this.asset.packetId);
        /* something is missing here */
        store.account.set(packet.address, originalPacketAccount);

        return errors;
    }

}

module.exports = RegisterPacketTransaction;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_task_complete_the_implementation_of_the_undoasset_function"><a class="anchor" href="#_task_complete_the_implementation_of_the_undoasset_function"></a>Task: Complete the implementation of the <code>undoAsset</code> function.</h3>
<div class="paragraph">
<p>Please note a small part of the logic is missing whereby the packet account was reset to its original state.</p>
</div>
<div class="paragraph">
<p>Now try to implement the <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/transport/transactions/register-packet.js#L160">missing logic</a> for <code>undoAsset()</code> by reverting the steps of the <code>applyAsset()</code> function.</p>
</div>
<div class="paragraph">
<p><strong>Important: To verify the implementation of <code>undoAsset()</code>, compare it with the <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/transport/transactions/solutions/register-packet.js">solution</a>.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_explanation_undoassetstore"><a class="anchor" href="#_explanation_undoassetstore"></a>Explanation: <code>undoAsset(store)</code></h3>
<div class="paragraph">
<p>The <code>undoAsset</code> function is responsible for informing the blockchain how to revert changes that have been applied via the <code>applyAsset</code> function.
This is very useful in case of a fork whereby it is necessary to change to a different chain.
In order to accomplish this it is necessary to roll back blocks and apply new blocks of a new chain.
Hence, when rolling back blocks it is necessary to update the account state of the affected accounts.
Please note that this is the reason why writing the logic for the <code>undoAsset</code> function should never be skipped.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_2_1_start_the_transport"><a class="anchor" href="#_2_1_start_the_transport"></a>2.1 Start the transport</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For the next step it is now required to implement the <code>StartTransport</code> transaction.
This transaction indicates the start of the transportation as the carrier picks up the package from the sender.</p>
</div>
<div class="paragraph">
<p>When creating the <code>StartTransport</code> transaction, the carrier defines the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>packetId</code>: The ID of the packet that the carrier is going to transport.
The <code>packetId</code> is not sent in the asset field, but is assigned to the <code>recipientId</code> property of the transaction.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This transaction will perform the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Lock the specified <code>security</code> of the packet in the carrier&#8217;s account.
This security cannot be accessed by the carrier, unless the transport has been finished successfully.</p>
</li>
<li>
<p>Add the <code>carrier</code> to the packet account.</p>
</li>
<li>
<p>Set the <code>status</code> of the packet from <code>pending</code> to <code>ongoing</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>StartTransportTransaction</code> , the <code>prepare(),and the `undoAsset()</code> functions are described below, including implementing the security locking of the carriers account:</p>
</div>
<div class="listingblock">
<div class="title">Contents of start-transport.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const {
    BaseTransaction,
    TransactionError,
    utils
} = require('@liskhq/lisk-transactions');

class StartTransportTransaction extends BaseTransaction {

    static get TYPE () {
        return 21;
    }

    static get FEE () {
        return '0';
    };

    /* The `senderId`, which is the carrier account and
       the `recipientId` are both cached, which is the packet account in the `prepare` function. */
    async prepare(store) {
        await store.account.cache([
            {
                address: this.asset.recipientId,
            },
            {
                senderPublicKey: this.senderPublicKey,
            }
        ]);
    }

    /* No static validation is required, as there is no data being sent in the `asset` field. */
    validateAsset() {
        const errors = [];

        return errors;
    }

    applyAsset(store) {
        const errors = [];
        const packet = store.account.get(this.asset.recipientId);
        if (packet.asset.status === "pending"){
            const carrier = store.account.get(this.senderPublicKey);
            // If the carrier has the trust to transport the packet
            const carrierTrust = carrier.asset.trust ? carrier.asset.trust : 0;
            const carrierBalance = new utils.BigNum(carrier.balance);
            const packetSecurity = new utils.BigNum(packet.asset.security);
            /* Check if the carrier has the minimal trust required for accepting the package.
               In addition, the carriers balance is checked to see if it is larger than the required security balance, as it is necessary to lock this security inside the account. */
            if (packet.asset.minTrust &lt;= carrierTrust &amp;&amp; carrierBalance.gte(packetSecurity)) {
                /**
                 * Update the Carrier account:
                 * - Lock security inside the account
                 * - Remove the security from balance
                 * - initialize carriertrust, if not present already
                 */
                /* Next,the defined security is locked, (number of LSK tokens) in the asset field
                   under the property `lockedSecurity` and this security is deducted from the `carrierBalance`. */
                const carrierBalanceWithoutSecurity = carrierBalance.sub(packetSecurity);
                const carrierTrust = carrier.asset.trust ? carrier.asset.trust : 0;
                const updatedCarrier = /* Insert the updated carrier account here*/
                store.account.set(carrier.address, updatedCarrier);
                /**
                 * Update the Packet account:
                 * - Set status to "ongoing"
                 * - set carrier to ID of the carrier
                 */
                packet.asset.status = "ongoing";
                packet.asset.carrier = carrier.address;
                store.account.set(packet.address, packet);
            } else {
                errors.push(
                    new TransactionError(
                        'carrier has not enough trust to deliver the packet, or not enough balance to pay the security',
                        packet.asset.minTrust,
                        carrier.asset.trust,
                        packet.asset.security,
                        carrier.balance
                    )
                );
            }
        } else {
            errors.push(
                new TransactionError(
                    'packet status needs to be "pending"',
                    packet.asset.status
                )
            );
        }

        return errors;
    }

    undoAsset(store) {
        const errors = [];
        const packet = store.account.get(this.asset.recipientId);
        const carrier = store.account.get(this.senderPublicKey);
        /* --- Revert carrier account --- */
        const carrierBalanceWithSecurity = new utils.BigNum(carrier.balance).add(
            new utils.BigNum(packet.assset.security)
        );
        /* For the `undoAsset` function, it is necessary to revert the steps of `applyAsset` again.
           Hence, it is necessary to remove the locked balance in the `asset` field and add this
           number again to the `balance` of the carrier's account. */
        const updatedCarrier = {
            ...carrier,
            balance: carrierBalanceWithSecurity.toString()
        };
        store.account.set(carrier.address, updatedCarrier);
        /* --- Revert packet account --- */
        /* For the packet account, it is also necessary to undo certain items.
           Now set the `deliveryStatus` again to `pending`.
           The `carrier` value need sto be nullified as well. */
        const updatedData = {
            asset: {
                deliveryStatus: "pending",
                carrier: null
            }
        };
        const newObj = {
            ...packet,
            ...updatedData
        };
        store.account.set(packet.address, newObj);
        return errors;
    }

}

module.exports = StartTransportTransaction;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_task_lock_funds"><a class="anchor" href="#_task_lock_funds"></a>Task: Lock funds.</h3>
<div class="paragraph">
<p>To lock the funds, simply deduct the number of tokens lock from the account&#8217;s balance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const carrierBalanceWithoutSecurity = carrierBalance.sub(packetSecurity);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, store the deducted number of tokens in a custom property in the <code>asset</code> field.
This provides the ability to keep track of the amount of tokens locked as security.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/transport/transactions/start-transport.js#L53">Insert your own code here</a>:
Create an updated object for the carrier account that substracts the <code>security</code> from the carriers balance, and add a new property <code>lockedSecurity</code> to the <code>asset</code> field of the carriers account.
The <code>lockedSecurity</code> should exactly equal the amount deducted from the carriers <code>balance</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To unlock locked tokens remove or nullify the custom property in the <code>asset</code> field and add the number of tokens again to the account&#8217;s <code>balance</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Important: To verify the implementation, please compare it with the <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/transport/transactions/solutions/start-transport.js">solution</a>.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_explanation_prepare"><a class="anchor" href="#_explanation_prepare"></a>Explanation: <code>prepare()</code></h3>
<div class="paragraph">
<p>The prepare function here is caching both the carrier account through the <code>senderId</code> and the packet account through the <code>recipientId</code>.</p>
</div>
<div class="paragraph">
<p><em>Why is it possible to cache two accounts at the same time?</em> Please notice that the cache function accepts an array which allows it to pass in multiple query objects.
When a pass in an array to the cache function is made, it will try to find a result for each query object.</p>
</div>
<div class="paragraph">
<p>It is also possible to pass in just one query object without a surrounding array.
In this case, only objects that exactly match this query object will be cached as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">async prepare(store) {
        await store.account.cache([
            {
                address: this.asset.recipientId,
            },
            {
                address: this.senderId,
            }
        ]);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>A further in depth explanation in the custom transactions deep dive article can be found on <a href="https://lisk.io/blog/tutorial/custom-transactions-statestore-basetransaction-transfer-transaction#6658">our blog</a>.
The link opens the section <code>B/ Combining Filters</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_2_2_finish_the_transport"><a class="anchor" href="#_2_2_finish_the_transport"></a>2.2 Finish the transport</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The last custom transaction type here is to implement is the <code>FinishTransportTransaction</code>, which will complete the transport of the packet.</p>
</div>
<div class="paragraph">
<p>When reaching the recipient of the packet, the carrier passes the packet to the recipient.
The recipient needs to sign the <code>FinishTransportTransaction</code>, that verifies that the packet has been passed on to the recipient.</p>
</div>
<div class="paragraph">
<p>When sending the transaction, the recipient needs to specify the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>packetID</code>: The ID of the packet that the recipient received.</p>
</li>
<li>
<p><code>status</code>: The status of the transport, which has 2 options: <code>"success"</code> or <code>"fail"</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This transaction will perform the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>status="success"</code></p>
<div class="ulist">
<ul>
<li>
<p>Send <code>postage</code> to the carrier&#8217;s account.</p>
</li>
<li>
<p>Unlock <code>security</code> in the carrier&#8217;s account.</p>
</li>
<li>
<p>Increase <code>trust</code> of the carrier +1.</p>
</li>
<li>
<p>Set packet <code>status</code> to <code>success</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If <code>status="fail"</code></p>
<div class="ulist">
<ul>
<li>
<p>Send <code>postage</code> to the sender&#8217;s account.</p>
</li>
<li>
<p>Add <code>security</code> to the sender&#8217;s account, and nullify <code>lockedSecurity</code> from the account for the carrier.</p>
</li>
<li>
<p>Decrease <code>trust</code> of the carrier by -1.</p>
</li>
<li>
<p>Set packet <code>status</code> to <code>fail</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Click here to see the <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/transport/transactions/finish-transport.js">full code for FinishTransportTransaction</a></p>
</div>
<div class="listingblock">
<div class="title">Code for <code>applyAsset()</code> of <code>finish-transport.js</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">applyAsset(store) {
    const errors = [];
    let packet = store.account.get(this.asset.recipientId);
    let carrier = store.account.get(packet.asset.carrier);
    let sender = store.account.get(packet.asset.sender);
    // if the transaction has been signed by the packet recipient
    if (this.asset.senderId === packet.carrier) {
        // if the packet status is not "ongoing" and not "alarm"
        if (packet.asset.status !==  "ongoing" &amp;&amp; packet.asset.status !== "alarm") {
            errors.push(
                new TransactionError(
                    'FinishTransport can only be triggered, if packet status is "ongoing" or "alarm" ',
                    this.id,
                    'ongoing or alarm',
                    this.asset.status
                )
            );
            return errors;
        }
        // if the transport was SUCCESSFUL
        if (this.asset.status === "success") {
            /**
             * Update the Carrier account:
             * - Unlock security
             * - Add postage &amp; security to balance
             * - Earn 1 trustpoint
             */
            /* Write your own code here*/
            /**
             * Update the Packet account:
             * - Remove postage from balance
             * - Change status to "success"
             */
            /* Write your own code here */
            return errors;
        }
        // if the transport FAILED
        /**
         * Update the Sender account:
         * - Add postage and security to balance
         */
        const senderBalanceWithSecurityAndPostage = new utils.BigNum(sender.balance).add(new utils.BigNum(packet.asset.security)).add(new utils.BigNum(packet.asset.postage));

        sender.balance = senderBalanceWithSecurityAndPostage.toString();

        store.account.set(sender.address, sender);
        /**
         * Update the Carrier account:
         * - Reduce trust by 1
         * - Set lockedSecurity to 0
         */
        carrier.asset.trust = carrier.asset.trust ? --carrier.asset.trust : -1;
        carrier.asset.lockedSecurity = null;

        store.account.set(carrier.address, carrier);
        /**
         * Update the Packet account:
         * - set status to "fail"
         * - Remove postage from balance
         */
        packet.balance = '0';
        packet.asset.status = 'fail';

        store.account.set(packet.address, packet);

        return errors;
    }
    errors.push(
        new TransactionError(
            'FinishTransport transaction needs to be signed by the recipient of the packet',
            this.id,
            '.asset.recipient',
            this.asset.recipient
        )
    );
    return errors;
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_explanation_caching_data_based_on_data_from_the_db"><a class="anchor" href="#_explanation_caching_data_based_on_data_from_the_db"></a>Explanation: Caching data based on data from the db</h3>
<div class="paragraph">
<p>It may be required to cache accounts or other data from the database, depending on other data that is stored in the database.</p>
</div>
<div class="paragraph">
<p>To achieve this, the points listed below must be followed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>cache the data with <code>store.account.cache</code>.</p>
</li>
<li>
<p>save the data as a constant with <code>store.account.get</code>.</p>
</li>
<li>
<p>It is now possible to use the newly created constant to cache the rest of the data, as shown in the code snippet below:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title"><code>prepare()</code> function of <code>finish-transport.js</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">async prepare(store) {
    /**
     * Get packet account.
     */
    await store.account.cache([
        {
            address: this.asset.recipientId,
        }
    ]);
    /**
     * Get sender and recipient accounts of the packet.
     */
    const pckt = store.account.get(this.asset.recipientId);
    await store.account.cache([
        {
            address: pckt.asset.carrier,
        },
        {
            address: pckt.asset.sender,
        },
    ]);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_task_implement_the_logic_in_applyasset_for_a_successful_transport"><a class="anchor" href="#_task_implement_the_logic_in_applyasset_for_a_successful_transport"></a>Task: Implement the logic in <code>applyAsset()</code> for a successful transport</h3>
<div class="paragraph">
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/transport/transactions/finish-transport.js#L83">Write your own logic or the case of a successful transport of the packet here.</a></p>
</div>
<div class="paragraph">
<p>When the recipient receives the packet from the carrier, the recipient has to sign and send the <code>FinishTransportTransaction</code>.
If the recipient considers the transport successful, then the carrier should be rewarded accordingly and the packet status will be updated to <code>success</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
More information can be found in the code comments of <code>finish-transport.js</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Important: To verify your implementation of <code>applyAsset()</code>, please compare it with the <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/transport/transactions/solutions/finish-transport.js">solution</a>.</strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_2_3_test_out_the_full_workflow_with_the_client_app"><a class="anchor" href="#_2_3_test_out_the_full_workflow_with_the_client_app"></a>2.3 Test out the full workflow with the client app</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="check_status"><a class="anchor" href="#check_status"></a>Check the status in the <code>lightAlarmTransaction</code></h3>
<div class="paragraph">
<p>At this point the entire workflow should be implemented with the status of the different packets.
If a packet is currently in <code>ongoing</code>  or <code>alarm</code> status, then to send an alarm follow the instructions described below:</p>
</div>
<div class="paragraph">
<p>Insert the code snippet listed below in the <code>applyAsset()</code> function of <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/transport/transactions/light-alarm.js#L39">light-alarm.js</a>, before the code that applies the changes to the database accounts.</p>
</div>
<div class="paragraph">
<p>If the status is not in <code>ongoing</code> or <code>alarm</code>, it will create a new <code>TransactionError</code>, push it to the <code>errors</code> list, and then return it.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This snippet must be inserted twice: Once in <code>transaction/light-alarm.js</code> on the local machine, and also in the <code>light-alarm.js</code> on the raspberry pi.h
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const packet = store.account.get(this.senderId);
if (packet.asset.status !== 'ongoing' &amp;&amp; packet.asset.status !== 'alarm') {
    errors.push(
        new TransactionError(
            'Transaction invalid because delivery is not "ongoing".',
            this.id,
            'packet.asset.status',
            packet.asset.status,
            `Expected status to be equal to "ongoing" or "alarm"`,
        )
    );

    return errors;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_register_all_transaction_types_with_the_node_app"><a class="anchor" href="#_register_all_transaction_types_with_the_node_app"></a>Register all transaction types with the node app</h3>
<div class="paragraph">
<p>Please follow the required steps listed below to uncomment all of the custom transactions, in order to register them with the node application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { Application, genesisBlockDevnet, configDevnet } = require('lisk-sdk');
const RegisterPacketTransaction = require('../transactions/register-packet');
const StartTransportTransaction = require('../transactions/start-transport');
const FinishTransportTransaction = require('../transactions/finish-transport');
const LightAlarmTransaction = require('../transactions/light-alarm');

configDevnet.app.label = 'lisk-transport';
configDevnet.modules.http_api.access.public = true;

const app = new Application(genesisBlockDevnet, configDevnet);
app.registerTransaction(RegisterPacketTransaction);
app.registerTransaction(StartTransportTransaction);
app.registerTransaction(FinishTransportTransaction);
app.registerTransaction(LightAlarmTransaction);

app
    .run()
    .then(() =&gt; app.logger.info('App started...'))
    .catch(error =&gt; {
        console.error('Faced error in application', error);
        process.exit(1);
    });</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_try_it_out_in_the_client_app"><a class="anchor" href="#_try_it_out_in_the_client_app"></a>Try it out in the client app</h3>
<div class="paragraph">
<p>Now try to start or re-start the <code>node</code>, <code>client</code> and <code>iot</code> application, exactly as performed earlier in <a href="transport1.html#client" class="page">Step 1.3 in Part 1</a> of this tutorial.</p>
</div>
<div class="paragraph">
<p>Go to <code><a href="http://localhost:3000" class="bare">http://localhost:3000</a></code> to access the client app through the web browser.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The prepared account credentials for the sender, recipient, and carrier can be found in <code>client/accounts.json</code>.</p>
</div>
<div class="paragraph">
<p>These credentials are already pre-filled in the different forms in the client app.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">The different users in Lisk transport can be seen below:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "carrier": {
    "address": "6795425954908428407L",
    "passphrase": "coach pupil shock error defense outdoor tube love action exist search idea",
    "encryptedPassphrase": "iterations=1&amp;salt=4ba0d3869948e39a7f9a096679674655&amp;cipherText=f0a1f0009ded34c79a0af40f12fcf35071a88de0778abea2a1f07861386a4b5c6b13f308f1ebf1af9098b66ed77cb22fc8bd872fa71ff71f3dbed1194928b7e447cb4089359a8be64093f9c1c8a3dca8&amp;iv=e0f1fb7574873142c672a565&amp;tag=ad56e67c5115e9a211c3907c400b9458&amp;version=1",
    "publicKey": "7b97ac4819515de345570181642d975590154e434f86ece578c91bbfa2e4e1e7",
    "privateKey": "c7723897eaaf4462dc0b914af2b1e4905e42a548866e0ddfb09efdfdd4d2df507b97ac4819515de345570181642d975590154e434f86ece578c91bbfa2e4e1e7"
  },
  "recipient": {
    "name": "delegate_100",
    "address": "11012441063093501636",
    "passphrase": "dream theory eternal recall valid clever mind sell doctor empower bread cage",
    "encryptedPassphrase": "iterations=10&amp;cipherText=b009292f88ea0f9f5b5aec47a6168b328989a37e7567aea697b8011b3d7fb63a07d7d8553c1a52740fd14453d84f560fda384bf1c105b5c274720d7cb6f3dbf6a9ed9f967cdc7e57f274083c&amp;iv=ec7e5ebe2c226fcd8209fc06&amp;salt=0478b7883713866370ae927af7525ed2&amp;tag=29aa766741bf5b4bbcfeaf3cd33ad237&amp;version=1",
    "publicKey": "d8685de16147583d1b9f2e06eb43c6af9ba03844df30e20f3cda0b681c14fb05"
  },
  "sender": {
    "address": "11237980039345381032L",
    "passphrase": "creek own stem final gate scrub live shallow stage host concert they"
  }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_initialize_a_new_packet_account"><a class="anchor" href="#_initialize_a_new_packet_account"></a>Initialize a new packet account</h4>
<div class="paragraph">
<p>Go to <code><a href="http://localhost:3000/initialize" class="bare">http://localhost:3000/initialize</a></code> and copy the packet credentials <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/transport/iot/light_alarm/index.js#L18">in your tracking script</a> on the Raspberry Pi.</p>
</div>
<div class="paragraph">
<div class="title">Create new packet credentials</div>
<p><span class="image"><img src="../_images/1-initialize.png" alt="Initialize packet account"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_register_the_packet"><a class="anchor" href="#_register_the_packet"></a>Register the packet</h4>
<div class="paragraph">
<p>Firstly, open the <a href="http://localhost:3000/post-register-packet">Register Packet</a> page and complete the form in order to register your packet in the network.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Use the address of the packet credentials as the packet ID that was created in the previous step.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Set <code>minTrust</code> to <code>0</code>, as there is no carrier present in the system yet that has more than <code>0</code> trustpoints.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Sender posts the <code>RegisterPacket</code> transaction to register the packet on the network.</div>
<p><span class="image"><img src="../_images/2-register.png" alt="register packet"></span></p>
</div>
<div class="paragraph">
<div class="title">Check the <code>Packet &amp; Carrier</code> page to see if the packet status is now "pending"</div>
<p><span class="image"><img src="../_images/3-pending.png" alt="packet pending"></span></p>
</div>
<div class="paragraph">
<p>If the packet is now opened at this point, then the light alarm transaction should fail as the packet should have the wrong <code>status</code>.
It should display the following error message listed below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">[
  {
    "message": "Transaction invalid because delivery is not \"ongoing\".",
    "name": "TransactionError",
    "id": "5902807582253136271",
    "dataPath": "packet.asset.status",
    "actual": "pending",
    "expected": "Expected status to be equal to \"ongoing\" or \"alarm\""
  }
]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fund_the_carrier_account"><a class="anchor" href="#_fund_the_carrier_account"></a>Fund the carrier account</h4>
<div class="paragraph">
<p>Before the packet transport starts, it is necessary to transfer some tokens into the empty carrier account.
This is required as the carrier needs to lock the <code>security</code> in the carriers account, in order to start the transport.</p>
</div>
<div class="paragraph">
<p>To perform this task, go to the <a href="http://localhost:3000/faucet">Faucet page</a> and enter the carrier address(<code>6795425954908428407L</code>), followed by the amount of tokens to be transferred to this account.</p>
</div>
<div class="paragraph">
<p>Please ensure that enough tokens are transferred so that the carrier can afford to lock the <code>security</code> of the packet, that was defined in the previous step, whereby the packet was registered in the network.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This can be checked on the <code>Accounts</code> page, to see if the carrier received the tokens successfully.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/4-faucet.png" alt="Fund carrier"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_start_transport"><a class="anchor" href="#_start_transport"></a>Start transport</h4>
<div class="paragraph">
<p>The carrier is required to post the transaction on the <a href="http://localhost:3000/post-start-transport">Start Transport</a> page, to initiate the transport.</p>
</div>
<div class="paragraph">
<p>The carrier is now required to specify the <code>packetId</code>.</p>
</div>
<div class="paragraph">
<p>The transaction will only be accepted if the carrier has enough <code>trust</code> and <code>security</code> for the specified packet.</p>
</div>
<div class="paragraph">
<div class="title">Carrier posts the <code>StartTransport</code> transaction, and then receives the packet from the sender.</div>
<p><span class="image"><img src="../_images/5-start.png" alt="start transport"></span></p>
</div>
<div class="paragraph">
<div class="title">API response</div>
<p><span class="image"><img src="../_images/22-register-response.png" alt="finish transport"></span></p>
</div>
<div class="paragraph">
<div class="title">Check the <code>Packet &amp; Carrier</code> page to see if the packet status has changed to "ongoing".</div>
<p><span class="image"><img src="../_images/6-ongoing.png" alt="packet account 2"></span></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The light alarm will be extinguished after postingthe  <code>StartTransport</code> and before posting the <code>FinishTransport</code>.
This occurs due to the status check added in the section <a href="#check_status">Check for status in the lightAlarmTransaction</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/7-alarm.png" alt="packet alarm"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_finish_transport"><a class="anchor" href="#_finish_transport"></a>Finish transport</h4>
<div class="paragraph">
<p>When the carrier passes the packet to the recipient, the recipient will sign the final <a href="http://localhost:3000/post-finish-transport">FinishTransport</a> transaction, which will complete the transport of the packet.</p>
</div>
<div class="paragraph">
<p>Only the <code>packetId</code>, and the <code>status</code>, which can be either <code>fail</code> or <code>success</code> needs to be specified here.</p>
</div>
<div class="paragraph">
<p>To help with the decision of the final status, the recipient can inspect the packet after receiving it.
Please be aware that due to the IoT device inside the packet, the recipient can also check in the client app if the packet triggered any alarm.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In case the recipient does not receive the packet after a reasonable amount of time, the recipient should also send the <code>FinishTransport</code> transaction, (most likely with <code>status=fail</code>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">The recipient posts the <code>FinishTransport</code> transaction, once the packet has been received from the carrier.</div>
<p><span class="image"><img src="../_images/8-finish.png" alt="finish transport"></span>
Check if the transport has been successful or if it has failed, then verify the changes accordingly in the accounts on the <code>Packet&amp;Carrier</code> page.</p>
</div>
<div class="paragraph">
<div class="title">Transport fail</div>
<p><span class="image"><img src="../_images/9-fail.png" alt="finish transport fail"></span></p>
</div>
<div class="paragraph">
<div class="title">API response</div>
<p><span class="image"><img src="../_images/92-success.png" alt="finish transport"></span></p>
</div>
<div class="paragraph">
<p>Once all of the above steps have been completed, a simple, but fully working proof of concept of a decentralised supply chain tracking system is now running on your machine.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Time to celebrate! \o/
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Move on to <a href="transport3.html" class="page">section 3: Next steps</a>.
This contains additional useful information and further help.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
    <div class="bottom-links">
    <div>
      <a class="bottom-link" href="/documentation/lisk-sdk/tutorials/transport1.html"><i class="icofont-double-left icofont-3x"></i>Part 1: Track a packet on the blockchain
    </a>
    </div><div>
      <a class="bottom-link" href="/documentation/lisk-sdk/tutorials/transport3.html">Part 3: How to publish the application<i class="icofont-double-right icofont-3x"></i>
      </a>
    </div>
  </div>






</article>
<aside class="article-aside hidden" role="navigation">
    <h3 class="toc-title">On this page:</h3>
    <div id="article-toc"></div>
</aside>


</main>
</div>
<footer class="footer">
    <div class="footer__container">
        <div class="footer__copyright">
            <div class="institutional-links-2">
                <span class="institutional-links-2__item"> 2020 Lisk Foundation</span>
                <a class="institutional-links-2__item" href="https://lisk.io/terms-conditions" class="institutional-links-2-item">Terms & Conditions</a>
                <a class="institutional-links-2__item" href="https://lisk.io/privacy" class="institutional-links-2-item">Privacy Policy</a>
            </div>
            <p class="footer__copyright-text">Lisk is a foundation registered in Zug, Switzerland
            </p>
        </div>
        <div class="footer__logo-container">
            <img src="../../_/img/lisk-logo-light.svg" class="footer__lisk-logo"/>
        </div>
        <div class="community-section">
            <p class="community-section__text">Follow Lisk on: </p>
            <div class="community-section__icons">
                <a href="https://github.com/LiskHQ" target="_blank" class="footer__icon icon-github"></a>
                <a href="https://www.youtube.com/channel/UCuqpGfg_bOQ8Ja4pj811PWg/featured" target="_blank" class="footer__icon icon-youtube"></a>
                <a href="https://www.reddit.com/r/Lisk/" target="_blank" class="footer__icon icon-reddit"></a>
                <a href="https://www.linkedin.com/company/lisk/" target="_blank" class="footer__icon icon-linkedin"></a>
                <a href="https://twitter.com/LiskHQ" target="_blank" class="footer__icon icon-twitter"></a>
                <a href="https://www.facebook.com/LiskHQ" target="_blank" class="footer__icon icon-facebook"></a>
            </div>
        </div>
    </div>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.10.0/tocbot.min.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/tabs-block-behaviour.js"></script>
<script>
    tocbot.init( {
        tocSelector: '#article-toc',
        contentSelector: 'article',
        headingSelector: 'h1, h2, h3, h4, h5',
        collapseDepth: 3,
        positionFixedSelector: null,
        scrollSmooth: true,
        scrollSmoothDuration: 420
    } );
    var tocList = document.getElementById( 'article-toc' ).getElementsByClassName( 'toc-list' );
    if ( tocList && tocList.length > 0 && tocList[0].childNodes.length > 0 ) {
        document.getElementById( 'article-toc' ).parentNode.classList.remove( 'hidden' );
    }
</script>
  <script src="../../_/js/vendor/docsearch.min.js"></script>
  <!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js -->
  <script>
    function focusSearchInput () { document.querySelector('#search-input').focus() }
    var search = docsearch({
        appId: 'C4SU57KGV9',
      apiKey: '55aa8709b04eb62f08f87571cf77547c',
      indexName: 'lisk-docs-search',
      inputSelector: '#search-input',
      autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
      algoliaOptions: { hitsPerPage: 10 }
    }).autocomplete
    search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
    focusSearchInput()
    window.addEventListener('load', focusSearchInput)
  </script>

  </body>
</html>
