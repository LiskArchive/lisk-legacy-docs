<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Monitoring :: Lisk documentation</title>
    <link rel="canonical" href="https://lisk.com/documentation/lisk-core/v2/monitoring.html">
    <link rel="prev" href="update/source.html">
    <link rel="next" href="reference/api-mainnet.html">
    <meta name="description" content="Monitoring covers log and performance monitoring &amp; New Relic.">
    <meta name="generator" content="Antora 3.1.1">

  <link id="theme" rel="stylesheet" title="Default" href="../../_/css/site.css">
  <link rel="stylesheet" title="Dark" href="../../_/css/dark-site.css">

    <script>var uiRootPath = '../../_'</script>
    <script src="../../_/js/vendor/medium-zoom.js"></script>
    <script type="text/javascript" id="Cookiebot" src="https://consent.cookiebot.com/uc.js" data-cbid="e4db29b5-cd94-4bcf-87e4-04f4ca564240" data-blockingmode="manual"></script>
    <!-- Matomo -->
    <script>
      var _paq = window._paq = window._paq || [];
      /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="https://lisk.matomo.cloud/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '2']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src='//cdn.matomo.cloud/lisk.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Matomo Code -->
    <!-- Matomo Tag Manager -->
    <script>
      var _mtm = window._mtm = window._mtm || [];
      _mtm.push({'mtm.startTime': (new Date().getTime()), 'event': 'mtm.Start'});
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src='https://cdn.matomo.cloud/lisk.matomo.cloud/container_RUW6y8yf.js'; s.parentNode.insertBefore(g,s);
    </script>
    <!-- End Matomo Tag Manager -->
<link rel="icon" href="../../_/img/favicon.png" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="top-logo">
        <a href="../.." class="lisk-logo"></a>
        <a href="../.." class="docs-logo"></a>
      </div>
      <!--<a class="navbar-item" href="https://lisk.com/documentation">Lisk documentation</a>-->
        <div id="docsearch" class="navbar-menu search-box hide-for-print">
          <!--<input id="search-input-toolbar" type="text" placeholder="Search me ...">-->
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">APIs</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="../../api/lisk-node-http.html">Lisk node HTTP API</a>
            <a class="navbar-item" href="../../api/lisk-node-rpc.html">Lisk node RPC API</a>
            <a class="navbar-item" href="../../api/lisk-service-http.html">Lisk Service HTTP API</a>
            <a class="navbar-item" href="../../api/lisk-service-rpc.html">Lisk Service RPC API</a>
            <a class="navbar-item" href="../../api/lisk-service-pubsub.html">Lisk Service Pub/Sub API</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Explorers</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://lisk.observer/" target="_blank">Lisk Observer</a>
            <a class="navbar-item" href="https://liskscan.com/" target="_blank">LiskScan</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="../../lisk-sdk/">Lisk SDK</a>
            <a class="navbar-item" href="../../lisk-service/">Lisk Service</a>
            <a class="navbar-item" href="../../lisk-core/">Lisk Core</a>
            <a class="navbar-item" href="https://lisk.com/wallet" target="_blank">Lisk Wallets</a>
          </div>
        </div>
        <button onclick="switch_style('toggle')" id="theme-toggle" class="theme-toggle navbar-item"></button>
        <!-- <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div> -->
      </div>
    </div>
  </nav>
</header>
<div class="toolbar" role="navigation">
  <button class="nav-toggle"></button>
  <div class="components-versions">
      <div class="page-components">
    <button class="component-menu-toggle" title="Show other documentations">Lisk Core</button>
    <div class="component-menu">
        <a class="component is-current" href="index.html">Lisk Core</a>
        <a class="component" href="../../lisk-docs-manual/index.html">Lisk docs manual</a>
        <a class="component" href="../../beta/index.html">Lisk Documentation</a>
        <a class="component" href="../../lisk-sdk/index.html">Lisk SDK</a>
        <a class="component" href="../../lisk-service/v0.7/index.html">Lisk Service</a>
    </div>
  </div>
    <span></span>
    <div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">2.1.7</button>
  <div class="version-menu">
    <a class="version is-missing" href="../v4/index.html">4.0.0-beta.0</a>
    <a class="version is-current" href="monitoring.html">2.1.7</a>
  </div>
</div>
  </div>
  <span></span>
  <span></span>
  <a href="../../beta/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Lisk Core</a></li>
    <li><a href="monitoring.html">Monitoring</a></li>
  </ul>
</nav>
    <div id="docsearch-toolbar" class="search-box hide-for-print toolbar-search">
      <!--<input id="search-input" type="text" placeholder="Search me ...">-->
    </div>
  <div class="edit-this-page"><a href="https://github.com/LiskHQ/lisk-docs/edit/docs-core-v2/modules/ROOT/pages/monitoring.adoc"><img class="pencil">Edit this Page</a></div>
  </div>
<div class="body">
<div class="nav-container" data-component="lisk-core" data-version="v2">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Lisk Core</a></h3>
<ul class="nav-list">
  <li class="nav-item parent" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Lisk Core introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="interact-with-the-api.html">Interact with the API</a>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Setup</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup/application.html">Application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup/commander.html">Commander application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup/docker.html">Docker image</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup/source.html">Source code</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Management</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="management/application.html">Application commands</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="management/commander.html">Commander application commands</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="management/docker.html">Docker image commands</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="management/source.html">Source code commands</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="management/configuration.html">Handle config files</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="management/forging.html">Enable forging</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Update</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="update/application.html">Application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="update/commander.html">Commander application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="update/docker.html">Docker image</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="update/source.html">Source code</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="monitoring.html">Monitoring</a>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reference/api-mainnet.html">API (Mainnet)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reference/api.html">API (Testnet)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reference/config.html">Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Lisk Core</span>
    <span class="version">2.1.7</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">Lisk Core</a>
      <ul class="versions">
        <li class="version">
          <a href="../v4/index.html">4.0.0-beta.0</a>
        </li>
        <li class="version is-current is-latest">
          <a href="index.html">2.1.7</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../lisk-docs-manual/index.html">Lisk docs manual</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lisk-docs-manual/index.html">0.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../beta/index.html">Lisk Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../beta/index.html">beta</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../lisk-sdk/index.html">Lisk SDK</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lisk-sdk/index.html">5.2.2 (latest)</a>
        </li>
        <li class="version">
          <a href="../../lisk-sdk/v6/index.html">6.0.0 (beta)</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../lisk-service/v0.7/index.html">Lisk Service</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lisk-service/v0.7/index.html">0.7.0 (beta)</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Monitoring</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#log_monitoring">Log monitoring</a></li>
<li><a href="#performance-monitoring">Performance monitoring</a>
<ul class="sectlevel2">
<li><a href="#enable-new-relic">Enable New Relic</a></li>
<li><a href="#keep-your-node-busy">Keep your node busy</a></li>
<li><a href="#analysis-with-new-relic">Analysis with New Relic</a></li>
<li><a href="#faq">FAQ</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="log_monitoring"><a class="anchor" href="#log_monitoring"></a>Log monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="management/logs.html#file_log_stream" class="xref page">log files</a> provide a chronological list of activities that occurred on a node.
These activities can be analyzed further to provide monitoring for a particular node or the network in general.
As the logs are created in JSON format, it is possible to pipe the log messages to additional monitoring software.
With monitoring software, the node operator can filter automatically for certain events and visualize them through a front-end application.
In addition, it could also be used to send notifications to the operator in case of an emergency.</p>
</div>
<div class="paragraph">
<p>Various types of monitoring software packages currently exist that support log analysis.
For example: <a href="https://www.elastic.co/products/kibana/">Kibana</a>, <a href="https://grafana.com/">Grafana</a> or <a href="https://www.graylog.org/">Graylog</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="performance-monitoring"><a class="anchor" href="#performance-monitoring"></a>Performance monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://newrelic.com/">New Relic</a> is used to monitor the activities inside of the application.
It enables a detailed insight into the system and keeps track of the performance of all activities, e.g. an HTTP API call or a background process from Lisk Core jobs queue.</p>
</div>
<div class="paragraph">
<p>The following steps provide the user with the insights of why and how to monitor your Lisk Core node using the New Relic instrumentation.</p>
</div>
<div class="sect2">
<h3 id="enable-new-relic"><a class="anchor" href="#enable-new-relic"></a>Enable New Relic</h3>
<div class="sect3">
<h4 id="get-the-new-relic-license-key"><a class="anchor" href="#get-the-new-relic-license-key"></a>Get the New Relic license key</h4>
<div class="paragraph">
<p>Firstly, it is required to register an account at <a href="https://rpm.newrelic.com" class="bare">https://rpm.newrelic.com</a>.
After successful login, select ''Account settings'' in the account dropdown box in the New Relic UI.
From the Account information section on the right side of the summary page, copy your license key.</p>
</div>
</div>
<div class="sect3">
<h4 id="add-the-license-key"><a class="anchor" href="#add-the-license-key"></a>Add the license key</h4>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_option-1---as-environment-variable"></a>Option 1 - As environment variable</p>
</li>
<li>
<p><a id="tabset1_option-2---in-newrelic-js"></a>Option 2 - In newrelic.js</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_option-1---as-environment-variable">
<div class="paragraph">
<p>To enable the performance monitoring on your node, ensure you have an environment variable <code>NEW_RELIC_LICENSE_KEY</code> set:</p>
</div>
<div class="paragraph">
<p><strong>Application and Source code</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export NEW_RELIC_LICENSE_KEY=XXXXXXXXX</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Docker image</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd lisk_repo/docker <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Navigate into the <code>docker</code> directory.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Inside, edit <code>docker-compose.override.yml</code> and add your license key as shown below:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>version: "3"
services:

  lisk:
    environment:
      - NEW_RELIC_LICENSE_KEY=XXXXXXXXX</pre>
</div>
</div>
<div class="paragraph">
<p>Then save your changes to the file, and reinitialize Docker so it can use the new environment variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker-compose up -d <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Restart Docker containers.</td>
</tr>
</table>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_option-2---in-newrelic-js">
<div class="paragraph">
<p>An additional method of adding the license key is to edit the <code>newrelic.js</code> file, which can be found in the root directory of the Lisk Core installation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd lisk_repo <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Navigate inside the root folder of Lisk Core.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once inside the root folder, open the file <code>newrelic.js</code> and search for the option <code>license_key</code>, and add your license key as a string value as shown below:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/**
 * Your New Relic license key.
 *
 * MUST set the license key using `NEW_RELIC_LICENSE_KEY` env variable
 * if you want to enable the monitoring of the lisk node
 */
license_key: 'XXXXXXXXX',</pre>
</div>
</div>
<div class="paragraph">
<p>After adding the license key, save your changes and reload your node.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="restart-lisk-core-node"><a class="anchor" href="#restart-lisk-core-node"></a>Restart Lisk Core node</h4>
<div class="paragraph">
<p>Start the node normally as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bash lisk.sh start <i class="conum" data-value="1"></i><b>(1)</b>
npx pm2 start lisk <i class="conum" data-value="2"></i><b>(2)</b>
docker start container_id <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start Lisk Core Application.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Start Lisk Core Source code.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Start Lisk Core Docker image.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the case whereby it is already running, then perform a restart as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bash lisk.sh reload <i class="conum" data-value="1"></i><b>(1)</b>
npx pm2 restart lisk <i class="conum" data-value="2"></i><b>(2)</b>
docker restart container_id <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Restart Lisk Core Application.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Restart Lisk Core Source code.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Restart Lisk Core Docker image.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="keep-your-node-busy"><a class="anchor" href="#keep-your-node-busy"></a>Keep your node busy</h3>
<div class="paragraph">
<p>It is required to perform some system activities in order to monitor them.
In order to accomplish this, keep your node busy by performing actions like taking a snapshot, syncing your node, or running various API requests against it.
Even if they are not performed, New Relic can monitor the internal activities of the system. For example, different queue jobs.</p>
</div>
<div class="paragraph">
<p>There are several options to create workload on your node which are described below:</p>
</div>
<div class="sect3">
<h4 id="option-1-lisk-core-test-suite"><a class="anchor" href="#option-1-lisk-core-test-suite"></a>Option 1: Lisk Core test suite</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Lisk Core test suite is only available for Lisk Core from Source.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>unit</code> testsuite is not suited for this purpose, as unit tests are not executed in the context of the running application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The README of the Lisk Core repository in Github describes <a href="https://github.com/LiskHQ/lisk-core#tests">how to run the testsuite</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="option-2-apache-bench"><a class="anchor" href="#option-2-apache-bench"></a>Option 2: Apache bench</h4>
<div class="paragraph">
<p><a href="https://httpd.apache.org/docs/2.4/programs/ab.html">Apache Bench</a> is a generic benchmarking tool designed to measure the performance of HTTP servers.</p>
</div>
<div class="paragraph">
<p>For example the following request shown below can be performed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">now &amp;&amp; ab -n 200000 -c 1 -k "http://127.0.0.1:7000/api/accounts?publicKey=4e8896e20375b16e5f1a6e980a4ed0cdcb3356e99e965e923804593669c87ad2"</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>now</code>: Appends the current system time on top of the Apache Bench output.
In case you wish to compare the New Relic benchmark results with the Apache Bench output, it is convenient to add New Relic in order to ascertain exactly when the benchmark started, as Apache Bench is not actually logging this.</p>
</div>
<div class="paragraph">
<p><code>-n</code>: The number of requests that are executed.</p>
</div>
<div class="paragraph">
<p><code>-c</code>: The number of requests to perform in parallel.</p>
</div>
<div class="paragraph">
<p><code>-k</code>: Enable the HTTP KeepAlive feature, i.e., perform multiple requests within one HTTP session.</p>
</div>
</div>
<div class="sect3">
<h4 id="option-3-siege"><a class="anchor" href="#option-3-siege"></a>Option 3: Siege</h4>
<div class="paragraph">
<p><a href="https://www.joedog.org/siege-manual">Siege</a> is another tool for benchmarking the performance of HTTP servers.</p>
</div>
<div class="paragraph">
<p>For example the following request shown below can be performed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">siege -c 10 -t 30m http://127.0.0.1:7000/api/blocks</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>-c</code>: Number of requests to perform in parallel.</p>
</div>
<div class="paragraph">
<p><code>-t</code>: Allows the test to be run for a selected period.</p>
</div>
</div>
<div class="sect3">
<h4 id="option-4-custom-script"><a class="anchor" href="#option-4-custom-script"></a>Option 4: Custom script</h4>
<div class="paragraph">
<p>Feel free to write your own custom scripts and specify the order and amount of actions you wish the node to perform during the analysis, depending on a special use case or a scenario you may wish to benchmark.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="analysis-with-new-relic"><a class="anchor" href="#analysis-with-new-relic"></a>Analysis with New Relic</h3>
<div class="paragraph">
<p>The following example below shows a case study, whereby it is required to analyze the performance of API <code>GET /api/transactions</code> endpoint, in order to ascertain the following information:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If there are any bottlenecks existing in the database level.</p>
</li>
<li>
<p>Which of the database queries is taking the longest time.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To accomplish this, the following steps below must be followed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ cd ~/lisk_repo
~/lisk_repo $ export NEW_RELIC_LICENSE_KEY=xxxxxxxxxxx
~/lisk_repo $ npx pm2 start lisk</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next step is to start performing some requests using Siege as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">siege -c 10 -t 5m http://127.0.0.1:4000/api/transactions</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script will automatically continue to send the HTTP requests against your node for 5 minutes (<code>-t 5m</code>).
During this time period, please be aware of the following points:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You may wish to disable the cache on the node to acquire real performance analysis.
To do this, set <code>cacheEnabled</code> in configuration to <code>false</code>.</p>
</li>
<li>
<p>It may not be possible to see the viable results if your development blockchain dataset is empty.
This could be changed by running your tests against the Testnet data.</p>
</li>
<li>
<p>It may take a couple of minutes to show the analyzed results in the New Relic interface so please be patient.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To see the New Relic instrumentation results, please log in to <a href="https://rpm.newrelic.com" class="bare">https://rpm.newrelic.com</a>, and select <code>APM</code> from the top menu.</p>
</div>
<div class="paragraph">
<p>The first screen is the list of applications.
Depending on which network your node is running on, the application title will be visible as shown in the image below:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/app_dashboard.png" alt="Apps List UI"></span></p>
</div>
<div class="paragraph">
<p>Please select the specific application by clicking its name.
The following dashboard will be visible as shown below:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/dashboard.png" alt="Dashboard UI"></span></p>
</div>
<div class="paragraph">
<p>In order to become conversant with the finely-grained details of this dashboard, please read <a href="https://docs.newrelic.com/docs/apm/new-relic-apm/getting-started/introduction-new-relic-apm" class="bare">https://docs.newrelic.com/docs/apm/new-relic-apm/getting-started/introduction-new-relic-apm</a>.
At this point, during the experiment, only the HTTP requests against our node were executed (<code>GET /api/transactions</code>), so there is only one section which shows interesting results. Please select "Transactions" from the left menu in the above screen. Now follow the detailed instructions in the image shown below:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Just for clarification, the New Relic transactions have no relation with Lisk transactions.
It is just the grouping term that New Relic uses to display analytics.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/transactions.png" alt="Transactions UI"></span></p>
</div>
<div class="paragraph">
<p>In the above image the most valuable information  is highlighted in the rectangle, which provides the following information:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The majority of the time (56%), was spent in ExpressJS which is a Node.js module.</p>
</li>
<li>
<p>During the experiment, one database view (<code>trs_list</code>) and one database table (<code>delegates</code>) were involved in the persistence layer.</p>
</li>
<li>
<p>Querying to the database table <code>delegates</code> were fast.</p>
</li>
<li>
<p>While the query to the database view <code>trs_list</code> was a bit expensive.</p>
</li>
<li>
<p>On average API calls for <code>GET /api/transactions</code> took 122ms.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If it is required to have this information in a tabular form, in order to create a presentation please click on the "Show all transactions table" link.
This will provide the following view as shown below:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/transactions_data.png" alt="Transactions Data"></span></p>
</div>
<div class="paragraph">
<p>From this screen it is possible to see the following information described below:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the selected time range a total of 14252 requests were made to <code>GET /api/transactions</code>.</p>
</li>
<li>
<p>The slowest request took 2.17 seconds.</p>
</li>
<li>
<p>The fastest request took 10ms.</p>
</li>
<li>
<p>The average time for requests was 122ms while the standard deviation was 213ms.</p>
</li>
<li>
<p>The difference between the average and standard deviation indicates there were small spikes between requests.</p>
</li>
<li>
<p>It is possible to export data to CSV format from this screen in order to maintain records or share with others.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If it is required to debug deeper into which transactions actually took 2.17 seconds, please return to the previous screen, start to scroll down and the transaction traces will be visible.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/trace_list.png" alt="Trace list"></span></p>
</div>
<div class="paragraph">
<p>Here it is possible to see an overview of an individual transaction which took a longer time period and is considered as "slow".
The threshold which defines the "slow" transactions is configured in file <code>newrelic.js</code> under <code>transaction_tracer.explain_threshold</code>, which is currently 100ms.
Every request which took more than 100ms will be considered as "slow" and logged as the trace by New Relic.
It is possible to debug further and verify what caused this request to be "slow", by clicking on any of the trace links in the list shown below:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/trace_summary.png" alt="Trace summary"></span></p>
</div>
<div class="paragraph">
<p>As shown on the above trace summary, most of the transaction’s time was spent in two functions <code>modules.transactions.shared.getTransactions</code> and <code>Middleware: bound logClientConnections</code>.
It is possible to view the trace detail in order to to see more information and the call stack.
it is also possible to click on "Database queries" to see which queries were executed during this request.</p>
</div>
<div class="paragraph">
<p>Furthermore, the database query which is taking most of the time can also be found.
This can be accomplished by clicking on the left side menu for "Database", and then to sort by "Most time consuming" and then select the top of the list.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/database_query.png" alt="Database Queries"></span></p>
</div>
<div class="paragraph">
<p>Scroll down on the page shown above, and the the slow queries can be viewed as shown below:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/slow_queries.png" alt="Slow Queries"></span></p>
</div>
<div class="paragraph">
<p>By analyzing the above diagrams, it is possible to conclude the following points below, assuming that all the statistics are strictly within the experiment time range:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The slowest queries in the system are queries for <code>trs_list</code> view.</p>
</li>
<li>
<p>For that database view <code>trs_list</code> the slowest query is the <code>SELECT count(*) FROM trs_list</code> which took 2.13 seconds.</p>
</li>
<li>
<p>There are a few other queries in the on <code>trs_list</code> view which took more than 1 second.</p>
</li>
<li>
<p>By clicking on the top slow query, it can be seen that the query was executed during <code>GET /api/transactions</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/query_detail.png" alt="Query Detail"></span></p>
</div>
<div class="paragraph">
<p>The above use case should help the user to understand the usage and benefits of New Relic.
Please contact us if you wish to know more.</p>
</div>
</div>
<div class="sect2">
<h3 id="faq"><a class="anchor" href="#faq"></a>FAQ</h3>
<div class="paragraph">
<p><strong>I am not seeing Lisk Data in the New Relic APM dashboard?</strong></p>
</div>
<div class="paragraph">
<p>Please ensure to check the following points:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Are you using a valid license key for your account?</p>
</li>
<li>
<p>Have you exported the license key on the node where you are running Lisk?</p>
</li>
<li>
<p>Have you selected the proper time range in New Relic APM?</p>
</li>
<li>
<p>Are you looking on the right page? E.g. you may be searching web transactions but had selected Non-Web transactions in the UI.</p>
</li>
<li>
<p>If you just run the node, give it a few minutes let New Relic crunch the data and display the results in the UI.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Are the performance measures consistent?</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Assuming you are using the same machine specification to run different scenarios, the statistics will be consistent.</p>
</li>
<li>
<p>It is recommended not to benchmark on your development machine, as it can have another workload during different test runs.</p>
</li>
<li>
<p>If you are using AB or Siege, always use the same number of connections to simulate the same request load on a node.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>How is it useful for me as a Delegate or Exchange?</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Performance of the machine may affect the behavior of interacting with the node.</p>
</li>
<li>
<p>You can create alert policies on New Relic to inform you when your app is taking more memory.</p>
</li>
<li>
<p>You can set alerts to see if the database is getting slow.</p>
</li>
<li>
<p>You can track if errors occurred in the system which were not handled correctly.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="update/source.html">Source code</a></span>
  <span class="next"><a href="reference/api-mainnet.html">API (Mainnet)</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="footerdiv">
    <p>© 2022 Lisk Foundation</p>
    <!-- <div class="community-section">
      <p class="community-section__text">Follow Lisk on: </p>
      <div class="community-section__icons"> -->
    <div class="community_icons">
        <a href="https://lisk.chat" title="Discord" target="_blank" class="footer_icon icon-discord"><p>Discord</p></a>
        <a href="https://dev.lisk.com" title="Discourse" target="_blank" class="footer_icon icon-discourse"><p>Discourse</p></a>
        <a href="https://github.com/LiskHQ" title="GitHub" target="_blank" class="footer_icon icon-github"><p>GitHub</p></a>
  <!--    </div> -->
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/tabs-block-behaviour.js"></script>
<script async src="../../_/js/vendor/swagger-ui.js"></script>
<script async src="../../_/js/vendor/component-versions.js"></script>
<script src="../../_/js/vendor/custom.js"></script>
  <script src="../../_/js/vendor/docsearch.js"></script>
  <!--<script src="../../_/js/vendor/docsearch.min.js"></script>-->
  <!--<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha"></script>-->
  <script>
    docsearch({
      container: '#docsearch',
        appId: 'C4SU57KGV9',
      apiKey: '55aa8709b04eb62f08f87571cf77547c',
      indexName: 'lisk-docs-search'
    });
    docsearch({
      container: '#docsearch-toolbar',
        appId: 'C4SU57KGV9',
      apiKey: '55aa8709b04eb62f08f87571cf77547c',
      indexName: 'lisk-docs-search'
    });
  </script>
  <!--<script>
    function focusSearchInput () { document.querySelector('#search-input').focus() }
    var search = docsearch({
        appId: 'C4SU57KGV9',
      apiKey: '55aa8709b04eb62f08f87571cf77547c',
      indexName: 'lisk-docs-search',
      inputSelector: '#search-input',
      autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
      algoliaOptions: { hitsPerPage: 10 }
    }).autocomplete
    search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
    focusSearchInput()
    window.addEventListener('load', focusSearchInput)
  </script>-->
<!--  <script>
    function focusSearchInputToolbar () { document.querySelector('#search-input-toolbar').focus() }
    var search = docsearch({
        appId: 'C4SU57KGV9',
      apiKey: '55aa8709b04eb62f08f87571cf77547c',
      indexName: 'lisk-docs-search',
      inputSelector: '#search-input-toolbar',
      autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
      algoliaOptions: { hitsPerPage: 10 }
    }).autocomplete
    search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
    focusSearchInputToolbar()
    window.addEventListener('load', focusSearchInputToolbar)
  </script>-->
  </body>
</html>
