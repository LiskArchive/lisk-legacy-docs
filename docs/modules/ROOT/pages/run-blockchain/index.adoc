= Running a blockchain node
Muhammad Talha <muhammad.talha@lightcurve.io>
:toc:
:toc: preamble
:docs_core: v4@lisk-core::
:docs_sdk: v6lisk-sdk::

:url_faucet: https://testnet-faucet.lisk.com/
:url_observer: https://lisk.observer/delegates
:url_liskscan: https://liskscan.com/delegates
:url_run_reset: run-blockchain/blockchain-reset.adoc
:url_run_forging: run-blockchain/forging.adoc
:url_run_logging: run-blockchain/logging.adoc
:url_run_misbehavior: run-blockchain/enabling-misbehavior-report.adoc
:url_run_protection: run-blockchain/non-forging-node-protection.adoc
:url_run_protection_forge: run-blockchain/forging-node-protection.adoc
:url_core: {docs_core}index.adoc
:url_core_setup_npm: {docs_core}setup/npm.adoc
:url_core_setup_binary: {docs_core}setup/binary.adoc
:url_core_setup_snap: {docs_core}setup/snap.adoc
// :url_core_setup_docker: {docs_core}setup/docker.adoc
:url_core_setup_source: {docs_core}setup/source.adoc
:url_glossary_selfstake: glossary.adoc#self-stake
:url_validator_weight: run-blockchain/staking.adoc#validator-weight
:url_protocol_selection: understand-blockchain/lisk-protocol/consensus-algorithm.adoc#delegate_selection
// :url_understand_endpoints: api/lisk-node-rpc.adoc
:url_sdk_plugin_http: lisk-sdk::plugins/http-api-plugin.adoc
:url_api_service_http: api/lisk-service-http.adoc
:url_api_service_rpc: api/lisk-service-rpc.adoc
// :url_api_service_pubsub: api/lisk-service-pubsub.adoc
// :url_service_setup_docker_coreconfig: lisk-service::setup/docker.adoc#configuring-lisk-core
// :url_service_setup_docker: lisk-service::setup/docker.adoc
:url_service_setup_source: lisk-service::setup/source.adoc
:url_communication_protocol: understand-blockchain/sdk/rpc.adoc
:url_enable_block_gen: run-blockchain/enable-block-generation.adoc
:url_validator: run-blockchain/become-a-validator.adoc

:url_pos: intro/how-blockchain-works.adoc#proof-of-stake
:url_staking: run-blockchain/staking.adoc
:url_disable_block_gen: run-blockchain/enable-block-generation.adoc#how-to-disable-block-generation-on-a-node
:url_unstake: run-blockchain/staking.adoc#un-staking
:url_lisk_commander: lisk-sdk::references/lisk-commander/index.adoc
:url_enabling_misbehavior: run-blockchain/enabling-misbehavior-report.adoc
// :url_account: run-blockchain/account-management.adoc
// TODO: Check - The account-management page does not seem to be updated yet in the run-blockchain nav bar. In addition, it appears that the account-management page needs to be updated. Uncomment this hyperlink once the Account page is updated.

//  URLs
:url_github_lisk_service: https://github.com/LiskHQ/lisk-service
:url_staking_guide: https://lisk.com/learn/guides/stake-lsk-tokens
// :url_p2p: https://lisk.com/documentation/lisk-docs/lisk-sdk/v6/references/typedoc/modules/_liskhq_lisk_p2p.html
// TODO: The older P2P link above was pointing to SDKv5, and it is now updated and commented out at the moment, as it is linked to a later version of Typedocs for Lisk elements/P2P. So once the beta version is rolled out we can uncomment this link above.


The "Run Blockchain" section contains all the guides concerning the management of a Lisk node and is therefore especially interesting for validators and other Lisk node operators.

== What is a blockchain node?

A blockchain node is a server with a running blockchain client, such as xref:{url_core}[].
Nodes are usually connected to other nodes running the same client via P2P.
// TODO: (See above comment on P2P) - Add in P2P link {url_p2p}[P2P^].
Together, they form the network that is maintaining the blockchain.

Depending on the node configuration, a node can have different roles in the network.
The two most important roles are <<rpc-enabled-nodes>> and <<validators-nodes>>, illustrated in the diagram below:

.Various node types of a blockchain network
image::run-blockchain/node-service-network.png[Node network, 800]

== Nodes

Nodes are, as the name suggests, blockchain nodes without block generation enabled.
// This means, non-validator nodes cannot add new blocks to the blockchain themselves, but they can receive and relay new blocks and transactions from and to other nodes in the network.
Hence, nodes can essentially be categorized into two types:
A validator node, or a non-validator node.
Therefore, non-validator nodes cannot add new blocks to the blockchain themselves, but they can receive and relay new blocks and transactions to and from other nodes participating in the network.

If not configured otherwise, every installed node is a non-validator node by default.

Generally, non-validator nodes are used by external services to get or send data to the blockchain if they have enabled the <<RPC API>>.


// === Protecting non-validator nodes

// Opening a node's API to the public exposes the node to certain attacks, and it is recommended to protect the node accordingly, in order to ensure the node keeps running stable.

// For more information, see the guide xref:{url_run_protection}[].

=== RPC API

If the RPC API of a node is enabled, it allows external services to send queries to the node and/or to subscribe to specific events that are happening in the network.
Depending on the node configuration, an RPC-enabled node can accept different communication protocols like HTTP, WS, and IPC.

* *Supported communication protocols*: xref:{url_communication_protocol}[].
// * *RPC endpoints*: xref:{url_understand_endpoints}[]
// // * *HTTP API*: xref:{url_sdk_plugin_http}[]

== Validator nodes

//TODO: Add link to Lisk PoS explanation, once it is available
In the Lisk xref:{url_pos}[PoS], a certain set of validators is selected by the network to add new blocks to the blockchain.
To participate in the block generation process, a validator needs to set up a node and configure it to enable block generation.
These nodes are called *validator nodes*.

Validator nodes fulfill a very important role in the network, and therefore they require certain additional configurations regarding enabling block generation and higher security measures, as compared to regular nodes.
Furthermore, they are equal to any non-validator node in the network and follow the same installation process.

In the Lisk Mainnet, exactly 103 validators exist in the network for each block generation round.
Validator nodes are the only nodes that can propose new blocks to the blockchain.
During a block generation round, every validator node has the opportunity to generate at least one block.

//TODO: Check this, update it so that it will be ready to add in when the NWs are available
// NOTE: Follow the guide xref:{url_run_forging}[Enable Block Generation] to learn how to enable block generation on a node for a particular validator.

////
=== Block Generation in the Testnet

Anyone can start block generation in the Lisk Testnet, thanks to the the {url_faucet}[Lisk Testnet faucet^], where users can request free Testnet LSK tokens.
The Lisk Testnet is the perfect network for users who want to test out how the block generation process works, or validators who want to test certain block generation setups before implementing them for their Mainnet validator.

IMPORTANT: The Testnet LSK do not hold any intrinsic value, as the Lisk Testnet is a network purely for testing purposes.
They can *never* be exchanged to real LSK tokens from the Lisk Mainnet.

=== Block Generation in the Mainnet

If you consider gaining an active validator position on the Lisk Mainnet, please be aware that the Lisk PoS requires to xref:{url_glossary_selfstake}[self stake] with a certain amount of your own tokens.
Therefore, a certain self-investment is required for every validator who wishes to participate in the block generation process.
////

=== Acquiring an active validator spot

To acquire a secure validator spot for a block generation round, it is necessary for a validator to be one of the top 103 validators with the most xref:{url_validator_weight}[validator weight] in the network.
For further information see the xref:{url_validator}[Validators] guide.

To see the currently required thresholds for entering the top 103, check the validator weights of the currently active 103 validators, for example, in one of the public Lisk network explorers:

* *Lisk Observer:* {url_observer}[^]
* *Lisk Scan:* {url_liskscan}[^]



//TODO: refer to new guides and improve/update description and link to new guides
// ==== Earning rewards as standby validator

// With in each block generation round, two additional validators outside the top 103 are chosen randomly to gain an active validator spot for that particular round.
// This gives validators who don't have enough staking weights a chance to profit from block generation awards as well.

// The random selection of the two standby validators is proportional to their individual staking weight, meaning validators with higher staking weight have a higher chance of getting selected.
// See xref:{url_protocol_selection}[Validator selection] for more information.

// === Protecting forging nodes
// To keep the network healthy, and to not miss any block rewards, it is recommended to implement certain security measures to protect the forging node against attacks and/or failures.

// For more information, see the guide xref:{url_run_protection_forge}[].


== Lisk Service nodes

{url_github_lisk_service}[Lisk Service^] is a data aggregation service that connects to a particular <<rpc-enabled-nodes,RPC enabled node>> and aggregates the blockchain data, to provide enriched API endpoints for other applications and services that rely on data from the blockchain.

//TODO: Check this, update it so that it will be ready to add in when the NWs are available
// === How to configure a blockchain node for Lisk Service

// To connect successfully to a blockchain node with Lisk Service, it is necessary to configure the node accordingly, by enabling the RPC API.

// See the section xref:{url_service_setup_docker_coreconfig}[Configuring Lisk Core] of the Lisk Service setup guide for a concrete example of how to configure Lisk Core so that Lisk Service can connect to it.

// === How to set up a Lisk Service node

// To set up Lisk Core, choose a distribution and follow the respective setup guide:

// * *Docker:* xref:{url_service_setup_docker}[]
// * *Source code:* xref:{url_service_setup_source}[]

//TODO: Check this, update it so that it will be ready to add in when the NWs are available
// no APIs available yet for new version
// === APIs

// The following APIs can be enabled in a Lisk Service node:

// * *HTTP API*: xref:{url_api_service_http}[]
// * *RPC WS API*: xref:{url_api_service_rpc}[]
// * *Public/Subscribe API*: xref:{url_api_service_pubsub}[]

// Further guides for node operators

// * xref:{url_run_logging}[Managing logs]
// * xref:{url_run_reset}[Resetting and snapshotting the blockchain]

// Further guides for validators

// * xref:{url_run_forging}[Enable Block Generation]

== How to set up a node
Lisk provides simple how-to guides about setting up various kinds of nodes.

=== How to set up a Lisk Core node

Lisk Core is the blockchain client that maintains the Lisk Mainnet.

To set up Lisk Core, choose a distribution and follow the respective setup guide:

* *NPM:* xref:{url_core_setup_npm}[]
* *Binary:* xref:{url_core_setup_binary}[]
* *Snap:* xref:{url_core_setup_snap}[]
// * *Docker:* xref:{url_core_setup_docker}[]
* *Source code:* xref:{url_core_setup_source}[]

== Block generation

To enable block generation it is necessary to have a node running and a sufficient amount of LSK tokens staked to meet the minimum requirements.
This is covered in more detail and can be found on the xref:{url_enable_block_gen}[Enable block generation page], here in the Run blockchain section.
If starting to enable block generation for the first time, it is highly recommended as also mentioned above, to first check out the dedicated guide: xref:{url_validator}[How to become a validator].

Once a node is set up as described above, it is then possible to connect to both the testnet and the mainnet.
With xref:{url_lisk_commander}[Lisk commander], it is a straightforward process via the command-line interface to create an account, deploy, manage, and interact with the node safely.
// For more information regarding setting up and managing your account, please refer to the following guide: xref:{url_account}[Account management].
// TODO: Uncomment above link once account-management page is updated.

With regard to xref:{url_disable_block_gen}[disabling block generation], it should be noted that in order to completely stop block generation without being punished by the network, it is required to xref:{url_unstake}[unstake] all self-stakes for a validator, before disabling block generation on the node.

== Report Misbehavior plugin

The "Report Misbehavior" plugin is a useful tool that is designed to provide the node operators with the option to report any suspicious or malicious activity.
In essence, it is a mechanism that allows the reporting of any fraudulent activities/transactions, misbehavior, security issues, and possible congestion that may impede and impact the security and stability of the network.
Furthermore, once implemented it provides automatic detection of delegate misbehavior and informs the running node.

For further in-depth information and how to set up the "Report Misbehavior" plugin, please see the following guide: xref:{url_enabling_misbehavior}[Enabling report misbehavior] in this section.

== Staking

Staking can be defined as the process of holding and locking up a certain amount of LSK tokens to participate and validate transactions, in order to determine who secures the network.
This can be achieved by voting with your own LSK tokens.
By performing staking it is possible to earn rewards, therefore giving the node operator the incentive to stake.
The selection of a node to validate a block, in turn, results in that node being able to earn the associated rewards, which are proportional to the amount of LSK tokens staked.

To acquire a more in-depth overview of staking and how to earn additional LSK tokens within the Lisk network, please see the {url_staking_guide}[Staking guide^].
